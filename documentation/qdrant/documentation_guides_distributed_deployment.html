<!doctype html><html lang=en><head><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta charset=UTF-8><title>Distributed Deployment - Qdrant</title>
<link rel=icon href=https://qdrant.tech/favicon/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=https://qdrant.tech/favicon/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://qdrant.tech/favicon/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://qdrant.tech/favicon/favicon-16x16.png><link rel=manifest href=https://qdrant.tech/favicon/site.webmanifest><link rel=mask-icon href=https://qdrant.tech/favicon/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#2b5797"><meta name=msapplication-config content="/favicon/browserconfig.xml"><meta name=theme-color content="#ffffff"><meta name=partition content="qdrant"><link href=https://qdrant.tech/css/search/search.min.09596ee2b3c94d0ac82a1c33199cabdb3e0210b1ee46aaf1515200e9e484d05dd9e27cc1e861c58cc2e582af162f63b8e180ff2a12f7a6592b7aeaa0a7125130.css rel=stylesheet integrity="sha512-CVlu4rPJTQrIKhwzGZyr2z4CELHuRqrxUVIA6eSE0F3Z4nzB6GHFjMLlgq8WL2O44YD/KhL3plkreuqgpxJRMA=="><link href=https://qdrant.tech/css/documentation.min.de204cdcfc410689a41c17bcdad0a34f2caaa50cc8505c820adaab481cef2d69a920b0a32e0d624701c29487e3271b694559d98c5047cbfaa5aa475f638011e5.css rel=stylesheet integrity="sha512-3iBM3PxBBomkHBe82tCjTyyqpQzIUFyCCtqrSBzvLWmpILCjLg1iRwHClIfjJxtpRVnZjFBHy/qlqkdfY4AR5Q=="><meta name=generator content="Hugo 0.141.0"><meta name=description content="Qdrant is an Open-Source Vector Database and Vector Search Engine written in Rust. It provides fast and scalable vector similarity search service with convenient API."><meta name=keywords content="vector search engine,neural network,matching,SaaS,approximate nearest neighbor search,image search,recommender system,vectors,knn algorithm,hnsw,vector search,embeddings,similarity,simaes networks,BERT,transformer,word2vec,fasttext,qdrant"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@id":"https://qdrant.tech/documentation/guides/distributed_deployment/#article","@type":"Article","abstract":"Distributed deployment Since version v080 Qdrant supports a distributed deployment mode In this mode multiple Qdrant services communicate with each other to distribute the data across the peers to extend the storage capabilities and increase stabilityHow many Qdrant nodes should I run The ideal number of Qdrant nodes depends on how much you value costsaving resilience and performancescalability in relation to each otherPrioritizing costsaving: If cost is most important to you run a single Qdrant node This is not recommended for production environments Drawbacks:","author":{"@type":"Organization","name":"Qdrant","url":"https://qdrant.tech/"},"dateModified":"0001-01-01 00:00:00 +0000 UTC","datePublished":"0001-01-01 00:00:00 +0000 UTC","description":"","headline":"Distributed Deployment","image":[""],"name":"Distributed Deployment","url":"https://qdrant.tech/documentation/guides/distributed_deployment/","wordCount":"6930"},{"@id":"https://qdrant.tech/documentation/guides/distributed_deployment/#organization","@type":"Organization","address":{"@type":"PostalAddress","addressCountry":"DE","addressLocality":"Berlin","addressRegion":"Berlin","postalCode":"10115","streetAddress":"Chausseestra√üe 86"},"contactPoint":{"@type":"ContactPoint","contactType":"customer support","email":"info@qdrant.com","telephone":"+49 3040797694"},"description":"Qdrant is an Open-Source Vector Database and Vector Search Engine written in Rust. It provides fast and scalable vector similarity search service with convenient API.","email":"info@qdrant.com","founders":[{"@type":"Person","name":"map[email:info@qdrant.tech name:Andrey Vasnetsov]"},{"@type":"Person","name":"Andre Zayarni"}],"foundingDate":"2021","keywords":["vector search engine","neural network","matching","SaaS","approximate nearest neighbor search","image search","recommender system","vectors","knn algorithm","hnsw","vector search","embeddings","similarity","simaes networks","BERT","transformer","word2vec","fasttext","Qdrant"],"legalName":"Qdrant Solutions GmbH","location":"Berlin, Germany","logo":"https://qdrant.tech/images/logo_with_text.png","name":"Qdrant","sameAs":["https://github.com/qdrant/qdrant","https://qdrant.to/discord","https://www.youtube.com/channel/UC6ftm8PwH1RU_LM1jwG0LQA","https://www.linkedin.com/company/qdrant/","https://twitter.com/qdrant_engine"],"url":"https://qdrant.tech"}]}</script><meta property="og:url" content="https://qdrant.tech/documentation/guides/distributed_deployment/"><meta property="og:type" content="website"><meta property="og:title" content="Distributed Deployment - Qdrant"><meta name=twitter:card content="summary_large_image"><meta name=twitter:domain content="qdrant"><meta name=twitter:url content="https://qdrant.tech/documentation/guides/distributed_deployment/"><meta name=twitter:title content="Distributed Deployment - Qdrant"><meta property="og:description" content="Qdrant is an Open-Source Vector Database and Vector Search Engine written in Rust. It provides fast and scalable vector similarity search service with convenient API."><meta name=twitter:description content="Qdrant is an Open-Source Vector Database and Vector Search Engine written in Rust. It provides fast and scalable vector similarity search service with convenient API."><meta name=image property="og:image" content="https://qdrant.tech/documentation/guides/distributed_deployment-social-preview.png"><meta name=image property="og:image:secure_url" content="https://qdrant.tech/documentation/guides/distributed_deployment-social-preview.png"><meta property="og:image:type" content="image/jpeg"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="630"><meta name=twitter:image:src content="https://qdrant.tech/documentation/guides/distributed_deployment-social-preview.png"><link rel=canonical href=https://qdrant.tech/documentation/guides/distributed_deployment/><script type=text/javascript src=//js-eu1.hsforms.net/forms/embed/v2.js></script><script src=https://qdrant.tech/js/documentation.min.594fc9226f6fb87b8c3b0cafb9d5c0b0bcd95f47d292b929aab04315e0506706b2f376dc4fae9961dc3082138cb19d45b2a3370ee8e881bbf4b8c91dcb735c32.js></script></head><body><main><header class=docs-header><div class="main-menu z-5"><a href=https://qdrant.tech/><div class=logo><img class=logo__img src=https://qdrant.tech/img/qdrant-logo.svg alt=logo></div></a><div class="d-flex d-xl-none justify-content-end align-items-center gap-4"><div class="d-block d-xl-none"><button role=button class=theme-switch></button></div><button type=button class=main-menu__trigger><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><path d="M1 12H23" stroke="#e1e5f0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M1 5H23" stroke="#e1e5f0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M1 19H23" stroke="#e1e5f0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button></div><ul class=main-menu__links><li class=main-menu__item><a class=menu-linkactive href=https://qdrant.tech/documentation/>Qdrant</a></li><li class=main-menu__item><a class=menu-link href=https://qdrant.tech/documentation/cloud-intro/>Cloud</a></li><li class=main-menu__item><a class=menu-link href=https://qdrant.tech/documentation/build/>Build</a></li><li class=main-menu__item><a class=menu-link href=https://qdrant.tech/articles/>Learn</a></li><li class=main-menu__item><a class=menu-link href=https://api.qdrant.tech/api-reference target=_blank>API Reference</a></li></ul><div class=main-menu__buttons><div class=main-menu__buttons-input><button class="qdr-search-input-btn q-input input_md input_light-bg" type=button name=search data-target=#searchModal>
Search</button></div><button role=button class=theme-switch></button>
<a data-metric-loc=nav href=https://cloud.qdrant.io/login class="menu-link mx-3" target=_blank>Log in</a>
<a data-metric-loc=nav href=https://cloud.qdrant.io/signup class="button button_contained button_sm" target=_blank>Start Free</a></div></div><div class=menu-mobile><div class=menu-mobile__header><div class=logo><img class=logo__img src=https://qdrant.tech/img/qdrant-logo.svg alt=logo></div><div class="d-flex d-xl-none justify-content-end align-items-center gap-4"><div class="d-block d-xl-none"><button role=button class=theme-switch></button></div><button type=button class=menu-mobile__close><svg width="24" height="24" viewBox="0 0 24 24" fill="none"><g id="Close"><path id="Vector" fill-rule="evenodd" clip-rule="evenodd" d="M19.778 5.63606C20.1685 5.24554 20.1685 4.61237 19.778 4.22185 19.3874 3.83132 18.7543 3.83132 18.3637 4.22185L11.9998 10.5858 5.63586 4.22185c-.39052-.39053-1.02369-.39053-1.41421.0C3.83112 4.61237 3.83112 5.24554 4.22165 5.63606L10.5856 12l-6.364 6.364C3.83108 18.7545 3.83108 19.3877 4.2216 19.7782 4.61213 20.1687 5.24529 20.1687 5.63582 19.7782l6.36398-6.364 6.364 6.364C18.7543 20.1687 19.3875 20.1687 19.778 19.7782 20.1685 19.3877 20.1685 18.7545 19.778 18.364L13.414 12l6.364-6.36394z" fill="#e1e5f0"/></g></svg></button></div></div><div class=main-menu__buttons-input><button class="qdr-search-input-btn q-input input_md input_light-bg" type=button name=search data-target=#searchModal>
Search</button></div><ul class=menu-mobile__items><li class=menu-mobile__item data-path=menu-0><div class=menu-mobile__item-content><a class=active href=https://qdrant.tech/documentation/><svg width="16" height="16" viewBox="0 0 16 16" fill="#e1e5f0"><g id="Menu/Documentation"><path id="Vector" fill-rule="evenodd" clip-rule="evenodd" d="M4.25 1c-1.10092.0-2.12247.23681-2.88689.64443C.620129 2.04063.0 2.67297.0 3.5v11c0 .2761.223858.5.5.5s.5-.2239.5-.5c0-.278.21937-.6456.83364-.9732C2.42647 13.2107 3.27992 13 4.25 13 5.22008 13 6.07353 13.2107 6.66636 13.5268c.61427.3276.83364.6952.83364.9732.0.2761.22386.5.5.5s.5-.2239.5-.5c0-.278.21937-.6456.833640000000001-.9732C9.92647 13.2107 10.7799 13 11.75 13S13.5735 13.2107 14.1664 13.5268C14.7806 13.8544 15 14.222 15 14.5c0 .2761.2239.5.5.5s.5-.2239.5-.5V3.5C16 2.67297 15.3799 2.04063 14.6369 1.64443 13.8725 1.23681 12.8509 1 11.75 1s-2.12247.23681-2.88689.64443C8.53799 1.8178 8.2364 2.03638 8 2.29671c-.2364-.26033-.53799-.47891-.86311-.65228C6.37247 1.23681 5.35092 1 4.25 1zM1.36311 12.6444C1.23778 12.7113 1.11595 12.7848 1 12.8649V3.5c0-.27797.21937-.64563.83364-.97318C2.42647 2.21069 3.27992 2 4.25 2c.97008.0 1.82353.21069 2.41636.52682C7.28063 2.85437 7.5 3.22203 7.5 3.5v9.3649C7.38405 12.7848 7.26222 12.7113 7.13689 12.6444 6.37247 12.2368 5.35092 12 4.25 12 3.14908 12 2.12753 12.2368 1.36311 12.6444zM8.5 12.8649C8.61595 12.7848 8.73778 12.7113 8.86311 12.6444 9.62753 12.2368 10.6491 12 11.75 12S13.8725 12.2368 14.6369 12.6444C14.7622 12.7113 14.8841 12.7848 15 12.8649V3.5C15 3.22203 14.7806 2.85437 14.1664 2.52682 13.5735 2.21069 12.7201 2 11.75 2s-1.82353.21069-2.41636.52682C8.71937 2.85437 8.5 3.22203 8.5 3.5v9.3649z"/></g></svg>
Qdrant</a></div></li><li class=menu-mobile__item data-path=menu-1><div class=menu-mobile__item-content><a href=https://qdrant.tech/documentation/cloud-intro/><svg width="16" height="16" viewBox="0 0 16 16" fill="#e1e5f0"><g id="Menu/Cloud"><path id="Vector" fill-rule="evenodd" clip-rule="evenodd" d="M7.5 2C4.57416 2 2.18128 4.28566 2.00983 7.16851.8403 7.57763.0 8.68965.0 10c0 1.6571 1.34286 3 3 3H13c1.6571.0 3-1.3429 3-3 0-1.65714-1.3429-3-3-3L12.9776 7.00009C12.7249 4.19714 10.3686 2 7.5 2zM3.00107 7.48137 3.00008 7.47308C3.01457 5.0006 5.02412 3 7.5 3c2.47599.0 4.4856 2.00079 4.4999 4.47342L11.9987 7.4836C11.9969 7.50027 11.995 7.52348 11.995 7.551 11.995 7.701 12.0623 7.84308 12.1785 7.93804 12.2946 8.03301 12.4472 8.07082 12.5942 8.04106 12.726 8.01438 12.8617 8 13 8c1.1049.0 2 .89514 2 2C15 11.1049 14.1049 12 13 12H3C1.89514 12 1 11.1049 1 10 1 9.03225 1.68901 8.22422 2.60364 8.04017 2.83708 7.9932 3.005 7.78812 3.005 7.55 3.005 7.52154 3.00291 7.49773 3.00107 7.48137z"/></g></svg>
Cloud</a></div></li><li class=menu-mobile__item data-path=menu-2><div class=menu-mobile__item-content><a href=https://qdrant.tech/documentation/build/><svg width="16" height="16" viewBox="0 0 16 16" fill="#e1e5f0"><g id="Menu/Blog"><path id="Union" fill-rule="evenodd" clip-rule="evenodd" d="M0 1.5C0 1.22386.223858 1 .5 1h5c.27614.0.5.22386.5.5v5c0 .27614-.22386.5-.5.5H.5C.223858 7 0 6.77614.0 6.5v-5zM1 2V6H5V2H1zm7 .5c0-.27614.22386-.5.5-.5h7c.2761.0.5.22386.5.5s-.2239.5-.5.5h-7C8.22386 3 8 2.77614 8 2.5zM8.5 6c-.27614.0-.5.22386-.5.5s.22386.5.5.5h7c.2761.0.5-.22386.5-.5s-.2239-.5-.5-.5h-7zM0 10.5c0-.2761.223858-.5.5-.5h15c.2761.0.5.2239.5.5s-.2239.5-.5.5H.5c-.276142.0-.5-.2239-.5-.5zM.5 14c-.276142.0-.5.2239-.5.5s.223858.5.5.5h15c.2761.0.5-.2239.5-.5s-.2239-.5-.5-.5H.5z"/></g></svg>
Build</a></div></li><li class=menu-mobile__item data-path=menu-3><div class=menu-mobile__item-content><a href=https://qdrant.tech/articles/><svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="#e1e5f0"><g id="Group"><path id="Vector" d="M10.084 1.84094l4.059 4.059" stroke-linecap="round" stroke-linejoin="round"/><path id="Vector_2" d="M8.49188 2.72406c-1.22044-.53042-2.59304-.59475-3.85774-.1808-1.2647.41395-2.33363 1.27742-3.00426 2.4268l2.34 2.34" stroke-linecap="round" stroke-linejoin="round"/><path id="Vector_3" d="M13.2657 7.47302C13.8062 8.69691 13.8769 10.077 13.4645 11.3497c-.4125 1.2728-1.2792 2.3491-2.4348 3.0233l-2.35001-2.35" stroke-linecap="round" stroke-linejoin="round"/><path id="Vector_4" d="M6.81217 13.049l-3.861-3.861S6.24917.983 15.5002.5c-.523 9.211-8.68803 12.549-8.68803 12.549z" stroke-linecap="round" stroke-linejoin="round"/><path id="Vector_5" d="M3.59892 12.4008C3.34181 12.1441 2.99331 12 2.62995 12c-.36335.0-.71186.1441-.96897.4008-.46665.4664-.63131 1.941-.65931 2.2322C.997021 14.6793 1.0021 14.726 1.01659 14.7701 1.03108 14.8143 1.05465 14.8549 1.08579 14.8895 1.11693 14.924 1.15495 14.9516 1.19741 14.9705 1.23987 14.9895 1.28583 14.9994 1.33233 14.9995 1.34298 15.0002 1.35367 15.0002 1.36433 14.9995 1.65565 14.9715 3.1316 14.8063 3.59759 14.3405 3.85501 14.0834 3.99975 13.7346 4 13.3709 4.00025 13.0072 3.85599 12.6582 3.59892 12.4008z" stroke-linecap="round" stroke-linejoin="round"/><path id="Vector_6" d="M9 8c.55228.0 1-.44772 1-1S9.55228 6 9 6 8 6.44772 8 7s.44772 1 1 1z"/></g></svg>
Learn</a></div></li><li class=menu-mobile__item data-path=menu-4><div class=menu-mobile__item-content><a href=https://api.qdrant.tech/api-reference target=_blank><svg width="16" height="16" viewBox="0 0 16 16" fill="#e1e5f0"><g id="Menu/Roadmap" clip-path="url(#clip0_7182_4311)"><path id="Vector" fill-rule="evenodd" clip-rule="evenodd" d="M13.5 1c-.8284.0-1.5.67157-1.5 1.5S12.6716 4 13.5 4 15 3.32843 15 2.5 14.3284 1 13.5 1zM11 2.5C11 1.11929 12.1193.0 13.5.0S16 1.11929 16 2.5 14.8807 5 13.5 5 11 3.88071 11 2.5zM2.5 12c-.82843.0-1.5.6716-1.5 1.5S1.67157 15 2.5 15 4 14.3284 4 13.5 3.32843 12 2.5 12zM0 13.5C0 12.1193 1.11929 11 2.5 11S5 12.1193 5 13.5 3.88071 16 2.5 16 0 14.8807.0 13.5zM3.65901 1.65901C4.08097 1.23705 4.65326 1 5.25 1s1.16903.23705 1.59099.65901C7.26295 2.08097 7.5 2.65326 7.5 3.25v9.5c0 .862.34241 1.6886.9519 2.2981C9.0614 15.6576 9.88805 16 10.75 16c.862.0 1.6886-.3424 2.2981-.9519S14 13.612 14 12.75V6.5c0-.27614-.2239-.5-.5-.5s-.5.22386-.5.5v6.25C13 13.3467 12.7629 13.919 12.341 14.341 11.919 14.7629 11.3467 15 10.75 15S9.58097 14.7629 9.15901 14.341C8.73705 13.919 8.5 13.3467 8.5 12.75V3.25C8.5 2.38805 8.15759 1.5614 7.5481.951903 6.9386.34241 6.11195.0 5.25.0S3.5614.34241 2.9519.951903C2.34241 1.5614 2 2.38805 2 3.25V9.5c0 .27614.22386.5.5.5s.5-.22386.5-.5V3.25c0-.59674.23705-1.16903.65901-1.59099z"/></g><defs><clipPath id="clip0_7182_4311"><rect width="16" height="16" fill="#fff"/></clipPath></defs></svg>
API Reference</a></div></li></ul><div class=docs-menu><div id=sidebar class=docs-menu__content><nav class=docs-menu__links><h3 class=docs-menu__links-title>Getting Started</h3><details class="docs-menu__links-group link-group"><summary class=docs-menu__links-group-heading><a href=https://qdrant.tech/documentation/overview/>What is Qdrant?</a></summary><nav><ul class=docs-menu__links-submenu><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/overview/vector-search/>Understanding Vector Search in Qdrant</a></li></ul></nav></details><div class=docs-menu__links-group><div class=docs-menu__links-group-heading><a href=https://qdrant.tech/documentation/quickstart/>Local Quickstart</a></div></div><div class=docs-menu__links-group><div class=docs-menu__links-group-heading><a href=https://qdrant.tech/documentation/interfaces/>API & SDKs</a></div></div><div class=docs-menu__links-group><div class=docs-menu__links-group-heading><a href=https://qdrant.tech/documentation/web-ui/>Qdrant Web UI</a></div></div><h3 class=docs-menu__links-title>User Manual</h3><details class="docs-menu__links-group link-group"><summary class=docs-menu__links-group-heading><a href=https://qdrant.tech/documentation/concepts/>Concepts</a></summary><nav><ul class=docs-menu__links-submenu><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/concepts/collections/>Collections</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/concepts/points/>Points</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/concepts/vectors/>Vectors</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/concepts/payload/>Payload</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/concepts/search/>Search</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/concepts/explore/>Explore</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/concepts/hybrid-queries/>Hybrid Queries</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/concepts/filtering/>Filtering</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/concepts/optimizer/>Optimizer</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/concepts/storage/>Storage</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/concepts/indexing/>Indexing</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/concepts/snapshots/>Snapshots</a></li></ul></nav></details><details class="docs-menu__links-group link-group active" open><summary class=docs-menu__links-group-heading><a href=https://qdrant.tech/documentation/guides/installation/>Guides</a></summary><nav><ul class=docs-menu__links-submenu><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/guides/installation/>Installation</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/guides/administration/>Administration</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/guides/running-with-gpu/>Running with GPU</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/guides/capacity-planning/>Capacity Planning</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/guides/optimize/>Optimize Performance</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/guides/multiple-partitions/>Multitenancy</a></li><li class="docs-menu__links-submenu-item
active"><a href=https://qdrant.tech/documentation/guides/distributed_deployment/>Distributed Deployment</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/guides/quantization/>Quantization</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/guides/monitoring/>Monitoring & Telemetry</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/guides/configuration/>Configuration</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/guides/security/>Security</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/guides/usage-statistics/>Usage Statistics</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/guides/common-errors/>Troubleshooting</a></li></ul></nav></details><h3 class=docs-menu__links-title>Ecosystem</h3><details class="docs-menu__links-group link-group"><summary class=docs-menu__links-group-heading><a href=https://qdrant.tech/documentation/fastembed/>FastEmbed</a></summary><nav><ul class=docs-menu__links-submenu><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/fastembed/fastembed-quickstart/>Quickstart</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/fastembed/fastembed-semantic-search/>FastEmbed & Qdrant</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/fastembed/fastembed-splade/>Working with SPLADE</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/fastembed/fastembed-colbert/>Working with ColBERT</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/fastembed/fastembed-rerankers/>Reranking with FastEmbed</a></li></ul></nav></details><div class="docs-menu__links-group external-link"><div class=docs-menu__links-group-heading><a href=https://github.com/qdrant/mcp-server-qdrant target=_blank>Qdrant MCP Server</a></div></div><h3 class=docs-menu__links-title>Tutorials</h3><details class="docs-menu__links-group link-group"><summary class=docs-menu__links-group-heading><a href=https://qdrant.tech/documentation/beginner-tutorials/>Vector Search Basics</a></summary><nav><ul class=docs-menu__links-submenu><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/beginner-tutorials/search-beginners/>Semantic Search 101</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/beginner-tutorials/neural-search/>Build a Neural Search Service</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/beginner-tutorials/hybrid-search-fastembed/>Setup Hybrid Search with FastEmbed</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/beginner-tutorials/retrieval-quality/>Measure Search Quality</a></li></ul></nav></details><details class="docs-menu__links-group link-group"><summary class=docs-menu__links-group-heading><a href=https://qdrant.tech/documentation/advanced-tutorials/>Advanced Retrieval</a></summary><nav><ul class=docs-menu__links-submenu><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/advanced-tutorials/reranking-hybrid-search/>Reranking in Hybrid Search</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/advanced-tutorials/code-search/>Search Through Your Codebase</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/advanced-tutorials/collaborative-filtering/>Build a Recommendation System with Collaborative Filtering</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/advanced-tutorials/pdf-retrieval-at-scale/>Scaling PDF Retrieval with Qdrant</a></li></ul></nav></details><details class="docs-menu__links-group link-group"><summary class=docs-menu__links-group-heading><a href=https://qdrant.tech/documentation/database-tutorials/>Using the Database</a></summary><nav><ul class=docs-menu__links-submenu><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/database-tutorials/bulk-upload/>Bulk Upload Vectors</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/database-tutorials/create-snapshot/>Create & Restore Snapshots</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/database-tutorials/large-scale-search/>Large Scale Search</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/database-tutorials/huggingface-datasets/>Load a HuggingFace Dataset</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/database-tutorials/async-api/>Build With Async API</a></li></ul></nav></details><h3 class=docs-menu__links-title>Support</h3><details class="docs-menu__links-group link-group"><summary class=docs-menu__links-group-heading><a href=https://qdrant.tech/documentation/faq/qdrant-fundamentals/>FAQ</a></summary><nav><ul class=docs-menu__links-submenu><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/faq/qdrant-fundamentals/>Qdrant Fundamentals</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/faq/database-optimization/>Database Optimization</a></li></ul></nav></details><div class="docs-menu__links-group external-link"><div class=docs-menu__links-group-heading><a href=https://github.com/qdrant/qdrant/releases target=_blank>Release Notes</a></div></div></nav></div></div></div></header><section class="docs documentation"><div class=documentation__container><div class="d-flex flex-column flex-xl-row"><div class=docs-menu><div id=sidebar class=docs-menu__content><nav class=docs-menu__links><h3 class=docs-menu__links-title>Getting Started</h3><details class="docs-menu__links-group link-group"><summary class=docs-menu__links-group-heading><a href=https://qdrant.tech/documentation/overview/>What is Qdrant?</a></summary><nav><ul class=docs-menu__links-submenu><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/overview/vector-search/>Understanding Vector Search in Qdrant</a></li></ul></nav></details><div class=docs-menu__links-group><div class=docs-menu__links-group-heading><a href=https://qdrant.tech/documentation/quickstart/>Local Quickstart</a></div></div><div class=docs-menu__links-group><div class=docs-menu__links-group-heading><a href=https://qdrant.tech/documentation/interfaces/>API & SDKs</a></div></div><div class=docs-menu__links-group><div class=docs-menu__links-group-heading><a href=https://qdrant.tech/documentation/web-ui/>Qdrant Web UI</a></div></div><h3 class=docs-menu__links-title>User Manual</h3><details class="docs-menu__links-group link-group"><summary class=docs-menu__links-group-heading><a href=https://qdrant.tech/documentation/concepts/>Concepts</a></summary><nav><ul class=docs-menu__links-submenu><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/concepts/collections/>Collections</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/concepts/points/>Points</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/concepts/vectors/>Vectors</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/concepts/payload/>Payload</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/concepts/search/>Search</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/concepts/explore/>Explore</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/concepts/hybrid-queries/>Hybrid Queries</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/concepts/filtering/>Filtering</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/concepts/optimizer/>Optimizer</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/concepts/storage/>Storage</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/concepts/indexing/>Indexing</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/concepts/snapshots/>Snapshots</a></li></ul></nav></details><details class="docs-menu__links-group link-group active" open><summary class=docs-menu__links-group-heading><a href=https://qdrant.tech/documentation/guides/installation/>Guides</a></summary><nav><ul class=docs-menu__links-submenu><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/guides/installation/>Installation</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/guides/administration/>Administration</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/guides/running-with-gpu/>Running with GPU</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/guides/capacity-planning/>Capacity Planning</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/guides/optimize/>Optimize Performance</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/guides/multiple-partitions/>Multitenancy</a></li><li class="docs-menu__links-submenu-item
active"><a href=https://qdrant.tech/documentation/guides/distributed_deployment/>Distributed Deployment</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/guides/quantization/>Quantization</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/guides/monitoring/>Monitoring & Telemetry</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/guides/configuration/>Configuration</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/guides/security/>Security</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/guides/usage-statistics/>Usage Statistics</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/guides/common-errors/>Troubleshooting</a></li></ul></nav></details><h3 class=docs-menu__links-title>Ecosystem</h3><details class="docs-menu__links-group link-group"><summary class=docs-menu__links-group-heading><a href=https://qdrant.tech/documentation/fastembed/>FastEmbed</a></summary><nav><ul class=docs-menu__links-submenu><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/fastembed/fastembed-quickstart/>Quickstart</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/fastembed/fastembed-semantic-search/>FastEmbed & Qdrant</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/fastembed/fastembed-splade/>Working with SPLADE</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/fastembed/fastembed-colbert/>Working with ColBERT</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/fastembed/fastembed-rerankers/>Reranking with FastEmbed</a></li></ul></nav></details><div class="docs-menu__links-group external-link"><div class=docs-menu__links-group-heading><a href=https://github.com/qdrant/mcp-server-qdrant target=_blank>Qdrant MCP Server</a></div></div><h3 class=docs-menu__links-title>Tutorials</h3><details class="docs-menu__links-group link-group"><summary class=docs-menu__links-group-heading><a href=https://qdrant.tech/documentation/beginner-tutorials/>Vector Search Basics</a></summary><nav><ul class=docs-menu__links-submenu><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/beginner-tutorials/search-beginners/>Semantic Search 101</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/beginner-tutorials/neural-search/>Build a Neural Search Service</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/beginner-tutorials/hybrid-search-fastembed/>Setup Hybrid Search with FastEmbed</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/beginner-tutorials/retrieval-quality/>Measure Search Quality</a></li></ul></nav></details><details class="docs-menu__links-group link-group"><summary class=docs-menu__links-group-heading><a href=https://qdrant.tech/documentation/advanced-tutorials/>Advanced Retrieval</a></summary><nav><ul class=docs-menu__links-submenu><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/advanced-tutorials/reranking-hybrid-search/>Reranking in Hybrid Search</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/advanced-tutorials/code-search/>Search Through Your Codebase</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/advanced-tutorials/collaborative-filtering/>Build a Recommendation System with Collaborative Filtering</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/advanced-tutorials/pdf-retrieval-at-scale/>Scaling PDF Retrieval with Qdrant</a></li></ul></nav></details><details class="docs-menu__links-group link-group"><summary class=docs-menu__links-group-heading><a href=https://qdrant.tech/documentation/database-tutorials/>Using the Database</a></summary><nav><ul class=docs-menu__links-submenu><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/database-tutorials/bulk-upload/>Bulk Upload Vectors</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/database-tutorials/create-snapshot/>Create & Restore Snapshots</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/database-tutorials/large-scale-search/>Large Scale Search</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/database-tutorials/huggingface-datasets/>Load a HuggingFace Dataset</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/database-tutorials/async-api/>Build With Async API</a></li></ul></nav></details><h3 class=docs-menu__links-title>Support</h3><details class="docs-menu__links-group link-group"><summary class=docs-menu__links-group-heading><a href=https://qdrant.tech/documentation/faq/qdrant-fundamentals/>FAQ</a></summary><nav><ul class=docs-menu__links-submenu><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/faq/qdrant-fundamentals/>Qdrant Fundamentals</a></li><li class=docs-menu__links-submenu-item><a href=https://qdrant.tech/documentation/faq/database-optimization/>Database Optimization</a></li></ul></nav></details><div class="docs-menu__links-group external-link"><div class=docs-menu__links-group-heading><a href=https://github.com/qdrant/qdrant/releases target=_blank>Release Notes</a></div></div></nav></div></div><div class=documentation__content><div class=documentation__content-wrapper><div class=documentation__article-wrapper><ul class=docs-breadcrumbs><li class=docs-breadcrumbs__crumb><a href=https://qdrant.tech/documentation/>Documentation</a></li><li class=docs-breadcrumbs__crumb-separator></li><li class=docs-breadcrumbs__crumb><a href=https://qdrant.tech/documentation/guides/>Guides</a></li><li class=docs-breadcrumbs__crumb-separator></li><li class=docs-breadcrumbs__crumb>Distributed Deployment</li></ul><article class=documentation-article><h1 id=distributed-deployment>Distributed deployment</h1><p>Since version v0.8.0 Qdrant supports a distributed deployment mode.
In this mode, multiple Qdrant services communicate with each other to distribute the data across the peers to extend the storage capabilities and increase stability.</p><h2 id=how-many-qdrant-nodes-should-i-run>How many Qdrant nodes should I run?</h2><p>The ideal number of Qdrant nodes depends on how much you value cost-saving, resilience, and performance/scalability in relation to each other.</p><ul><li><p><strong>Prioritizing cost-saving</strong>: If cost is most important to you, run a single Qdrant node. This is not recommended for production environments. Drawbacks:</p><ul><li>Resilience: Users will experience downtime during node restarts, and recovery is not possible unless you have backups or snapshots.</li><li>Performance: Limited to the resources of a single server.</li></ul></li><li><p><strong>Prioritizing resilience</strong>: If resilience is most important to you, run a Qdrant cluster with three or more nodes and two or more shard replicas. Clusters with three or more nodes and replication can perform all operations even while one node is down. Additionally, they gain performance benefits from load-balancing and they can recover from the permanent loss of one node without the need for backups or snapshots (but backups are still strongly recommended). This is most recommended for production environments. Drawbacks:</p><ul><li>Cost: Larger clusters are more costly than smaller clusters, which is the only drawback of this configuration.</li></ul></li><li><p><strong>Balancing cost, resilience, and performance</strong>: Running a two-node Qdrant cluster with replicated shards allows the cluster to respond to most read/write requests even when one node is down, such as during maintenance events. Having two nodes also means greater performance than a single-node cluster while still being cheaper than a three-node cluster. Drawbacks:</p><ul><li>Resilience (uptime): The cluster cannot perform operations on collections when one node is down. Those operations require >50% of nodes to be running, so this is only possible in a 3+ node cluster. Since creating, editing, and deleting collections are usually rare operations, many users find this drawback to be negligible.</li><li>Resilience (data integrity): If the data on one of the two nodes is permanently lost or corrupted, it cannot be recovered aside from snapshots or backups. Only 3+ node clusters can recover from the permanent loss of a single node since recovery operations require >50% of the cluster to be healthy.</li><li>Cost: Replicating your shards requires storing two copies of your data.</li><li>Performance: The maximum performance of a Qdrant cluster increases as you add more nodes.</li></ul></li></ul><p>In summary, single-node clusters are best for non-production workloads, replicated 3+ node clusters are the gold standard, and replicated 2-node clusters strike a good balance.</p><h2 id=enabling-distributed-mode-in-self-hosted-qdrant>Enabling distributed mode in self-hosted Qdrant</h2><p>To enable distributed deployment - enable the cluster mode in the <a href=https://qdrant.tech/documentation/guides/configuration/>configuration</a> or using the ENV variable: <code>QDRANT__CLUSTER__ENABLED=true</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>cluster</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Use `enabled: true` to run Qdrant in distributed deployment mode</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Configuration of the inter-cluster communication</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>p2p</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Port for internal communication between peers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>6335</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=c># Configuration related to distributed consensus algorithm</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>consensus</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># How frequently peers should ping each other.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># Setting this parameter to lower value will allow consensus</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># to detect disconnected node earlier, but too frequent</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># tick period may create significant network and CPU overhead.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c># We encourage you NOT to change this parameter unless you know what you are doing.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>tick_period_ms</span><span class=p>:</span><span class=w> </span><span class=m>100</span><span class=w>
</span></span></span></code></pre></div><p>By default, Qdrant will use port <code>6335</code> for its internal communication.
All peers should be accessible on this port from within the cluster, but make sure to isolate this port from outside access, as it might be used to perform write operations.</p><p>Additionally, you must provide the <code>--uri</code> flag to the first peer so it can tell other nodes how it should be reached:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./qdrant --uri <span class=s1>&#39;http://qdrant_node_1:6335&#39;</span>
</span></span></code></pre></div><p>Subsequent peers in a cluster must know at least one node of the existing cluster to synchronize through it with the rest of the cluster.</p><p>To do this, they need to be provided with a bootstrap URL:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./qdrant --bootstrap <span class=s1>&#39;http://qdrant_node_1:6335&#39;</span>
</span></span></code></pre></div><p>The URL of the new peers themselves will be calculated automatically from the IP address of their request.
But it is also possible to provide them individually using the <code>--uri</code> argument.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>USAGE:
</span></span><span class=line><span class=cl>    qdrant [OPTIONS]
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>OPTIONS:
</span></span><span class=line><span class=cl>        --bootstrap &lt;URI&gt;
</span></span><span class=line><span class=cl>            Uri of the peer to bootstrap from in case of multi-peer deployment. If not specified -
</span></span><span class=line><span class=cl>            this peer will be considered as a first in a new deployment
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        --uri &lt;URI&gt;
</span></span><span class=line><span class=cl>            Uri of this peer. Other peers should be able to reach it by this uri.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            This value has to be supplied if this is the first peer in a new deployment.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            In case this is not the first peer and it bootstraps the value is optional. If not
</span></span><span class=line><span class=cl>            supplied then qdrant will take internal grpc port from config and derive the IP address
</span></span><span class=line><span class=cl>            of this peer on bootstrap peer (receiving side)
</span></span></code></pre></div><p>After a successful synchronization you can observe the state of the cluster through the <a href=https://api.qdrant.tech/master/api-reference/distributed/cluster-status target=_blank rel="noopener nofollow">REST API</a>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>GET /cluster
</span></span></span></code></pre></div><p>Example result:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;result&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;enabled&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;peer_id&#34;</span><span class=p>:</span> <span class=mi>11532566549086892000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;peers&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;9834046559507417430&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;uri&#34;</span><span class=p>:</span> <span class=s2>&#34;http://172.18.0.3:6335/&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>},</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;11532566549086892528&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;uri&#34;</span><span class=p>:</span> <span class=s2>&#34;http://qdrant_node_1:6335/&#34;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;raft_info&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;term&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;commit&#34;</span><span class=p>:</span> <span class=mi>4</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;pending_operations&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;leader&#34;</span><span class=p>:</span> <span class=mi>11532566549086892000</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nt>&#34;role&#34;</span><span class=p>:</span> <span class=s2>&#34;Leader&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;ok&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;time&#34;</span><span class=p>:</span> <span class=mf>5.731e-06</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Note that enabling distributed mode does not automatically replicate your data. See the section on <a href=#making-use-of-a-new-distributed-qdrant-cluster>making use of a new distributed Qdrant cluster</a> for the next steps.</p><h2 id=enabling-distributed-mode-in-qdrant-cloud>Enabling distributed mode in Qdrant Cloud</h2><p>For best results, first ensure your cluster is running Qdrant v1.7.4 or higher. Older versions of Qdrant do support distributed mode, but improvements in v1.7.4 make distributed clusters more resilient during outages.</p><p>In the <a href=https://cloud.qdrant.io/ target=_blank rel="noopener nofollow">Qdrant Cloud console</a>, click &ldquo;Scale Up&rdquo; to increase your cluster size to >1. Qdrant Cloud configures the distributed mode settings automatically.</p><p>After the scale-up process completes, you will have a new empty node running alongside your existing node(s). To replicate data into this new empty node, see the next section.</p><h2 id=making-use-of-a-new-distributed-qdrant-cluster>Making use of a new distributed Qdrant cluster</h2><p>When you enable distributed mode and scale up to two or more nodes, your data does not move to the new node automatically; it starts out empty. To make use of your new empty node, do one of the following:</p><ul><li>Create a new replicated collection by setting the <a href=#replication-factor>replication_factor</a> to 2 or more and setting the <a href=#choosing-the-right-number-of-shards>number of shards</a> to a multiple of your number of nodes.</li><li>If you have an existing collection which does not contain enough shards for each node, you must create a new collection as described in the previous bullet point.</li><li>If you already have enough shards for each node and you merely need to replicate your data, follow the directions for <a href=#creating-new-shard-replicas>creating new shard replicas</a>.</li><li>If you already have enough shards for each node and your data is already replicated, you can move data (without replicating it) onto the new node(s) by <a href=#moving-shards>moving shards</a>.</li></ul><h2 id=raft>Raft</h2><p>Qdrant uses the <a href=https://raft.github.io/ target=_blank rel="noopener nofollow">Raft</a> consensus protocol to maintain consistency regarding the cluster topology and the collections structure.</p><p>Operations on points, on the other hand, do not go through the consensus infrastructure.
Qdrant is not intended to have strong transaction guarantees, which allows it to perform point operations with low overhead.
In practice, it means that Qdrant does not guarantee atomic distributed updates but allows you to wait until the <a href=https://qdrant.tech/documentation/concepts/points/#awaiting-result>operation is complete</a> to see the results of your writes.</p><p>Operations on collections, on the contrary, are part of the consensus which guarantees that all operations are durable and eventually executed by all nodes.
In practice it means that a majority of nodes agree on what operations should be applied before the service will perform them.</p><p>Practically, it means that if the cluster is in a transition state - either electing a new leader after a failure or starting up, the collection update operations will be denied.</p><p>You may use the cluster <a href=https://api.qdrant.tech/master/api-reference/distributed/cluster-status target=_blank rel="noopener nofollow">REST API</a> to check the state of the consensus.</p><h2 id=sharding>Sharding</h2><p>A Collection in Qdrant is made of one or more shards.
A shard is an independent store of points which is able to perform all operations provided by collections.
There are two methods of distributing points across shards:</p><ul><li><p><strong>Automatic sharding</strong>: Points are distributed among shards by using a <a href=https://en.wikipedia.org/wiki/Consistent_hashing target=_blank rel="noopener nofollow">consistent hashing</a> algorithm, so that shards are managing non-intersecting subsets of points. This is the default behavior.</p></li><li><p><strong>User-defined sharding</strong>: <em>Available as of v1.7.0</em> - Each point is uploaded to a specific shard, so that operations can hit only the shard or shards they need. Even with this distribution, shards still ensure having non-intersecting subsets of points. <a href=#user-defined-sharding>See more&mldr;</a></p></li></ul><p>Each node knows where all parts of the collection are stored through the <a href=#raft>consensus protocol</a>, so when you send a search request to one Qdrant node, it automatically queries all other nodes to obtain the full search result.</p><h3 id=choosing-the-right-number-of-shards>Choosing the right number of shards</h3><p>When you create a collection, Qdrant splits the collection into <code>shard_number</code> shards. If left unset, <code>shard_number</code> is set to the number of nodes in your cluster when the collection was created. The <code>shard_number</code> cannot be changed without recreating the collection.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>PUT /collections/{collection_name}
</span></span></span><span class=line><span class=cl><span class=err>{
</span></span></span><span class=line><span class=cl><span class=err>    &#34;vectors&#34;: {
</span></span></span><span class=line><span class=cl><span class=err>      &#34;size&#34;: 300,
</span></span></span><span class=line><span class=cl><span class=err>      &#34;distance&#34;: &#34;Cosine&#34;
</span></span></span><span class=line><span class=cl><span class=err>    },
</span></span></span><span class=line><span class=cl><span class=err>    &#34;shard_number&#34;: 6
</span></span></span><span class=line><span class=cl><span class=err>}
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>qdrant_client</span> <span class=kn>import</span> <span class=n>QdrantClient</span><span class=p>,</span> <span class=n>models</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>QdrantClient</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=s2>&#34;http://localhost:6333&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>client</span><span class=o>.</span><span class=n>create_collection</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>collection_name</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>{collection_name}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>vectors_config</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>VectorParams</span><span class=p>(</span><span class=n>size</span><span class=o>=</span><span class=mi>300</span><span class=p>,</span> <span class=n>distance</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>Distance</span><span class=o>.</span><span class=n>COSINE</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>shard_number</span><span class=o>=</span><span class=mi>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>QdrantClient</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;@qdrant/js-client-rest&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>client</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>QdrantClient</span><span class=p>({</span> <span class=nx>host</span><span class=o>:</span> <span class=s2>&#34;localhost&#34;</span><span class=p>,</span> <span class=nx>port</span>: <span class=kt>6333</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>client</span><span class=p>.</span><span class=nx>createCollection</span><span class=p>(</span><span class=s2>&#34;{collection_name}&#34;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>vectors</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>size</span>: <span class=kt>300</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>distance</span><span class=o>:</span> <span class=s2>&#34;Cosine&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>shard_number</span>: <span class=kt>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>qdrant_client</span>::<span class=n>qdrant</span>::<span class=p>{</span><span class=n>CreateCollectionBuilder</span><span class=p>,</span><span class=w> </span><span class=n>Distance</span><span class=p>,</span><span class=w> </span><span class=n>VectorParamsBuilder</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>qdrant_client</span>::<span class=n>Qdrant</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>client</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Qdrant</span>::<span class=n>from_url</span><span class=p>(</span><span class=s>&#34;http://localhost:6334&#34;</span><span class=p>).</span><span class=n>build</span><span class=p>()</span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>client</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=n>create_collection</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CreateCollectionBuilder</span>::<span class=n>new</span><span class=p>(</span><span class=s>&#34;{collection_name}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>vectors_config</span><span class=p>(</span><span class=n>VectorParamsBuilder</span>::<span class=n>new</span><span class=p>(</span><span class=mi>300</span><span class=p>,</span><span class=w> </span><span class=n>Distance</span>::<span class=n>Cosine</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>shard_number</span><span class=p>(</span><span class=mi>6</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=k>await</span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.QdrantClient</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.QdrantGrpcClient</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Collections.CreateCollection</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Collections.Distance</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Collections.VectorParams</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Collections.VectorsConfig</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>QdrantClient</span><span class=w> </span><span class=n>client</span><span class=w> </span><span class=o>=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>new</span><span class=w> </span><span class=n>QdrantClient</span><span class=p>(</span><span class=n>QdrantGrpcClient</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>(</span><span class=s>&#34;localhost&#34;</span><span class=p>,</span><span class=w> </span><span class=n>6334</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>).</span><span class=na>build</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>client</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>createCollectionAsync</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CreateCollection</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setCollectionName</span><span class=p>(</span><span class=s>&#34;{collection_name}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setVectorsConfig</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>VectorsConfig</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>setParams</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>VectorParams</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>setSize</span><span class=p>(</span><span class=n>300</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>setDistance</span><span class=p>(</span><span class=n>Distance</span><span class=p>.</span><span class=na>Cosine</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setShardNumber</span><span class=p>(</span><span class=n>6</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>Qdrant.Client</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>Qdrant.Client.Grpc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>var</span> <span class=n>client</span> <span class=p>=</span> <span class=k>new</span> <span class=n>QdrantClient</span><span class=p>(</span><span class=s>&#34;localhost&#34;</span><span class=p>,</span> <span class=m>6334</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>await</span> <span class=n>client</span><span class=p>.</span><span class=n>CreateCollectionAsync</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=n>collectionName</span><span class=p>:</span> <span class=s>&#34;{collection_name}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=n>vectorsConfig</span><span class=p>:</span> <span class=k>new</span> <span class=n>VectorParams</span> <span class=p>{</span> <span class=n>Size</span> <span class=p>=</span> <span class=m>300</span><span class=p>,</span> <span class=n>Distance</span> <span class=p>=</span> <span class=n>Distance</span><span class=p>.</span><span class=n>Cosine</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=n>shardNumber</span><span class=p>:</span> <span class=m>6</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/qdrant/go-client/qdrant&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>client</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nf>NewClient</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>Config</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Host</span><span class=p>:</span> <span class=s>&#34;localhost&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>Port</span><span class=p>:</span> <span class=mi>6334</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>client</span><span class=p>.</span><span class=nf>CreateCollection</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>(),</span> <span class=o>&amp;</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>CreateCollection</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>CollectionName</span><span class=p>:</span> <span class=s>&#34;{collection_name}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>VectorsConfig</span><span class=p>:</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nf>NewVectorsConfig</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>VectorParams</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Size</span><span class=p>:</span>     <span class=mi>300</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Distance</span><span class=p>:</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nx>Distance_Cosine</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>}),</span>
</span></span><span class=line><span class=cl>	<span class=nx>ShardNumber</span><span class=p>:</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nf>PtrOf</span><span class=p>(</span><span class=nb>uint32</span><span class=p>(</span><span class=mi>6</span><span class=p>)),</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><p>To ensure all nodes in your cluster are evenly utilized, the number of shards must be a multiple of the number of nodes you are currently running in your cluster.</p><blockquote><p>Aside: Advanced use cases such as multitenancy may require an uneven distribution of shards. See <a href=https://qdrant.tech/articles/multitenancy/>Multitenancy</a>.</p></blockquote><p>We recommend creating at least 2 shards per node to allow future expansion without having to re-shard. <a href=#resharding>Resharding</a> is possible when using our cloud offering, but should be avoided if hosting elsewhere as it would require creating a new collection.</p><p>If you anticipate a lot of growth, we recommend 12 shards since you can expand from 1 node up to 2, 3, 6, and 12 nodes without having to re-shard. Having more than 12 shards in a small cluster may not be worth the performance overhead.</p><p>Shards are evenly distributed across all existing nodes when a collection is first created, but Qdrant does not automatically rebalance shards if your cluster size or replication factor changes (since this is an expensive operation on large clusters). See the next section for how to move shards after scaling operations.</p><h3 id=resharding>Resharding</h3><p><em>Available as of v1.13.0 in Cloud</em></p><p>Resharding allows you to change the number of shards in your existing collections if you&rsquo;re hosting with our <a href=https://qdrant.tech/documentation/cloud-intro/>Cloud</a> offering.</p><p>Resharding can change the number of shards both up and down, without having to recreate the collection from scratch.</p><p>Please refer to the <a href=https://qdrant.tech/documentation/cloud/cluster-scaling/#resharding>Resharding</a> section in our cloud documentation for more details.</p><h3 id=moving-shards>Moving shards</h3><p><em>Available as of v0.9.0</em></p><p>Qdrant allows moving shards between nodes in the cluster and removing nodes from the cluster. This functionality unlocks the ability to dynamically scale the cluster size without downtime. It also allows you to upgrade or migrate nodes without downtime.</p><p>Qdrant provides the information regarding the current shard distribution in the cluster with the <a href=https://api.qdrant.tech/master/api-reference/distributed/collection-cluster-info target=_blank rel="noopener nofollow">Collection Cluster info API</a>.</p><p>Use the <a href=https://api.qdrant.tech/master/api-reference/distributed/update-collection-cluster target=_blank rel="noopener nofollow">Update collection cluster setup API</a> to initiate the shard transfer:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>POST /collections/{collection_name}/cluster
</span></span></span><span class=line><span class=cl><span class=err>{
</span></span></span><span class=line><span class=cl><span class=err>    &#34;move_shard&#34;: {
</span></span></span><span class=line><span class=cl><span class=err>        &#34;shard_id&#34;: 0,
</span></span></span><span class=line><span class=cl><span class=err>        &#34;from_peer_id&#34;: 381894127,
</span></span></span><span class=line><span class=cl><span class=err>        &#34;to_peer_id&#34;: 467122995
</span></span></span><span class=line><span class=cl><span class=err>    }
</span></span></span><span class=line><span class=cl><span class=err>}
</span></span></span></code></pre></div><aside role=status>You likely want to select a specific <a href=#shard-transfer-method>shard transfer method</a> to get desired performance and guarantees.</aside><p>After the transfer is initiated, the service will process it based on the used
<a href=#shard-transfer-method>transfer method</a> keeping both shards in sync. Once the
transfer is completed, the old shard is deleted from the source node.</p><p>In case you want to downscale the cluster, you can move all shards away from a peer and then remove the peer using the <a href=https://api.qdrant.tech/master/api-reference/distributed/remove-peer target=_blank rel="noopener nofollow">remove peer API</a>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>DELETE /cluster/peer/{peer_id}
</span></span></span></code></pre></div><p>After that, Qdrant will exclude the node from the consensus, and the instance will be ready for shutdown.</p><h3 id=user-defined-sharding>User-defined sharding</h3><p><em>Available as of v1.7.0</em></p><p>Qdrant allows you to specify the shard for each point individually. This feature is useful if you want to control the shard placement of your data, so that operations can hit only the subset of shards they actually need. In big clusters, this can significantly improve the performance of operations that do not require the whole collection to be scanned.</p><p>A clear use-case for this feature is managing a multi-tenant collection, where each tenant (let it be a user or organization) is assumed to be segregated, so they can have their data stored in separate shards.</p><p>To enable user-defined sharding, set <code>sharding_method</code> to <code>custom</code> during collection creation:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>PUT /collections/{collection_name}
</span></span></span><span class=line><span class=cl><span class=err>{
</span></span></span><span class=line><span class=cl><span class=err>    &#34;shard_number&#34;: 1,
</span></span></span><span class=line><span class=cl><span class=err>    &#34;sharding_method&#34;: &#34;custom&#34;
</span></span></span><span class=line><span class=cl><span class=err>    // ... other collection parameters
</span></span></span><span class=line><span class=cl><span class=err>}
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>qdrant_client</span> <span class=kn>import</span> <span class=n>QdrantClient</span><span class=p>,</span> <span class=n>models</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>QdrantClient</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=s2>&#34;http://localhost:6333&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>client</span><span class=o>.</span><span class=n>create_collection</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>collection_name</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>{collection_name}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>shard_number</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>sharding_method</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>ShardingMethod</span><span class=o>.</span><span class=n>CUSTOM</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=c1># ... other collection parameters</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>client</span><span class=o>.</span><span class=n>create_shard_key</span><span class=p>(</span><span class=s2>&#34;</span><span class=si>{collection_name}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=s2>&#34;</span><span class=si>{shard_key}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>QdrantClient</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;@qdrant/js-client-rest&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>client</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>QdrantClient</span><span class=p>({</span> <span class=nx>host</span><span class=o>:</span> <span class=s2>&#34;localhost&#34;</span><span class=p>,</span> <span class=nx>port</span>: <span class=kt>6333</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>client</span><span class=p>.</span><span class=nx>createCollection</span><span class=p>(</span><span class=s2>&#34;{collection_name}&#34;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>shard_number</span>: <span class=kt>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>sharding_method</span><span class=o>:</span> <span class=s2>&#34;custom&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ... other collection parameters
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>client</span><span class=p>.</span><span class=nx>createShardKey</span><span class=p>(</span><span class=s2>&#34;{collection_name}&#34;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>shard_key</span><span class=o>:</span> <span class=s2>&#34;{shard_key}&#34;</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>qdrant_client</span>::<span class=n>qdrant</span>::<span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>CreateCollectionBuilder</span><span class=p>,</span><span class=w> </span><span class=n>CreateShardKeyBuilder</span><span class=p>,</span><span class=w> </span><span class=n>CreateShardKeyRequestBuilder</span><span class=p>,</span><span class=w> </span><span class=n>Distance</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>ShardingMethod</span><span class=p>,</span><span class=w> </span><span class=n>VectorParamsBuilder</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>qdrant_client</span>::<span class=n>Qdrant</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>client</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Qdrant</span>::<span class=n>from_url</span><span class=p>(</span><span class=s>&#34;http://localhost:6334&#34;</span><span class=p>).</span><span class=n>build</span><span class=p>()</span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>client</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=n>create_collection</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CreateCollectionBuilder</span>::<span class=n>new</span><span class=p>(</span><span class=s>&#34;{collection_name}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>vectors_config</span><span class=p>(</span><span class=n>VectorParamsBuilder</span>::<span class=n>new</span><span class=p>(</span><span class=mi>300</span><span class=p>,</span><span class=w> </span><span class=n>Distance</span>::<span class=n>Cosine</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>shard_number</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>sharding_method</span><span class=p>(</span><span class=n>ShardingMethod</span>::<span class=n>Custom</span><span class=p>.</span><span class=n>into</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=k>await</span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>client</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=n>create_shard_key</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CreateShardKeyRequestBuilder</span>::<span class=n>new</span><span class=p>(</span><span class=s>&#34;{collection_name}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>request</span><span class=p>(</span><span class=n>CreateShardKeyBuilder</span>::<span class=n>default</span><span class=p>().</span><span class=n>shard_key</span><span class=p>(</span><span class=s>&#34;{shard_key&#34;</span><span class=p>.</span><span class=n>to_string</span><span class=p>())),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=k>await</span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import static</span><span class=w> </span><span class=nn>io.qdrant.client.ShardKeyFactory.shardKey</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.QdrantClient</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.QdrantGrpcClient</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Collections.CreateCollection</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Collections.ShardingMethod</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Collections.CreateShardKey</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Collections.CreateShardKeyRequest</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>QdrantClient</span><span class=w> </span><span class=n>client</span><span class=w> </span><span class=o>=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>new</span><span class=w> </span><span class=n>QdrantClient</span><span class=p>(</span><span class=n>QdrantGrpcClient</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>(</span><span class=s>&#34;localhost&#34;</span><span class=p>,</span><span class=w> </span><span class=n>6334</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>).</span><span class=na>build</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>client</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>createCollectionAsync</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CreateCollection</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setCollectionName</span><span class=p>(</span><span class=s>&#34;{collection_name}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=c1>// ... other collection parameters</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setShardNumber</span><span class=p>(</span><span class=n>1</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setShardingMethod</span><span class=p>(</span><span class=n>ShardingMethod</span><span class=p>.</span><span class=na>Custom</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>client</span><span class=p>.</span><span class=na>createShardKeyAsync</span><span class=p>(</span><span class=n>CreateShardKeyRequest</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>setCollectionName</span><span class=p>(</span><span class=s>&#34;{collection_name}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>setRequest</span><span class=p>(</span><span class=n>CreateShardKey</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=p>.</span><span class=na>setShardKey</span><span class=p>(</span><span class=n>shardKey</span><span class=p>(</span><span class=s>&#34;{shard_key}&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                </span><span class=p>.</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>()).</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>Qdrant.Client</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>Qdrant.Client.Grpc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>var</span> <span class=n>client</span> <span class=p>=</span> <span class=k>new</span> <span class=n>QdrantClient</span><span class=p>(</span><span class=s>&#34;localhost&#34;</span><span class=p>,</span> <span class=m>6334</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>await</span> <span class=n>client</span><span class=p>.</span><span class=n>CreateCollectionAsync</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=n>collectionName</span><span class=p>:</span> <span class=s>&#34;{collection_name}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=c1>// ... other collection parameters</span>
</span></span><span class=line><span class=cl>	<span class=n>shardNumber</span><span class=p>:</span> <span class=m>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=n>shardingMethod</span><span class=p>:</span> <span class=n>ShardingMethod</span><span class=p>.</span><span class=n>Custom</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>await</span> <span class=n>client</span><span class=p>.</span><span class=n>CreateShardKeyAsync</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=s>&#34;{collection_name}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=k>new</span> <span class=n>CreateShardKey</span> <span class=p>{</span> <span class=n>ShardKey</span> <span class=p>=</span> <span class=k>new</span> <span class=n>ShardKey</span> <span class=p>{</span> <span class=n>Keyword</span> <span class=p>=</span> <span class=s>&#34;{shard_key}&#34;</span><span class=p>,</span> <span class=p>}</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/qdrant/go-client/qdrant&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>client</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nf>NewClient</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>Config</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Host</span><span class=p>:</span> <span class=s>&#34;localhost&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>Port</span><span class=p>:</span> <span class=mi>6334</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>client</span><span class=p>.</span><span class=nf>CreateCollection</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>(),</span> <span class=o>&amp;</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>CreateCollection</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>CollectionName</span><span class=p>:</span> <span class=s>&#34;{collection_name}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=c1>// ... other collection parameters</span>
</span></span><span class=line><span class=cl>	<span class=nx>ShardNumber</span><span class=p>:</span>    <span class=nx>qdrant</span><span class=p>.</span><span class=nf>PtrOf</span><span class=p>(</span><span class=nb>uint32</span><span class=p>(</span><span class=mi>1</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>	<span class=nx>ShardingMethod</span><span class=p>:</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nx>ShardingMethod_Custom</span><span class=p>.</span><span class=nf>Enum</span><span class=p>(),</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>client</span><span class=p>.</span><span class=nf>CreateShardKey</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>(),</span> <span class=s>&#34;{collection_name}&#34;</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>CreateShardKey</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>ShardKey</span><span class=p>:</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nf>NewShardKey</span><span class=p>(</span><span class=s>&#34;{shard_key}&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><p>In this mode, the <code>shard_number</code> means the number of shards per shard key, where points will be distributed evenly. For example, if you have 10 shard keys and a collection config with these settings:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;shard_number&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;sharding_method&#34;</span><span class=p>:</span> <span class=s2>&#34;custom&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;replication_factor&#34;</span><span class=p>:</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Then you will have <code>1 * 10 * 2 = 20</code> total physical shards in the collection.</p><p>Physical shards require a large amount of resources, so make sure your custom sharding key has a low cardinality.</p><p>For large cardinality keys, it is recommended to use <a href=https://qdrant.tech/documentation/guides/multiple-partitions/#partition-by-payload>partition by payload</a> instead.</p><p>To specify the shard for each point, you need to provide the <code>shard_key</code> field in the upsert request:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>PUT /collections/{collection_name}/points
</span></span></span><span class=line><span class=cl><span class=err>{
</span></span></span><span class=line><span class=cl><span class=err>    &#34;points&#34;: [
</span></span></span><span class=line><span class=cl><span class=err>        {
</span></span></span><span class=line><span class=cl><span class=err>            &#34;id&#34;: 1111,
</span></span></span><span class=line><span class=cl><span class=err>            &#34;vector&#34;: [0.1, 0.2, 0.3]
</span></span></span><span class=line><span class=cl><span class=err>        },
</span></span></span><span class=line><span class=cl><span class=err>    ]
</span></span></span><span class=line><span class=cl><span class=err>    &#34;shard_key&#34;: &#34;user_1&#34;
</span></span></span><span class=line><span class=cl><span class=err>}
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>qdrant_client</span> <span class=kn>import</span> <span class=n>QdrantClient</span><span class=p>,</span> <span class=n>models</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>QdrantClient</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=s2>&#34;http://localhost:6333&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>client</span><span class=o>.</span><span class=n>upsert</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>collection_name</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>{collection_name}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>points</span><span class=o>=</span><span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=n>models</span><span class=o>.</span><span class=n>PointStruct</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=nb>id</span><span class=o>=</span><span class=mi>1111</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>vector</span><span class=o>=</span><span class=p>[</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>,</span> <span class=mf>0.3</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>shard_key_selector</span><span class=o>=</span><span class=s2>&#34;user_1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=nx>client</span><span class=p>.</span><span class=nx>upsert</span><span class=p>(</span><span class=s2>&#34;{collection_name}&#34;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>points</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>id</span>: <span class=kt>1111</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=nx>vector</span><span class=o>:</span> <span class=p>[</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>,</span> <span class=mf>0.3</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nx>shard_key</span><span class=o>:</span> <span class=s2>&#34;user_1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>qdrant_client</span>::<span class=n>qdrant</span>::<span class=p>{</span><span class=n>PointStruct</span><span class=p>,</span><span class=w> </span><span class=n>UpsertPointsBuilder</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>qdrant_client</span>::<span class=n>Payload</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>client</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=n>upsert_points</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UpsertPointsBuilder</span>::<span class=n>new</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;{collection_name}&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=fm>vec!</span><span class=p>[</span><span class=n>PointStruct</span>::<span class=n>new</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=mi>111</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=fm>vec!</span><span class=p>[</span><span class=mf>0.1</span><span class=p>,</span><span class=w> </span><span class=mf>0.2</span><span class=p>,</span><span class=w> </span><span class=mf>0.3</span><span class=p>],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>Payload</span>::<span class=n>default</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>)],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=n>shard_key_selector</span><span class=p>(</span><span class=s>&#34;user_1&#34;</span><span class=p>.</span><span class=n>to_string</span><span class=p>()),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=k>await</span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>java.util.List</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>io.qdrant.client.PointIdFactory.id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>io.qdrant.client.ShardKeySelectorFactory.shardKeySelector</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>io.qdrant.client.VectorsFactory.vectors</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.QdrantClient</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.QdrantGrpcClient</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Points.PointStruct</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Points.UpsertPoints</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>QdrantClient</span><span class=w> </span><span class=n>client</span><span class=w> </span><span class=o>=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>new</span><span class=w> </span><span class=n>QdrantClient</span><span class=p>(</span><span class=n>QdrantGrpcClient</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>(</span><span class=s>&#34;localhost&#34;</span><span class=p>,</span><span class=w> </span><span class=n>6334</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>).</span><span class=na>build</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>client</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>upsertAsync</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UpsertPoints</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setCollectionName</span><span class=p>(</span><span class=s>&#34;{collection_name}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>addAllPoints</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>List</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>PointStruct</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>setId</span><span class=p>(</span><span class=n>id</span><span class=p>(</span><span class=n>111</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>setVectors</span><span class=p>(</span><span class=n>vectors</span><span class=p>(</span><span class=n>0</span><span class=p>.</span><span class=na>1f</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>.</span><span class=na>2f</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>.</span><span class=na>3f</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>build</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setShardKeySelector</span><span class=p>(</span><span class=n>shardKeySelector</span><span class=p>(</span><span class=s>&#34;user_1&#34;</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>Qdrant.Client</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>Qdrant.Client.Grpc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>var</span> <span class=n>client</span> <span class=p>=</span> <span class=k>new</span> <span class=n>QdrantClient</span><span class=p>(</span><span class=s>&#34;localhost&#34;</span><span class=p>,</span> <span class=m>6334</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>await</span> <span class=n>client</span><span class=p>.</span><span class=n>UpsertAsync</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=n>collectionName</span><span class=p>:</span> <span class=s>&#34;{collection_name}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=n>points</span><span class=p>:</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>PointStruct</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>new</span><span class=p>()</span> <span class=p>{</span> <span class=n>Id</span> <span class=p>=</span> <span class=m>111</span><span class=p>,</span> <span class=n>Vectors</span> <span class=p>=</span> <span class=k>new</span><span class=p>[]</span> <span class=p>{</span> <span class=m>0.1f</span><span class=p>,</span> <span class=m>0.2f</span><span class=p>,</span> <span class=m>0.3f</span> <span class=p>}</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=n>shardKeySelector</span><span class=p>:</span> <span class=k>new</span> <span class=n>ShardKeySelector</span> <span class=p>{</span> <span class=n>ShardKeys</span> <span class=p>=</span> <span class=p>{</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>ShardKey</span><span class=p>&gt;</span> <span class=p>{</span> <span class=s>&#34;user_1&#34;</span> <span class=p>}</span> <span class=p>}</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/qdrant/go-client/qdrant&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>client</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nf>NewClient</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>Config</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Host</span><span class=p>:</span> <span class=s>&#34;localhost&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>Port</span><span class=p>:</span> <span class=mi>6334</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>client</span><span class=p>.</span><span class=nf>Upsert</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>(),</span> <span class=o>&amp;</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>UpsertPoints</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>CollectionName</span><span class=p>:</span> <span class=s>&#34;{collection_name}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>Points</span><span class=p>:</span> <span class=p>[]</span><span class=o>*</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>PointStruct</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>Id</span><span class=p>:</span>      <span class=nx>qdrant</span><span class=p>.</span><span class=nf>NewIDNum</span><span class=p>(</span><span class=mi>111</span><span class=p>),</span>
</span></span><span class=line><span class=cl>			<span class=nx>Vectors</span><span class=p>:</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nf>NewVectors</span><span class=p>(</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.2</span><span class=p>,</span> <span class=mf>0.3</span><span class=p>),</span>
</span></span><span class=line><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=nx>ShardKeySelector</span><span class=p>:</span> <span class=o>&amp;</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>ShardKeySelector</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>ShardKeys</span><span class=p>:</span> <span class=p>[]</span><span class=o>*</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>ShardKey</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>qdrant</span><span class=p>.</span><span class=nf>NewShardKey</span><span class=p>(</span><span class=s>&#34;user_1&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><aside role=alert>Using the same point ID across multiple shard keys is <strong>not supported<sup>*</sup></strong> and should be avoided.</aside><sup><strong>*</strong> When using custom sharding, IDs are only enforced to be unique within a shard key. This means that you can have multiple points with the same ID, if they have different shard keys.
This is a limitation of the current implementation, and is an anti-pattern that should be avoided because it can create scenarios of points with the same ID to have different contents. In the future, we plan to add a global ID uniqueness check.</sup><p>Now you can target the operations to specific shard(s) by specifying the <code>shard_key</code> on any operation you do. Operations that do not specify the shard key will be executed on <strong>all</strong> shards.</p><p>Another use-case would be to have shards that track the data chronologically, so that you can do more complex itineraries like uploading live data in one shard and archiving it once a certain age has passed.</p><img src=https://qdrant.tech/docs/sharding-per-day.png alt="Sharding per day" width=500 height=600><h3 id=shard-transfer-method>Shard transfer method</h3><p><em>Available as of v1.7.0</em></p><p>There are different methods for transferring a shard, such as moving or
replicating, to another node. Depending on what performance and guarantees you&rsquo;d
like to have and how you&rsquo;d like to manage your cluster, you likely want to
choose a specific method. Each method has its own pros and cons. Which is
fastest depends on the size and state of a shard.</p><p>Available shard transfer methods are:</p><ul><li><code>stream_records</code>: <em>(default)</em> transfer by streaming just its records to the target node in batches.</li><li><code>snapshot</code>: transfer including its index and quantized data by utilizing a <a href=https://qdrant.tech/documentation/concepts/snapshots/>snapshot</a> automatically.</li><li><code>wal_delta</code>: <em>(auto recovery default)</em> transfer by resolving <a href=https://qdrant.tech/documentation/concepts/storage/#versioning>WAL</a> difference; the operations that were missed.</li></ul><p>Each has pros, cons and specific requirements, some of which are:</p><div class=table-responsive><table class="table mb-5"><thead><tr><th style=text-align:left>Method:</th><th style=text-align:left>Stream records</th><th style=text-align:left>Snapshot</th><th style=text-align:left>WAL delta</th></tr></thead><tbody><tr><td style=text-align:left><strong>Version</strong></td><td style=text-align:left>v0.8.0+</td><td style=text-align:left>v1.7.0+</td><td style=text-align:left>v1.8.0+</td></tr><tr><td style=text-align:left><strong>Target</strong></td><td style=text-align:left>New/existing shard</td><td style=text-align:left>New/existing shard</td><td style=text-align:left>Existing shard</td></tr><tr><td style=text-align:left><strong>Connectivity</strong></td><td style=text-align:left>Internal gRPC API <small>(<abbr title=port>6335</abbr>)</small></td><td style=text-align:left>REST API <small>(<abbr title=port>6333</abbr>)</small><br>Internal gRPC API <small>(<abbr title=port>6335</abbr>)</small></td><td style=text-align:left>Internal gRPC API <small>(<abbr title=port>6335</abbr>)</small></td></tr><tr><td style=text-align:left><strong>HNSW index</strong></td><td style=text-align:left>Doesn&rsquo;t transfer, will reindex on target.</td><td style=text-align:left>Does transfer, immediately ready on target.</td><td style=text-align:left>Doesn&rsquo;t transfer, may index on target.</td></tr><tr><td style=text-align:left><strong>Quantization</strong></td><td style=text-align:left>Doesn&rsquo;t transfer, will requantize on target.</td><td style=text-align:left>Does transfer, immediately ready on target.</td><td style=text-align:left>Doesn&rsquo;t transfer, may quantize on target.</td></tr><tr><td style=text-align:left><strong>Ordering</strong></td><td style=text-align:left>Unordered updates on target<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></td><td style=text-align:left>Ordered updates on target<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></td><td style=text-align:left>Ordered updates on target<sup id=fnref1:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup></td></tr><tr><td style=text-align:left><strong>Disk space</strong></td><td style=text-align:left>No extra required</td><td style=text-align:left>Extra required for snapshot on both nodes</td><td style=text-align:left>No extra required</td></tr></tbody></table></div><p>To select a shard transfer method, specify the <code>method</code> like:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>POST /collections/{collection_name}/cluster
</span></span></span><span class=line><span class=cl><span class=err>{
</span></span></span><span class=line><span class=cl><span class=err>    &#34;move_shard&#34;: {
</span></span></span><span class=line><span class=cl><span class=err>        &#34;shard_id&#34;: 0,
</span></span></span><span class=line><span class=cl><span class=err>        &#34;from_peer_id&#34;: 381894127,
</span></span></span><span class=line><span class=cl><span class=err>        &#34;to_peer_id&#34;: 467122995,
</span></span></span><span class=line><span class=cl><span class=err>        &#34;method&#34;: &#34;snapshot&#34;
</span></span></span><span class=line><span class=cl><span class=err>    }
</span></span></span><span class=line><span class=cl><span class=err>}
</span></span></span></code></pre></div><p>The <code>stream_records</code> transfer method is the simplest available. It simply
transfers all shard records in batches to the target node until it has
transferred all of them, keeping both shards in sync. It will also make sure the
transferred shard indexing process is keeping up before performing a final
switch. The method has two common disadvantages: 1. It does not transfer index
or quantization data, meaning that the shard has to be optimized again on the
new node, which can be very expensive. 2. The ordering guarantees are
<code>weak</code><sup id=fnref1:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>, which is not suitable for some applications. Because it is
so simple, it&rsquo;s also very robust, making it a reliable choice if the above cons
are acceptable in your use case. If your cluster is unstable and out of
resources, it&rsquo;s probably best to use the <code>stream_records</code> transfer method,
because it is unlikely to fail.</p><p>The <code>snapshot</code> transfer method utilizes <a href=https://qdrant.tech/documentation/concepts/snapshots/>snapshots</a>
to transfer a shard. A snapshot is created automatically. It is then transferred
and restored on the target node. After this is done, the snapshot is removed
from both nodes. While the snapshot/transfer/restore operation is happening, the
source node queues up all new operations. All queued updates are then sent in
order to the target shard to bring it into the same state as the source. There
are two important benefits: 1. It transfers index and quantization data, so that
the shard does not have to be optimized again on the target node, making them
immediately available. This way, Qdrant ensures that there will be no
degradation in performance at the end of the transfer. Especially on large
shards, this can give a huge performance improvement. 2. The ordering guarantees
can be <code>strong</code><sup id=fnref2:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>, required for some applications.</p><p>The <code>wal_delta</code> transfer method only transfers the difference between two
shards. More specifically, it transfers all operations that were missed to the
target shard. The <a href=https://qdrant.tech/documentation/concepts/storage/#versioning>WAL</a> of both shards is used to resolve this. There are two
benefits: 1. It will be very fast because it only transfers the difference
rather than all data. 2. The ordering guarantees can be <code>strong</code><sup id=fnref3:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>,
required for some applications. Two disadvantages are: 1. It can only be used to
transfer to a shard that already exists on the other node. 2. Applicability is
limited because the WALs normally don&rsquo;t hold more than 64MB of recent
operations. But that should be enough for a node that quickly restarts, to
upgrade for example. If a delta cannot be resolved, this method automatically
falls back to <code>stream_records</code> which equals transferring the full shard.</p><p>The <code>stream_records</code> method is currently used as default. This may change in the
future. As of Qdrant 1.9.0 <code>wal_delta</code> is used for automatic shard replications
to recover dead shards.</p><h2 id=replication>Replication</h2><p>Qdrant allows you to replicate shards between nodes in the cluster.</p><p>Shard replication increases the reliability of the cluster by keeping several copies of a shard spread across the cluster.
This ensures the availability of the data in case of node failures, except if all replicas are lost.</p><h3 id=replication-factor>Replication factor</h3><p>When you create a collection, you can control how many shard replicas you&rsquo;d like to store by changing the <code>replication_factor</code>. By default, <code>replication_factor</code> is set to &ldquo;1&rdquo;, meaning no additional copy is maintained automatically. The default can be changed in the <a href=https://qdrant.tech/documentation/guides/configuration/#configuration-options>Qdrant configuration</a>. You can change that by setting the <code>replication_factor</code> when you create a collection.</p><p>The <code>replication_factor</code> can be updated for an existing collection, but the effect of this depends on how you&rsquo;re running Qdrant. If you&rsquo;re hosting the open source version of Qdrant yourself, changing the replication factor after collection creation doesn&rsquo;t do anything. You can manually <a href=#creating-new-shard-replicas>create</a> or drop shard replicas to achieve your desired replication factor. In Qdrant Cloud (including Hybrid Cloud, Private Cloud) your shards will automatically be replicated or dropped to match your configured replication factor.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>PUT /collections/{collection_name}
</span></span></span><span class=line><span class=cl><span class=err>{
</span></span></span><span class=line><span class=cl><span class=err>    &#34;vectors&#34;: {
</span></span></span><span class=line><span class=cl><span class=err>        &#34;size&#34;: 300,
</span></span></span><span class=line><span class=cl><span class=err>        &#34;distance&#34;: &#34;Cosine&#34;
</span></span></span><span class=line><span class=cl><span class=err>    },
</span></span></span><span class=line><span class=cl><span class=err>    &#34;shard_number&#34;: 6,
</span></span></span><span class=line><span class=cl><span class=err>    &#34;replication_factor&#34;: 2
</span></span></span><span class=line><span class=cl><span class=err>}
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>qdrant_client</span> <span class=kn>import</span> <span class=n>QdrantClient</span><span class=p>,</span> <span class=n>models</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>QdrantClient</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=s2>&#34;http://localhost:6333&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>client</span><span class=o>.</span><span class=n>create_collection</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>collection_name</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>{collection_name}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>vectors_config</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>VectorParams</span><span class=p>(</span><span class=n>size</span><span class=o>=</span><span class=mi>300</span><span class=p>,</span> <span class=n>distance</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>Distance</span><span class=o>.</span><span class=n>COSINE</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>shard_number</span><span class=o>=</span><span class=mi>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>replication_factor</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>QdrantClient</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;@qdrant/js-client-rest&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>client</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>QdrantClient</span><span class=p>({</span> <span class=nx>host</span><span class=o>:</span> <span class=s2>&#34;localhost&#34;</span><span class=p>,</span> <span class=nx>port</span>: <span class=kt>6333</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>client</span><span class=p>.</span><span class=nx>createCollection</span><span class=p>(</span><span class=s2>&#34;{collection_name}&#34;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>vectors</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>size</span>: <span class=kt>300</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>distance</span><span class=o>:</span> <span class=s2>&#34;Cosine&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>shard_number</span>: <span class=kt>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>replication_factor</span>: <span class=kt>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>qdrant_client</span>::<span class=n>qdrant</span>::<span class=p>{</span><span class=n>CreateCollectionBuilder</span><span class=p>,</span><span class=w> </span><span class=n>Distance</span><span class=p>,</span><span class=w> </span><span class=n>VectorParamsBuilder</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>qdrant_client</span>::<span class=n>Qdrant</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>client</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Qdrant</span>::<span class=n>from_url</span><span class=p>(</span><span class=s>&#34;http://localhost:6334&#34;</span><span class=p>).</span><span class=n>build</span><span class=p>()</span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>client</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=n>create_collection</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CreateCollectionBuilder</span>::<span class=n>new</span><span class=p>(</span><span class=s>&#34;{collection_name}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>vectors_config</span><span class=p>(</span><span class=n>VectorParamsBuilder</span>::<span class=n>new</span><span class=p>(</span><span class=mi>300</span><span class=p>,</span><span class=w> </span><span class=n>Distance</span>::<span class=n>Cosine</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>shard_number</span><span class=p>(</span><span class=mi>6</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>replication_factor</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=k>await</span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.QdrantClient</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.QdrantGrpcClient</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Collections.CreateCollection</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Collections.Distance</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Collections.VectorParams</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Collections.VectorsConfig</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>QdrantClient</span><span class=w> </span><span class=n>client</span><span class=w> </span><span class=o>=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>new</span><span class=w> </span><span class=n>QdrantClient</span><span class=p>(</span><span class=n>QdrantGrpcClient</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>(</span><span class=s>&#34;localhost&#34;</span><span class=p>,</span><span class=w> </span><span class=n>6334</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>).</span><span class=na>build</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>client</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>createCollectionAsync</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CreateCollection</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setCollectionName</span><span class=p>(</span><span class=s>&#34;{collection_name}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setVectorsConfig</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>VectorsConfig</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>setParams</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>VectorParams</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>setSize</span><span class=p>(</span><span class=n>300</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>setDistance</span><span class=p>(</span><span class=n>Distance</span><span class=p>.</span><span class=na>Cosine</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setShardNumber</span><span class=p>(</span><span class=n>6</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setReplicationFactor</span><span class=p>(</span><span class=n>2</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>Qdrant.Client</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>Qdrant.Client.Grpc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>var</span> <span class=n>client</span> <span class=p>=</span> <span class=k>new</span> <span class=n>QdrantClient</span><span class=p>(</span><span class=s>&#34;localhost&#34;</span><span class=p>,</span> <span class=m>6334</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>await</span> <span class=n>client</span><span class=p>.</span><span class=n>CreateCollectionAsync</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=n>collectionName</span><span class=p>:</span> <span class=s>&#34;{collection_name}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=n>vectorsConfig</span><span class=p>:</span> <span class=k>new</span> <span class=n>VectorParams</span> <span class=p>{</span> <span class=n>Size</span> <span class=p>=</span> <span class=m>300</span><span class=p>,</span> <span class=n>Distance</span> <span class=p>=</span> <span class=n>Distance</span><span class=p>.</span><span class=n>Cosine</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=n>shardNumber</span><span class=p>:</span> <span class=m>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=n>replicationFactor</span><span class=p>:</span> <span class=m>2</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/qdrant/go-client/qdrant&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>client</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nf>NewClient</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>Config</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Host</span><span class=p>:</span> <span class=s>&#34;localhost&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>Port</span><span class=p>:</span> <span class=mi>6334</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>client</span><span class=p>.</span><span class=nf>CreateCollection</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>(),</span> <span class=o>&amp;</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>CreateCollection</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>CollectionName</span><span class=p>:</span> <span class=s>&#34;{collection_name}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>VectorsConfig</span><span class=p>:</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nf>NewVectorsConfig</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>VectorParams</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Size</span><span class=p>:</span>     <span class=mi>300</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Distance</span><span class=p>:</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nx>Distance_Cosine</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>}),</span>
</span></span><span class=line><span class=cl>	<span class=nx>ShardNumber</span><span class=p>:</span>       <span class=nx>qdrant</span><span class=p>.</span><span class=nf>PtrOf</span><span class=p>(</span><span class=nb>uint32</span><span class=p>(</span><span class=mi>6</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>	<span class=nx>ReplicationFactor</span><span class=p>:</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nf>PtrOf</span><span class=p>(</span><span class=nb>uint32</span><span class=p>(</span><span class=mi>2</span><span class=p>)),</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><p>This code sample creates a collection with a total of 6 logical shards backed by a total of 12 physical shards.</p><p>Since a replication factor of &ldquo;2&rdquo; would require twice as much storage space, it is advised to make sure the hardware can host the additional shard replicas beforehand.</p><h3 id=creating-new-shard-replicas>Creating new shard replicas</h3><p>It is possible to create or delete replicas manually on an existing collection using the <a href=https://api.qdrant.tech/master/api-reference/distributed/update-collection-cluster target=_blank rel="noopener nofollow">Update collection cluster setup API</a>. This is usually only necessary if you run Qdrant open-source. In Qdrant Cloud shard replication is handled and updated automatically, matching the configured <code>replication_factor</code>.</p><p>A replica can be added on a specific peer by specifying the peer from which to replicate.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>POST /collections/{collection_name}/cluster
</span></span></span><span class=line><span class=cl><span class=err>{
</span></span></span><span class=line><span class=cl><span class=err>    &#34;replicate_shard&#34;: {
</span></span></span><span class=line><span class=cl><span class=err>        &#34;shard_id&#34;: 0,
</span></span></span><span class=line><span class=cl><span class=err>        &#34;from_peer_id&#34;: 381894127,
</span></span></span><span class=line><span class=cl><span class=err>        &#34;to_peer_id&#34;: 467122995
</span></span></span><span class=line><span class=cl><span class=err>    }
</span></span></span><span class=line><span class=cl><span class=err>}
</span></span></span></code></pre></div><aside role=status>You likely want to select a specific <a href=#shard-transfer-method>shard transfer method</a> to get desired performance and guarantees.</aside><p>And a replica can be removed on a specific peer.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>POST /collections/{collection_name}/cluster
</span></span></span><span class=line><span class=cl><span class=err>{
</span></span></span><span class=line><span class=cl><span class=err>    &#34;drop_replica&#34;: {
</span></span></span><span class=line><span class=cl><span class=err>        &#34;shard_id&#34;: 0,
</span></span></span><span class=line><span class=cl><span class=err>        &#34;peer_id&#34;: 381894127
</span></span></span><span class=line><span class=cl><span class=err>    }
</span></span></span><span class=line><span class=cl><span class=err>}
</span></span></span></code></pre></div><p>Keep in mind that a collection must contain at least one active replica of a shard.</p><h3 id=error-handling>Error handling</h3><p>Replicas can be in different states:</p><ul><li>Active: healthy and ready to serve traffic</li><li>Dead: unhealthy and not ready to serve traffic</li><li>Partial: currently under resynchronization before activation</li></ul><p>A replica is marked as dead if it does not respond to internal healthchecks or if it fails to serve traffic.</p><p>A dead replica will not receive traffic from other peers and might require a manual intervention if it does not recover automatically.</p><p>This mechanism ensures data consistency and availability if a subset of the replicas fail during an update operation.</p><h3 id=node-failure-recovery>Node Failure Recovery</h3><p>Sometimes hardware malfunctions might render some nodes of the Qdrant cluster unrecoverable.
No system is immune to this.</p><p>But several recovery scenarios allow qdrant to stay available for requests and even avoid performance degradation.
Let&rsquo;s walk through them from best to worst.</p><p><strong>Recover with replicated collection</strong></p><p>If the number of failed nodes is less than the replication factor of the collection, then your cluster should still be able to perform read, search and update queries.</p><p>Now, if the failed node restarts, consensus will trigger the replication process to update the recovering node with the newest updates it has missed.</p><p>If the failed node never restarts, you can recover the lost shards if you have a 3+ node cluster. You cannot recover lost shards in smaller clusters because recovery operations go through <a href=#raft>raft</a> which requires >50% of the nodes to be healthy.</p><p><strong>Recreate node with replicated collections</strong></p><p>If a node fails and it is impossible to recover it, you should exclude the dead node from the consensus and create an empty node.</p><p>To exclude failed nodes from the consensus, use <a href=https://api.qdrant.tech/master/api-reference/distributed/remove-peer target=_blank rel="noopener nofollow">remove peer</a> API.
Apply the <code>force</code> flag if necessary.</p><p>When you create a new node, make sure to attach it to the existing cluster by specifying <code>--bootstrap</code> CLI parameter with the URL of any of the running cluster nodes.</p><p>Once the new node is ready and synchronized with the cluster, you might want to ensure that the collection shards are replicated enough. Remember that Qdrant will not automatically balance shards since this is an expensive operation.
Use the <a href=https://api.qdrant.tech/master/api-reference/distributed/update-collection-cluster target=_blank rel="noopener nofollow">Replicate Shard Operation</a> to create another copy of the shard on the newly connected node.</p><p>It&rsquo;s worth mentioning that Qdrant only provides the necessary building blocks to create an automated failure recovery.
Building a completely automatic process of collection scaling would require control over the cluster machines themself.
Check out our <a href=https://qdrant.to/cloud target=_blank rel="noopener nofollow">cloud solution</a>, where we made exactly that.</p><p><strong>Recover from snapshot</strong></p><p>If there are no copies of data in the cluster, it is still possible to recover from a snapshot.</p><p>Follow the same steps to detach failed node and create a new one in the cluster:</p><ul><li>To exclude failed nodes from the consensus, use <a href=https://api.qdrant.tech/master/api-reference/distributed/remove-peer target=_blank rel="noopener nofollow">remove peer</a> API. Apply the <code>force</code> flag if necessary.</li><li>Create a new node, making sure to attach it to the existing cluster by specifying the <code>--bootstrap</code> CLI parameter with the URL of any of the running cluster nodes.</li></ul><p>Snapshot recovery, used in single-node deployment, is different from cluster one.
Consensus manages all metadata about all collections and does not require snapshots to recover it.
But you can use snapshots to recover missing shards of the collections.</p><p>Use the <a href=https://qdrant.tech/documentation/concepts/snapshots/#recover-in-cluster-deployment>Collection Snapshot Recovery API</a> to do it.
The service will download the specified snapshot of the collection and recover shards with data from it.</p><p>Once all shards of the collection are recovered, the collection will become operational again.</p><h3 id=temporary-node-failure>Temporary node failure</h3><p>If properly configured, running Qdrant in distributed mode can make your cluster resistant to outages when one node fails temporarily.</p><p>Here is how differently-configured Qdrant clusters respond:</p><ul><li>1-node clusters: All operations time out or fail for up to a few minutes. It depends on how long it takes to restart and load data from disk.</li><li>2-node clusters where shards ARE NOT replicated: All operations will time out or fail for up to a few minutes. It depends on how long it takes to restart and load data from disk.</li><li>2-node clusters where all shards ARE replicated to both nodes: All requests except for operations on collections continue to work during the outage.</li><li>3+-node clusters where all shards are replicated to at least 2 nodes: All requests continue to work during the outage.</li></ul><h2 id=consistency-guarantees>Consistency guarantees</h2><p>By default, Qdrant focuses on availability and maximum throughput of search operations.
For the majority of use cases, this is a preferable trade-off.</p><p>During the normal state of operation, it is possible to search and modify data from any peers in the cluster.</p><p>Before responding to the client, the peer handling the request dispatches all operations according to the current topology in order to keep the data synchronized across the cluster.</p><ul><li>reads are using a partial fan-out strategy to optimize latency and availability</li><li>writes are executed in parallel on all active sharded replicas</li></ul><p><img src=https://qdrant.tech/docs/concurrent-operations-replicas.png alt=Embeddings></p><p>However, in some cases, it is necessary to ensure additional guarantees during possible hardware instabilities, mass concurrent updates of same documents, etc.</p><p>Qdrant provides a few options to control consistency guarantees:</p><ul><li><code>write_consistency_factor</code> - defines the number of replicas that must acknowledge a write operation before responding to the client. Increasing this value will make write operations tolerant to network partitions in the cluster, but will require a higher number of replicas to be active to perform write operations.</li><li>Read <code>consistency</code> param, can be used with search and retrieve operations to ensure that the results obtained from all replicas are the same. If this option is used, Qdrant will perform the read operation on multiple replicas and resolve the result according to the selected strategy. This option is useful to avoid data inconsistency in case of concurrent updates of the same documents. This options is preferred if the update operations are frequent and the number of replicas is low.</li><li>Write <code>ordering</code> param, can be used with update and delete operations to ensure that the operations are executed in the same order on all replicas. If this option is used, Qdrant will route the operation to the leader replica of the shard and wait for the response before responding to the client. This option is useful to avoid data inconsistency in case of concurrent updates of the same documents. This options is preferred if read operations are more frequent than update and if search performance is critical.</li></ul><h3 id=write-consistency-factor>Write consistency factor</h3><p>The <code>write_consistency_factor</code> represents the number of replicas that must acknowledge a write operation before responding to the client. It is set to 1 by default.
It can be configured at the collection&rsquo;s creation or when updating the
collection parameters.</p><p>This value can range from 1 to the number of replicas you have for each shard.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>PUT /collections/{collection_name}
</span></span></span><span class=line><span class=cl><span class=err>{
</span></span></span><span class=line><span class=cl><span class=err>    &#34;vectors&#34;: {
</span></span></span><span class=line><span class=cl><span class=err>        &#34;size&#34;: 300,
</span></span></span><span class=line><span class=cl><span class=err>        &#34;distance&#34;: &#34;Cosine&#34;
</span></span></span><span class=line><span class=cl><span class=err>    },
</span></span></span><span class=line><span class=cl><span class=err>    &#34;shard_number&#34;: 6,
</span></span></span><span class=line><span class=cl><span class=err>    &#34;replication_factor&#34;: 2,
</span></span></span><span class=line><span class=cl><span class=err>    &#34;write_consistency_factor&#34;: 2
</span></span></span><span class=line><span class=cl><span class=err>}
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>qdrant_client</span> <span class=kn>import</span> <span class=n>QdrantClient</span><span class=p>,</span> <span class=n>models</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>QdrantClient</span><span class=p>(</span><span class=n>url</span><span class=o>=</span><span class=s2>&#34;http://localhost:6333&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>client</span><span class=o>.</span><span class=n>create_collection</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>collection_name</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>{collection_name}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>vectors_config</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>VectorParams</span><span class=p>(</span><span class=n>size</span><span class=o>=</span><span class=mi>300</span><span class=p>,</span> <span class=n>distance</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>Distance</span><span class=o>.</span><span class=n>COSINE</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>shard_number</span><span class=o>=</span><span class=mi>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>replication_factor</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>write_consistency_factor</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>QdrantClient</span> <span class=p>}</span> <span class=kr>from</span> <span class=s2>&#34;@qdrant/js-client-rest&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>client</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>QdrantClient</span><span class=p>({</span> <span class=nx>host</span><span class=o>:</span> <span class=s2>&#34;localhost&#34;</span><span class=p>,</span> <span class=nx>port</span>: <span class=kt>6333</span> <span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>client</span><span class=p>.</span><span class=nx>createCollection</span><span class=p>(</span><span class=s2>&#34;{collection_name}&#34;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>vectors</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>size</span>: <span class=kt>300</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>distance</span><span class=o>:</span> <span class=s2>&#34;Cosine&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>shard_number</span>: <span class=kt>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>replication_factor</span>: <span class=kt>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>write_consistency_factor</span>: <span class=kt>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>qdrant_client</span>::<span class=n>qdrant</span>::<span class=p>{</span><span class=n>CreateCollectionBuilder</span><span class=p>,</span><span class=w> </span><span class=n>Distance</span><span class=p>,</span><span class=w> </span><span class=n>VectorParamsBuilder</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>qdrant_client</span>::<span class=n>Qdrant</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>client</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Qdrant</span>::<span class=n>from_url</span><span class=p>(</span><span class=s>&#34;http://localhost:6334&#34;</span><span class=p>).</span><span class=n>build</span><span class=p>()</span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>client</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=n>create_collection</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CreateCollectionBuilder</span>::<span class=n>new</span><span class=p>(</span><span class=s>&#34;{collection_name}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>vectors_config</span><span class=p>(</span><span class=n>VectorParamsBuilder</span>::<span class=n>new</span><span class=p>(</span><span class=mi>300</span><span class=p>,</span><span class=w> </span><span class=n>Distance</span>::<span class=n>Cosine</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>shard_number</span><span class=p>(</span><span class=mi>6</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>replication_factor</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>write_consistency_factor</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=k>await</span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.QdrantClient</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.QdrantGrpcClient</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Collections.CreateCollection</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Collections.Distance</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Collections.VectorParams</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Collections.VectorsConfig</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>QdrantClient</span><span class=w> </span><span class=n>client</span><span class=w> </span><span class=o>=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>new</span><span class=w> </span><span class=n>QdrantClient</span><span class=p>(</span><span class=n>QdrantGrpcClient</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>(</span><span class=s>&#34;localhost&#34;</span><span class=p>,</span><span class=w> </span><span class=n>6334</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>).</span><span class=na>build</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>client</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>createCollectionAsync</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>CreateCollection</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setCollectionName</span><span class=p>(</span><span class=s>&#34;{collection_name}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setVectorsConfig</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>VectorsConfig</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>setParams</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>VectorParams</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>setSize</span><span class=p>(</span><span class=n>300</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>setDistance</span><span class=p>(</span><span class=n>Distance</span><span class=p>.</span><span class=na>Cosine</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                            </span><span class=p>.</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=p>.</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setShardNumber</span><span class=p>(</span><span class=n>6</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setReplicationFactor</span><span class=p>(</span><span class=n>2</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setWriteConsistencyFactor</span><span class=p>(</span><span class=n>2</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>Qdrant.Client</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>Qdrant.Client.Grpc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>var</span> <span class=n>client</span> <span class=p>=</span> <span class=k>new</span> <span class=n>QdrantClient</span><span class=p>(</span><span class=s>&#34;localhost&#34;</span><span class=p>,</span> <span class=m>6334</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>await</span> <span class=n>client</span><span class=p>.</span><span class=n>CreateCollectionAsync</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=n>collectionName</span><span class=p>:</span> <span class=s>&#34;{collection_name}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=n>vectorsConfig</span><span class=p>:</span> <span class=k>new</span> <span class=n>VectorParams</span> <span class=p>{</span> <span class=n>Size</span> <span class=p>=</span> <span class=m>300</span><span class=p>,</span> <span class=n>Distance</span> <span class=p>=</span> <span class=n>Distance</span><span class=p>.</span><span class=n>Cosine</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=n>shardNumber</span><span class=p>:</span> <span class=m>6</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=n>replicationFactor</span><span class=p>:</span> <span class=m>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=n>writeConsistencyFactor</span><span class=p>:</span> <span class=m>2</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/qdrant/go-client/qdrant&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>client</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nf>NewClient</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>Config</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Host</span><span class=p>:</span> <span class=s>&#34;localhost&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>Port</span><span class=p>:</span> <span class=mi>6334</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>client</span><span class=p>.</span><span class=nf>CreateCollection</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>(),</span> <span class=o>&amp;</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>CreateCollection</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>CollectionName</span><span class=p>:</span> <span class=s>&#34;{collection_name}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>VectorsConfig</span><span class=p>:</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nf>NewVectorsConfig</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>VectorParams</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Size</span><span class=p>:</span>     <span class=mi>300</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Distance</span><span class=p>:</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nx>Distance_Cosine</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>}),</span>
</span></span><span class=line><span class=cl>	<span class=nx>ShardNumber</span><span class=p>:</span>            <span class=nx>qdrant</span><span class=p>.</span><span class=nf>PtrOf</span><span class=p>(</span><span class=nb>uint32</span><span class=p>(</span><span class=mi>6</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>	<span class=nx>ReplicationFactor</span><span class=p>:</span>      <span class=nx>qdrant</span><span class=p>.</span><span class=nf>PtrOf</span><span class=p>(</span><span class=nb>uint32</span><span class=p>(</span><span class=mi>2</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>	<span class=nx>WriteConsistencyFactor</span><span class=p>:</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nf>PtrOf</span><span class=p>(</span><span class=nb>uint32</span><span class=p>(</span><span class=mi>2</span><span class=p>)),</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><p>Write operations will fail if the number of active replicas is less than the
<code>write_consistency_factor</code>. In this case, the client is expected to send the
operation again to ensure a consistent state is reached.</p><p>Setting the <code>write_consistency_factor</code> to a lower value may allow accepting
writes even if there are unresponsive nodes. Unresponsive nodes are marked as
dead and will automatically be recovered once available to ensure data
consistency.</p><p>The configuration of the <code>write_consistency_factor</code> is important for adjusting the cluster&rsquo;s behavior when some nodes go offline due to restarts, upgrades, or failures.</p><p>By default, the cluster continues to accept updates as long as at least one replica of each shard is online. However, this behavior means that once an offline replica is restored, it will require additional synchronization with the rest of the cluster. In some cases, this synchronization can be resource-intensive and undesirable.</p><p>Setting the <code>write_consistency_factor</code> to match the replication factor modifies the cluster&rsquo;s behavior so that unreplicated updates are rejected, preventing the need for extra synchronization.</p><p>If the update is applied to enough replicas - according to the <code>write_consistency_factor</code> - the update will return a successful status. Any replicas that failed to apply the update will be temporarily disabled and are automatically recovered to keep data consistency. If the update could not be applied to enough replicas, it&rsquo;ll return an error and may be partially applied. The user must submit the operation again to ensure data consistency.</p><p>For asynchronous updates and injection pipelines capable of handling errors and retries, this strategy might be preferable.</p><h3 id=read-consistency>Read consistency</h3><p>Read <code>consistency</code> can be specified for most read requests and will ensure that the returned result
is consistent across cluster nodes.</p><ul><li><code>all</code> will query all nodes and return points, which present on all of them</li><li><code>majority</code> will query all nodes and return points, which present on the majority of them</li><li><code>quorum</code> will query randomly selected majority of nodes and return points, which present on all of them</li><li><code>1</code>/<code>2</code>/<code>3</code>/etc - will query specified number of randomly selected nodes and return points which present on all of them</li><li>default <code>consistency</code> is <code>1</code></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>POST /collections/{collection_name}/points/query?consistency=majority
</span></span></span><span class=line><span class=cl><span class=err>{
</span></span></span><span class=line><span class=cl><span class=err>    &#34;query&#34;: [0.2, 0.1, 0.9, 0.7],
</span></span></span><span class=line><span class=cl><span class=err>    &#34;filter&#34;: {
</span></span></span><span class=line><span class=cl><span class=err>        &#34;must&#34;: [
</span></span></span><span class=line><span class=cl><span class=err>            {
</span></span></span><span class=line><span class=cl><span class=err>                &#34;key&#34;: &#34;city&#34;,
</span></span></span><span class=line><span class=cl><span class=err>                &#34;match&#34;: {
</span></span></span><span class=line><span class=cl><span class=err>                    &#34;value&#34;: &#34;London&#34;
</span></span></span><span class=line><span class=cl><span class=err>                }
</span></span></span><span class=line><span class=cl><span class=err>            }
</span></span></span><span class=line><span class=cl><span class=err>        ]
</span></span></span><span class=line><span class=cl><span class=err>    },
</span></span></span><span class=line><span class=cl><span class=err>    &#34;params&#34;: {
</span></span></span><span class=line><span class=cl><span class=err>        &#34;hnsw_ef&#34;: 128,
</span></span></span><span class=line><span class=cl><span class=err>        &#34;exact&#34;: false
</span></span></span><span class=line><span class=cl><span class=err>    },
</span></span></span><span class=line><span class=cl><span class=err>    &#34;limit&#34;: 3
</span></span></span><span class=line><span class=cl><span class=err>}
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>client</span><span class=o>.</span><span class=n>query_points</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>collection_name</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>{collection_name}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>query</span><span class=o>=</span><span class=p>[</span><span class=mf>0.2</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.9</span><span class=p>,</span> <span class=mf>0.7</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=n>query_filter</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>Filter</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>must</span><span class=o>=</span><span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=n>models</span><span class=o>.</span><span class=n>FieldCondition</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>key</span><span class=o>=</span><span class=s2>&#34;city&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=k>match</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>MatchValue</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>value</span><span class=o>=</span><span class=s2>&#34;London&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>search_params</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>SearchParams</span><span class=p>(</span><span class=n>hnsw_ef</span><span class=o>=</span><span class=mi>128</span><span class=p>,</span> <span class=n>exact</span><span class=o>=</span><span class=kc>False</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>limit</span><span class=o>=</span><span class=mi>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>consistency</span><span class=o>=</span><span class=s2>&#34;majority&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=nx>client</span><span class=p>.</span><span class=nx>query</span><span class=p>(</span><span class=s2>&#34;{collection_name}&#34;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>query</span><span class=o>:</span> <span class=p>[</span><span class=mf>0.2</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.9</span><span class=p>,</span> <span class=mf>0.7</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nx>filter</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>must</span><span class=o>:</span> <span class=p>[{</span> <span class=nx>key</span><span class=o>:</span> <span class=s2>&#34;city&#34;</span><span class=p>,</span> <span class=nx>match</span><span class=o>:</span> <span class=p>{</span> <span class=nx>value</span><span class=o>:</span> <span class=s2>&#34;London&#34;</span> <span class=p>}</span> <span class=p>}],</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>params</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>hnsw_ef</span>: <span class=kt>128</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>exact</span>: <span class=kt>false</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>limit</span>: <span class=kt>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>consistency</span><span class=o>:</span> <span class=s2>&#34;majority&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>qdrant_client</span>::<span class=n>qdrant</span>::<span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>read_consistency</span>::<span class=n>Value</span><span class=p>,</span><span class=w> </span><span class=n>Condition</span><span class=p>,</span><span class=w> </span><span class=n>Filter</span><span class=p>,</span><span class=w> </span><span class=n>QueryPointsBuilder</span><span class=p>,</span><span class=w> </span><span class=n>ReadConsistencyType</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>SearchParamsBuilder</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>qdrant_client</span>::<span class=p>{</span><span class=n>Qdrant</span><span class=p>,</span><span class=w> </span><span class=n>QdrantError</span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>client</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Qdrant</span>::<span class=n>from_url</span><span class=p>(</span><span class=s>&#34;http://localhost:6334&#34;</span><span class=p>).</span><span class=n>build</span><span class=p>()</span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>client</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=n>query</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>QueryPointsBuilder</span>::<span class=n>new</span><span class=p>(</span><span class=s>&#34;{collection_name}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>query</span><span class=p>(</span><span class=fm>vec!</span><span class=p>[</span><span class=mf>0.2</span><span class=p>,</span><span class=w> </span><span class=mf>0.1</span><span class=p>,</span><span class=w> </span><span class=mf>0.9</span><span class=p>,</span><span class=w> </span><span class=mf>0.7</span><span class=p>])</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>limit</span><span class=p>(</span><span class=mi>3</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>filter</span><span class=p>(</span><span class=n>Filter</span>::<span class=n>must</span><span class=p>([</span><span class=n>Condition</span>::<span class=n>matches</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;city&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=s>&#34;London&#34;</span><span class=p>.</span><span class=n>to_string</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>)]))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>params</span><span class=p>(</span><span class=n>SearchParamsBuilder</span>::<span class=n>default</span><span class=p>().</span><span class=n>hnsw_ef</span><span class=p>(</span><span class=mi>128</span><span class=p>).</span><span class=n>exact</span><span class=p>(</span><span class=kc>false</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=n>read_consistency</span><span class=p>(</span><span class=n>Value</span>::<span class=n>Type</span><span class=p>(</span><span class=n>ReadConsistencyType</span>::<span class=n>Majority</span><span class=p>.</span><span class=n>into</span><span class=p>())),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=k>await</span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.QdrantClient</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.QdrantGrpcClient</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Points.Filter</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Points.QueryPoints</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Points.ReadConsistency</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Points.ReadConsistencyType</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Points.SearchParams</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>io.qdrant.client.QueryFactory.nearest</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>io.qdrant.client.ConditionFactory.matchKeyword</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>QdrantClient</span><span class=w> </span><span class=n>client</span><span class=w> </span><span class=o>=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=k>new</span><span class=w> </span><span class=n>QdrantClient</span><span class=p>(</span><span class=n>QdrantGrpcClient</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>(</span><span class=s>&#34;localhost&#34;</span><span class=p>,</span><span class=w> </span><span class=n>6334</span><span class=p>,</span><span class=w> </span><span class=kc>false</span><span class=p>).</span><span class=na>build</span><span class=p>());</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>client</span><span class=p>.</span><span class=na>queryAsync</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>QueryPoints</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>setCollectionName</span><span class=p>(</span><span class=s>&#34;{collection_name}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>setFilter</span><span class=p>(</span><span class=n>Filter</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>().</span><span class=na>addMust</span><span class=p>(</span><span class=n>matchKeyword</span><span class=p>(</span><span class=s>&#34;city&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;London&#34;</span><span class=p>)).</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>setQuery</span><span class=p>(</span><span class=n>nearest</span><span class=p>(.</span><span class=na>2f</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>.</span><span class=na>1f</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>.</span><span class=na>9f</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>.</span><span class=na>7f</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>setParams</span><span class=p>(</span><span class=n>SearchParams</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>().</span><span class=na>setHnswEf</span><span class=p>(</span><span class=n>128</span><span class=p>).</span><span class=na>setExact</span><span class=p>(</span><span class=kc>false</span><span class=p>).</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>setLimit</span><span class=p>(</span><span class=n>3</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>setReadConsistency</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=n>ReadConsistency</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>().</span><span class=na>setType</span><span class=p>(</span><span class=n>ReadConsistencyType</span><span class=p>.</span><span class=na>Majority</span><span class=p>).</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=p>.</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>Qdrant.Client</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>Qdrant.Client.Grpc</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>static</span> <span class=n>Qdrant</span><span class=p>.</span><span class=n>Client</span><span class=p>.</span><span class=n>Grpc</span><span class=p>.</span><span class=n>Conditions</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>var</span> <span class=n>client</span> <span class=p>=</span> <span class=k>new</span> <span class=n>QdrantClient</span><span class=p>(</span><span class=s>&#34;localhost&#34;</span><span class=p>,</span> <span class=m>6334</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>await</span> <span class=n>client</span><span class=p>.</span><span class=n>QueryAsync</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=n>collectionName</span><span class=p>:</span> <span class=s>&#34;{collection_name}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=n>query</span><span class=p>:</span> <span class=k>new</span> <span class=kt>float</span><span class=p>[]</span> <span class=p>{</span> <span class=m>0.2f</span><span class=p>,</span> <span class=m>0.1f</span><span class=p>,</span> <span class=m>0.9f</span><span class=p>,</span> <span class=m>0.7f</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=n>filter</span><span class=p>:</span> <span class=n>MatchKeyword</span><span class=p>(</span><span class=s>&#34;city&#34;</span><span class=p>,</span> <span class=s>&#34;London&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>	<span class=n>searchParams</span><span class=p>:</span> <span class=k>new</span> <span class=n>SearchParams</span> <span class=p>{</span> <span class=n>HnswEf</span> <span class=p>=</span> <span class=m>128</span><span class=p>,</span> <span class=n>Exact</span> <span class=p>=</span> <span class=kc>false</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=n>limit</span><span class=p>:</span> <span class=m>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=n>readConsistency</span><span class=p>:</span> <span class=k>new</span> <span class=n>ReadConsistency</span> <span class=p>{</span> <span class=n>Type</span> <span class=p>=</span> <span class=n>ReadConsistencyType</span><span class=p>.</span><span class=n>Majority</span> <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/qdrant/go-client/qdrant&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>client</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nf>NewClient</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>Config</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Host</span><span class=p>:</span> <span class=s>&#34;localhost&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>Port</span><span class=p>:</span> <span class=mi>6334</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>client</span><span class=p>.</span><span class=nf>Query</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>(),</span> <span class=o>&amp;</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>QueryPoints</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>CollectionName</span><span class=p>:</span> <span class=s>&#34;{collection_name}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>Query</span><span class=p>:</span>          <span class=nx>qdrant</span><span class=p>.</span><span class=nf>NewQuery</span><span class=p>(</span><span class=mf>0.2</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.9</span><span class=p>,</span> <span class=mf>0.7</span><span class=p>),</span>
</span></span><span class=line><span class=cl>	<span class=nx>Filter</span><span class=p>:</span> <span class=o>&amp;</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>Filter</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Must</span><span class=p>:</span> <span class=p>[]</span><span class=o>*</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>Condition</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>qdrant</span><span class=p>.</span><span class=nf>NewMatch</span><span class=p>(</span><span class=s>&#34;city&#34;</span><span class=p>,</span> <span class=s>&#34;London&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=nx>Params</span><span class=p>:</span> <span class=o>&amp;</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>SearchParams</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>HnswEf</span><span class=p>:</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nf>PtrOf</span><span class=p>(</span><span class=nb>uint64</span><span class=p>(</span><span class=mi>128</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=nx>Limit</span><span class=p>:</span>           <span class=nx>qdrant</span><span class=p>.</span><span class=nf>PtrOf</span><span class=p>(</span><span class=nb>uint64</span><span class=p>(</span><span class=mi>3</span><span class=p>)),</span>
</span></span><span class=line><span class=cl>	<span class=nx>ReadConsistency</span><span class=p>:</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nf>NewReadConsistencyType</span><span class=p>(</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>ReadConsistencyType_Majority</span><span class=p>),</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><h3 id=write-ordering>Write ordering</h3><p>Write <code>ordering</code> can be specified for any write request to serialize it through a single &ldquo;leader&rdquo; node,
which ensures that all write operations (issued with the same <code>ordering</code>) are performed and observed
sequentially.</p><ul><li><code>weak</code> <em>(default)</em> ordering does not provide any additional guarantees, so write operations can be freely reordered.</li><li><code>medium</code> ordering serializes all write operations through a dynamically elected leader, which might cause minor inconsistencies in case of leader change.</li><li><code>strong</code> ordering serializes all write operations through the permanent leader, which provides strong consistency, but write operations may be unavailable if the leader is down.</li></ul><aside role=status>Some <a href=#shard-transfer-method>shard transfer methods</a> may affect ordering guarantees.</aside><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>PUT /collections/{collection_name}/points?ordering=strong
</span></span></span><span class=line><span class=cl><span class=err>{
</span></span></span><span class=line><span class=cl><span class=err>    &#34;batch&#34;: {
</span></span></span><span class=line><span class=cl><span class=err>        &#34;ids&#34;: [1, 2, 3],
</span></span></span><span class=line><span class=cl><span class=err>        &#34;payloads&#34;: [
</span></span></span><span class=line><span class=cl><span class=err>            {&#34;color&#34;: &#34;red&#34;},
</span></span></span><span class=line><span class=cl><span class=err>            {&#34;color&#34;: &#34;green&#34;},
</span></span></span><span class=line><span class=cl><span class=err>            {&#34;color&#34;: &#34;blue&#34;}
</span></span></span><span class=line><span class=cl><span class=err>        ],
</span></span></span><span class=line><span class=cl><span class=err>        &#34;vectors&#34;: [
</span></span></span><span class=line><span class=cl><span class=err>            [0.9, 0.1, 0.1],
</span></span></span><span class=line><span class=cl><span class=err>            [0.1, 0.9, 0.1],
</span></span></span><span class=line><span class=cl><span class=err>            [0.1, 0.1, 0.9]
</span></span></span><span class=line><span class=cl><span class=err>        ]
</span></span></span><span class=line><span class=cl><span class=err>    }
</span></span></span><span class=line><span class=cl><span class=err>}
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>client</span><span class=o>.</span><span class=n>upsert</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>collection_name</span><span class=o>=</span><span class=s2>&#34;</span><span class=si>{collection_name}</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>points</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>Batch</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>ids</span><span class=o>=</span><span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=n>payloads</span><span class=o>=</span><span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=s2>&#34;color&#34;</span><span class=p>:</span> <span class=s2>&#34;red&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=s2>&#34;color&#34;</span><span class=p>:</span> <span class=s2>&#34;green&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span><span class=s2>&#34;color&#34;</span><span class=p>:</span> <span class=s2>&#34;blue&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=n>vectors</span><span class=o>=</span><span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=mf>0.9</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.9</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.9</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>ordering</span><span class=o>=</span><span class=n>models</span><span class=o>.</span><span class=n>WriteOrdering</span><span class=o>.</span><span class=n>STRONG</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=line><span class=cl><span class=nx>client</span><span class=p>.</span><span class=nx>upsert</span><span class=p>(</span><span class=s2>&#34;{collection_name}&#34;</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>batch</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>ids</span><span class=o>:</span> <span class=p>[</span><span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>3</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nx>payloads</span><span class=o>:</span> <span class=p>[{</span> <span class=nx>color</span><span class=o>:</span> <span class=s2>&#34;red&#34;</span> <span class=p>},</span> <span class=p>{</span> <span class=nx>color</span><span class=o>:</span> <span class=s2>&#34;green&#34;</span> <span class=p>},</span> <span class=p>{</span> <span class=nx>color</span><span class=o>:</span> <span class=s2>&#34;blue&#34;</span> <span class=p>}],</span>
</span></span><span class=line><span class=cl>    <span class=nx>vectors</span><span class=o>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>      <span class=p>[</span><span class=mf>0.9</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=p>[</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.9</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>],</span>
</span></span><span class=line><span class=cl>      <span class=p>[</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.9</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=nx>ordering</span><span class=o>:</span> <span class=s2>&#34;strong&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>use</span><span class=w> </span><span class=n>qdrant_client</span>::<span class=n>qdrant</span>::<span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>PointStruct</span><span class=p>,</span><span class=w> </span><span class=n>UpsertPointsBuilder</span><span class=p>,</span><span class=w> </span><span class=n>WriteOrdering</span><span class=p>,</span><span class=w> </span><span class=n>WriteOrderingType</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>};</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>use</span><span class=w> </span><span class=n>qdrant_client</span>::<span class=n>Qdrant</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kd>let</span><span class=w> </span><span class=n>client</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>Qdrant</span>::<span class=n>from_url</span><span class=p>(</span><span class=s>&#34;http://localhost:6334&#34;</span><span class=p>).</span><span class=n>build</span><span class=p>()</span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>client</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=n>upsert_points</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UpsertPointsBuilder</span>::<span class=n>new</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=s>&#34;{collection_name}&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=fm>vec!</span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>PointStruct</span>::<span class=n>new</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=w> </span><span class=fm>vec!</span><span class=p>[</span><span class=mf>0.9</span><span class=p>,</span><span class=w> </span><span class=mf>0.1</span><span class=p>,</span><span class=w> </span><span class=mf>0.1</span><span class=p>],</span><span class=w> </span><span class=p>[(</span><span class=s>&#34;color&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;red&#34;</span><span class=p>.</span><span class=n>into</span><span class=p>())]),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>PointStruct</span>::<span class=n>new</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span><span class=w> </span><span class=fm>vec!</span><span class=p>[</span><span class=mf>0.1</span><span class=p>,</span><span class=w> </span><span class=mf>0.9</span><span class=p>,</span><span class=w> </span><span class=mf>0.1</span><span class=p>],</span><span class=w> </span><span class=p>[(</span><span class=s>&#34;color&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;green&#34;</span><span class=p>.</span><span class=n>into</span><span class=p>())]),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>PointStruct</span>::<span class=n>new</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=w> </span><span class=fm>vec!</span><span class=p>[</span><span class=mf>0.1</span><span class=p>,</span><span class=w> </span><span class=mf>0.1</span><span class=p>,</span><span class=w> </span><span class=mf>0.9</span><span class=p>],</span><span class=w> </span><span class=p>[(</span><span class=s>&#34;color&#34;</span><span class=p>,</span><span class=w> </span><span class=s>&#34;blue&#34;</span><span class=p>.</span><span class=n>into</span><span class=p>())]),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>.</span><span class=n>ordering</span><span class=p>(</span><span class=n>WriteOrdering</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=n>r#type</span>: <span class=nc>WriteOrderingType</span>::<span class=n>Strong</span><span class=p>.</span><span class=n>into</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=p>}),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=k>await</span><span class=o>?</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kn>import</span><span class=w> </span><span class=nn>java.util.List</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>java.util.Map</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>io.qdrant.client.PointIdFactory.id</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>io.qdrant.client.ValueFactory.value</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import static</span><span class=w> </span><span class=nn>io.qdrant.client.VectorsFactory.vectors</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Points.PointStruct</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Points.UpsertPoints</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Points.WriteOrdering</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=kn>import</span><span class=w> </span><span class=nn>io.qdrant.client.grpc.Points.WriteOrderingType</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>client</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>upsertAsync</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=n>UpsertPoints</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setCollectionName</span><span class=p>(</span><span class=s>&#34;{collection_name}&#34;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>addAllPoints</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                </span><span class=n>List</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>PointStruct</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>setId</span><span class=p>(</span><span class=n>id</span><span class=p>(</span><span class=n>1</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>setVectors</span><span class=p>(</span><span class=n>vectors</span><span class=p>(</span><span class=n>0</span><span class=p>.</span><span class=na>9f</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>.</span><span class=na>1f</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>.</span><span class=na>1f</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>putAllPayload</span><span class=p>(</span><span class=n>Map</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;color&#34;</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>(</span><span class=s>&#34;red&#34;</span><span class=p>)))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>build</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>PointStruct</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>setId</span><span class=p>(</span><span class=n>id</span><span class=p>(</span><span class=n>2</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>setVectors</span><span class=p>(</span><span class=n>vectors</span><span class=p>(</span><span class=n>0</span><span class=p>.</span><span class=na>1f</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>.</span><span class=na>9f</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>.</span><span class=na>1f</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>putAllPayload</span><span class=p>(</span><span class=n>Map</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;color&#34;</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>(</span><span class=s>&#34;green&#34;</span><span class=p>)))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>build</span><span class=p>(),</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                    </span><span class=n>PointStruct</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>()</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>setId</span><span class=p>(</span><span class=n>id</span><span class=p>(</span><span class=n>3</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>setVectors</span><span class=p>(</span><span class=n>vectors</span><span class=p>(</span><span class=n>0</span><span class=p>.</span><span class=na>1f</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>.</span><span class=na>1f</span><span class=p>,</span><span class=w> </span><span class=n>0</span><span class=p>.</span><span class=na>94f</span><span class=p>))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>putAllPayload</span><span class=p>(</span><span class=n>Map</span><span class=p>.</span><span class=na>of</span><span class=p>(</span><span class=s>&#34;color&#34;</span><span class=p>,</span><span class=w> </span><span class=n>value</span><span class=p>(</span><span class=s>&#34;blue&#34;</span><span class=p>)))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                        </span><span class=p>.</span><span class=na>build</span><span class=p>()))</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>setOrdering</span><span class=p>(</span><span class=n>WriteOrdering</span><span class=p>.</span><span class=na>newBuilder</span><span class=p>().</span><span class=na>setType</span><span class=p>(</span><span class=n>WriteOrderingType</span><span class=p>.</span><span class=na>Strong</span><span class=p>).</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=p>.</span><span class=na>build</span><span class=p>())</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=p>.</span><span class=na>get</span><span class=p>();</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-csharp data-lang=csharp><span class=line><span class=cl><span class=k>using</span> <span class=nn>Qdrant.Client</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>using</span> <span class=nn>Qdrant.Client.Grpc</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>var</span> <span class=n>client</span> <span class=p>=</span> <span class=k>new</span> <span class=n>QdrantClient</span><span class=p>(</span><span class=s>&#34;localhost&#34;</span><span class=p>,</span> <span class=m>6334</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>await</span> <span class=n>client</span><span class=p>.</span><span class=n>UpsertAsync</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=n>collectionName</span><span class=p>:</span> <span class=s>&#34;{collection_name}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=n>points</span><span class=p>:</span> <span class=k>new</span> <span class=n>List</span><span class=p>&lt;</span><span class=n>PointStruct</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>new</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=n>Id</span> <span class=p>=</span> <span class=m>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=n>Vectors</span> <span class=p>=</span> <span class=k>new</span><span class=p>[]</span> <span class=p>{</span> <span class=m>0.9f</span><span class=p>,</span> <span class=m>0.1f</span><span class=p>,</span> <span class=m>0.1f</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>			<span class=n>Payload</span> <span class=p>=</span> <span class=p>{</span> <span class=p>[</span><span class=s>&#34;color&#34;</span><span class=p>]</span> <span class=p>=</span> <span class=s>&#34;red&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=k>new</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=n>Id</span> <span class=p>=</span> <span class=m>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=n>Vectors</span> <span class=p>=</span> <span class=k>new</span><span class=p>[]</span> <span class=p>{</span> <span class=m>0.1f</span><span class=p>,</span> <span class=m>0.9f</span><span class=p>,</span> <span class=m>0.1f</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>			<span class=n>Payload</span> <span class=p>=</span> <span class=p>{</span> <span class=p>[</span><span class=s>&#34;color&#34;</span><span class=p>]</span> <span class=p>=</span> <span class=s>&#34;green&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=k>new</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=n>Id</span> <span class=p>=</span> <span class=m>3</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=n>Vectors</span> <span class=p>=</span> <span class=k>new</span><span class=p>[]</span> <span class=p>{</span> <span class=m>0.1f</span><span class=p>,</span> <span class=m>0.1f</span><span class=p>,</span> <span class=m>0.9f</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>			<span class=n>Payload</span> <span class=p>=</span> <span class=p>{</span> <span class=p>[</span><span class=s>&#34;color&#34;</span><span class=p>]</span> <span class=p>=</span> <span class=s>&#34;blue&#34;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=n>ordering</span><span class=p>:</span> <span class=n>WriteOrderingType</span><span class=p>.</span><span class=n>Strong</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;context&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/qdrant/go-client/qdrant&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>client</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nf>NewClient</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>Config</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Host</span><span class=p>:</span> <span class=s>&#34;localhost&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>Port</span><span class=p>:</span> <span class=mi>6334</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>client</span><span class=p>.</span><span class=nf>Upsert</span><span class=p>(</span><span class=nx>context</span><span class=p>.</span><span class=nf>Background</span><span class=p>(),</span> <span class=o>&amp;</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>UpsertPoints</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>CollectionName</span><span class=p>:</span> <span class=s>&#34;{collection_name}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>Points</span><span class=p>:</span> <span class=p>[]</span><span class=o>*</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>PointStruct</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>Id</span><span class=p>:</span>      <span class=nx>qdrant</span><span class=p>.</span><span class=nf>NewIDNum</span><span class=p>(</span><span class=mi>1</span><span class=p>),</span>
</span></span><span class=line><span class=cl>			<span class=nx>Vectors</span><span class=p>:</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nf>NewVectors</span><span class=p>(</span><span class=mf>0.9</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>),</span>
</span></span><span class=line><span class=cl>			<span class=nx>Payload</span><span class=p>:</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nf>NewValueMap</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>{</span><span class=s>&#34;color&#34;</span><span class=p>:</span> <span class=s>&#34;red&#34;</span><span class=p>}),</span>
</span></span><span class=line><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>Id</span><span class=p>:</span>      <span class=nx>qdrant</span><span class=p>.</span><span class=nf>NewIDNum</span><span class=p>(</span><span class=mi>2</span><span class=p>),</span>
</span></span><span class=line><span class=cl>			<span class=nx>Vectors</span><span class=p>:</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nf>NewVectors</span><span class=p>(</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.9</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>),</span>
</span></span><span class=line><span class=cl>			<span class=nx>Payload</span><span class=p>:</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nf>NewValueMap</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>{</span><span class=s>&#34;color&#34;</span><span class=p>:</span> <span class=s>&#34;green&#34;</span><span class=p>}),</span>
</span></span><span class=line><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>Id</span><span class=p>:</span>      <span class=nx>qdrant</span><span class=p>.</span><span class=nf>NewIDNum</span><span class=p>(</span><span class=mi>3</span><span class=p>),</span>
</span></span><span class=line><span class=cl>			<span class=nx>Vectors</span><span class=p>:</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nf>NewVectors</span><span class=p>(</span><span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.1</span><span class=p>,</span> <span class=mf>0.9</span><span class=p>),</span>
</span></span><span class=line><span class=cl>			<span class=nx>Payload</span><span class=p>:</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nf>NewValueMap</span><span class=p>(</span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>any</span><span class=p>{</span><span class=s>&#34;color&#34;</span><span class=p>:</span> <span class=s>&#34;blue&#34;</span><span class=p>}),</span>
</span></span><span class=line><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=nx>Ordering</span><span class=p>:</span> <span class=o>&amp;</span><span class=nx>qdrant</span><span class=p>.</span><span class=nx>WriteOrdering</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Type</span><span class=p>:</span> <span class=nx>qdrant</span><span class=p>.</span><span class=nx>WriteOrderingType_Strong</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></div><h2 id=listener-mode>Listener mode</h2><aside role=alert>This is an experimental feature, its behavior may change in the future.</aside><p>In some cases it might be useful to have a Qdrant node that only accumulates data and does not participate in search operations.
There are several scenarios where this can be useful:</p><ul><li>Listener option can be used to store data in a separate node, which can be used for backup purposes or to store data for a long time.</li><li>Listener node can be used to synchronize data into another region, while still performing search operations in the local region.</li></ul><p>To enable listener mode, set <code>node_type</code> to <code>Listener</code> in the config file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>storage</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>node_type</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;Listener&#34;</span><span class=w>
</span></span></span></code></pre></div><p>Listener node will not participate in search operations, but will still accept write operations and will store the data in the local storage.</p><p>All shards, stored on the listener node, will be converted to the <code>Listener</code> state.</p><p>Additionally, all write requests sent to the listener node will be processed with <code>wait=false</code> option, which means that the write oprations will be considered successful once they are written to WAL.
This mechanism should allow to minimize upsert latency in case of parallel snapshotting.</p><h2 id=consensus-checkpointing>Consensus Checkpointing</h2><p>Consensus checkpointing is a technique used in Raft to improve performance and simplify log management by periodically creating a consistent snapshot of the system state.
This snapshot represents a point in time where all nodes in the cluster have reached agreement on the state, and it can be used to truncate the log, reducing the amount of data that needs to be stored and transferred between nodes.</p><p>For example, if you attach a new node to the cluster, it should replay all the log entries to catch up with the current state.
In long-running clusters, this can take a long time, and the log can grow very large.</p><p>To prevent this, one can use a special checkpointing mechanism, that will truncate the log and create a snapshot of the current state.</p><p>To use this feature, simply call the <code>/cluster/recover</code> API on required node:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>POST /cluster/recover
</span></span></span></code></pre></div><p>This API can be triggered on any non-leader node, it will send a request to the current consensus leader to create a snapshot. The leader will in turn send the snapshot back to the requesting node for application.</p><p>In some cases, this API can be used to recover from an inconsistent cluster state by forcing a snapshot creation.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>Weak ordering for updates: All records are streamed to the target node in order.
New updates are received on the target node in parallel, while the transfer
of records is still happening. We therefore have <code>weak</code> ordering, regardless
of what <a href=#write-ordering>ordering</a> is used for updates.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a>&#160;<a href=#fnref1:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>Strong ordering for updates: A snapshot of the shard
is created, it is transferred and recovered on the target node. That ensures
the state of the shard is kept consistent. New updates are queued on the
source node, and transferred in order to the target node. Updates therefore
have the same <a href=#write-ordering>ordering</a> as the user selects, making
<code>strong</code> ordering possible.&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a>&#160;<a href=#fnref1:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a>&#160;<a href=#fnref2:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a>&#160;<a href=#fnref3:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></article><section class="docs-feedback d-print-none"><h5 class=docs-feedback__title>Was this page useful?</h5><div class=docs-feedback__buttons><button class="button button_outlined button_sm docs-feedback__button" id=feedback__answer_yes>
<img src=https://qdrant.tech/icons/outline/thumb-up.svg alt="Thumb up icon">
Yes
</button>
<button class="button button_outlined button_sm docs-feedback__button" id=feedback__answer_no>
<img src=https://qdrant.tech/icons/outline/thumb-down.svg alt="Thumb down icon">
No</button></div></section><section class="docs-feedback__responses d-none"><p class="docs-feedback__response docs-feedback__response_yes" id=feedback__response_yes>Thank you for your feedback! üôè</p><p class="docs-feedback__response docs-feedback__response_no" id=feedback__response_no>We are sorry to hear that. üòî You can <a class=text-brand-p href=https:/github.com/qdrant/landing_page/tree/master/qdrant-landing/content/documentation/guides/distributed_deployment.md target=_blank>edit</a> this page on GitHub, or <a class=text-brand-p href=https://github.com/qdrant/landing_page/issues/new/choose target=_blank>create</a> a GitHub issue.</p></section><script>const buttonsSection=document.querySelector(".docs-feedback"),responsesSection=document.querySelector(".docs-feedback__responses"),yesButton=document.querySelector("#feedback__answer_yes"),noButton=document.querySelector("#feedback__answer_no"),yesResponse=document.querySelector("#feedback__response_yes"),noResponse=document.querySelector("#feedback__response_no"),toggleResponses=()=>{buttonsSection.classList.add("d-none"),responsesSection.classList.remove("d-none")};yesButton.addEventListener("click",()=>{yesResponse.classList.add("feedback__response_visible"),toggleResponses()}),noButton.addEventListener("click",()=>{noResponse.classList.add("feedback__response_visible"),toggleResponses()})</script></div><div class=table-of-contents><p class=table-of-contents__head>On this page:</p><nav id=TableOfContents><ul><li><a href=#distributed-deployment>Distributed deployment</a><ul><li><a href=#how-many-qdrant-nodes-should-i-run>How many Qdrant nodes should I run?</a></li><li><a href=#enabling-distributed-mode-in-self-hosted-qdrant>Enabling distributed mode in self-hosted Qdrant</a></li><li><a href=#enabling-distributed-mode-in-qdrant-cloud>Enabling distributed mode in Qdrant Cloud</a></li><li><a href=#making-use-of-a-new-distributed-qdrant-cluster>Making use of a new distributed Qdrant cluster</a></li><li><a href=#raft>Raft</a></li><li><a href=#sharding>Sharding</a><ul><li><a href=#choosing-the-right-number-of-shards>Choosing the right number of shards</a></li><li><a href=#resharding>Resharding</a></li><li><a href=#moving-shards>Moving shards</a></li><li><a href=#user-defined-sharding>User-defined sharding</a></li><li><a href=#shard-transfer-method>Shard transfer method</a></li></ul></li><li><a href=#replication>Replication</a><ul><li><a href=#replication-factor>Replication factor</a></li><li><a href=#creating-new-shard-replicas>Creating new shard replicas</a></li><li><a href=#error-handling>Error handling</a></li><li><a href=#node-failure-recovery>Node Failure Recovery</a></li><li><a href=#temporary-node-failure>Temporary node failure</a></li></ul></li><li><a href=#consistency-guarantees>Consistency guarantees</a><ul><li><a href=#write-consistency-factor>Write consistency factor</a></li><li><a href=#read-consistency>Read consistency</a></li><li><a href=#write-ordering>Write ordering</a></li></ul></li><li><a href=#listener-mode>Listener mode</a></li><li><a href=#consensus-checkpointing>Consensus Checkpointing</a></li></ul></li></ul></nav><ul class=table-of-contents__external-links><li class=table-of-contents__link><a href=https://github.com/qdrant/landing_page/tree/master/qdrant-landing/content/documentation/guides/distributed_deployment.md target=_blank><svg width="16" height="17" viewBox="0 0 16 17" fill="none"><g clip-path="url(#clip0_6269_955)"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 .700012c-4.4.0-8 3.599998-8 7.999998C0 12.2333 2.26667 15.2333 5.46667 16.3 5.86667 16.3667 6 16.1 6 15.9S6 15.2333 6 14.5667C3.8 15.0333 3.33333 13.5 3.33333 13.5 3 12.5667 2.46667 12.3 2.46667 12.3 1.66667 11.8333 2.46667 11.8333 2.46667 11.8333 3.26667 11.9 3.66667 12.6333 3.66667 12.6333 4.4 13.8333 5.53333 13.5 6 13.3 6.06667 12.7667 6.26667 12.4333 6.53333 12.2333 4.73333 12.0333 2.86667 11.3667 2.86667 8.30001c0-.86666.33333-1.6.8-2.13333.0-.26667-.33334-1.06667.13333-2.13333.0.0.66667-.200000000000001 2.2.8.66667-.2 1.33333-.26667 2-.26667S9.33333 4.63335 10 4.83335c1.5333-1.06667 2.2-.8 2.2-.8C12.6667 5.16668 12.3333 5.96668 12.2667 6.16668 12.8 6.70001 13.0667 7.43335 13.0667 8.30001c0 3.06669-1.8667 3.73329-3.6667 3.93329C9.66667 12.5 9.93333 12.9667 9.93333 13.7c0 1.0667.0 1.9333.0 2.2C9.93333 16.1 10.0667 16.3667 10.4667 16.3c3.2-1.0667 5.4666-4.0667 5.4666-7.59999C16 4.30001 12.4.700012 8 .700012z" fill="#f0f3fa"/></g><defs><clipPath id="clip0_6269_955"><rect width="16" height="16" fill="#fff" transform="translate(0 0.5)"/></clipPath></defs></svg>
Edit on Github</a></li><li class=table-of-contents__link><a href=https://github.com/qdrant/landing_page/issues/new/choose target=_blank><svg width="16" height="17" viewBox="0 0 16 17" fill="none"><g clip-path="url(#clip0_6269_1540)"><path d="M16 9.83331V8.49998H13.9347C13.79 7.33465 13.3947 6.24065 12.8 5.31065l1.476-1.478L13.3327 2.89065 11.9633 4.26198c-.24-.248-.496600000000001-.474-.772-.676C11.0967 3.25665 10.9507 2.95398 10.7673 2.67598l1.038-1.038L10.8627.695312 9.82867 1.72931C9.29867 1.37798 8.672 1.16665 8 1.16665c-.672.0-1.29867.21133-1.828.56266L5.138.695312l-.94267.942668 1.038 1.038c-.18333.27733-.32933.58-.424.90867-.27533.202-.532.42933-.77266.67733L2.66733 2.89065l-.94333.942L3.2 5.30998c-.59467.93-.99 2.02467-1.13467 3.19H0V9.83331H2.01467C2.07333 11.276 2.50533 12.6026 3.204 13.688l-1.48 1.478L2.666 16.1093l1.37-1.368C4.93733 15.67 6.07667 16.288 7.33333 16.452V6.49998H8.66667V16.452C9.92333 16.2873 11.0627 15.67 11.964 14.7413l1.37 1.368L14.276 15.166l-1.48-1.478C13.4947 12.602 13.9267 11.2753 13.9853 9.83331H16z" fill="#f0f3fa"/></g><defs><clipPath id="clip0_6269_1540"><rect width="16" height="16" fill="#fff" transform="translate(0 0.5)"/></clipPath></defs></svg>
Create an issue</a></li></ul></div><footer class="docs-footer w-100 py-0 pt-0 pb-4 pb-xl-0"><div class=docs-footer__cta><h4>Ready to get started with Qdrant?</h4><a href=https://qdrant.to/cloud/ class="button button_outlined button_sm" target=_blank>Start Free</a></div><div class=docs-footer__bottom><div class=docs-footer__bottom-content><span>¬© 2025 Qdrant.</span><div class=footer__bottom-links><a href=https://qdrant.tech/legal/terms_and_conditions/>Terms</a>
<a href=https://qdrant.tech/legal/privacy-policy/>Privacy Policy</a>
<a href=https://qdrant.tech/legal/impressum/>Impressum</a></div></div></div></footer></div></div></div></div></section></main></body><script src=https://cdn.cookielaw.org/scripttemplates/otSDKStub.js type=text/javascript data-domain-script=01960152-5e40-782d-af01-f7f5768a214e></script><script async type=text/javascript>function OptanonWrapper(){const e=new CustomEvent("onetrust_loaded");document.dispatchEvent(e)}</script><script>!function(){const o="eQYi1nZE2zQSmnHuxjMRlDd2uLl65oHe";var n,s,t="analytics",e=window[t]=window[t]||[];if(!e.initialize)if(e.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{e.invoked=!0,e.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","screen","once","off","on","addSourceMiddleware","addIntegrationMiddleware","setAnonymousId","addDestinationMiddleware","register"],e.factory=function(n){return function(){if(window[t].initialized)return window[t][n].apply(window[t],arguments);var o,s=Array.prototype.slice.call(arguments);return["track","screen","alias","group","page","identify"].indexOf(n)>-1&&(o=document.querySelector("link[rel='canonical']"),s.push({__t:"bpc",c:o&&o.getAttribute("href")||void 0,p:location.pathname,u:location.href,s:location.search,t:document.title,r:document.referrer})),s.unshift(n),e.push(s),e}};for(n=0;n<e.methods.length;n++)s=e.methods[n],e[s]=e.factory(s);e.load=function(n,s){var i,o=document.createElement("script");o.type="text/javascript",o.async=!0,o.setAttribute("data-global-segment-analytics-key",t),o.src="https://evs.analytics.qdrant.tech/5caWuitPgcGFN5Q7HMpTaj/vEkmzjuRSqeXGbhGAFTWex.min.js",i=document.getElementsByTagName("script")[0],i.parentNode.insertBefore(o,i),e._loadOptions=s},e._writeKey=o,e._cdn="https://evs.analytics.qdrant.tech",e.SNIPPET_VERSION="5.2.0",e.load(o)}}()</script><script src=https://qdrant.tech/js/google-setup.min.14728a3ae9bd931593645b6ddbfe801d400cd2970006e782cb67f3966654248ca962dbaf4cf371493a2d326861b3a691a99d6d8349c8b2752339ab91d3787069.js></script><script src=https://qdrant.tech/js/index.min.e37feda1952d752f5568e1ebc55e183629e4d361f4df09edeed70b4a4327d601161c4147bdbe4149b4a3cdc1ed43f1bf1a2f2340a421f1aa821103980dfe0bda.js></script><script src=https://qdrant.tech/js/search/search.min.e58e7ea98cb549ea9d3ed7e68876abe323cfb323432038820f38a71c40e309deed0fba615e2d3346825229a81e0a76bbadf6f8a816ddad3438abdabfef4ebc09.js type=module></script><script src=https://qdrant.tech/js/search/scroll.min.f4ed4453a3af0adb0d4f49333cbb7892ff5430483a567d0d2dfbd4655fb203d22f22f46aff3d9f38fa5fd96dde5f30227afd0ce1d9f838f5cd5295fc83856ec9.js></script><script src=https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js></script><script src=https://qdrant.tech/js/copy-code.min.95b03a45b2ab4b7a608ecfd4b5919c8572a5b2cd1463f52561cd10976abf3b74334f91324c0e620cb80afac46026a0b18cce6fb753d8495f74c6d478c8ca1d03.js></script><script src=https://qdrant.tech/js/lang-switcher.min.63da11cef09772078425b1ee56415b9c37842a9399f2ba2d2f5efbf72fb751686c410bd50e9bcd283c8231cb97c1973199d4923beef29d8b06e59d9983a6ba51.js></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src=https://qdrant.tech/js/vendor/anchor.min.0e138e17ebcf1c1147a7a3a81d9ac3c601622eedc479f1636470eb2552470f4e27c9a8efe6e8378995dedc1ab67029d8989536ea76f0857d45d1615ae772b8a1.js></script><script>document.addEventListener("keydown",function(e){if((e.metaKey||e.ctrlKey)&&e.key==="k"){e.preventDefault();let t=document.querySelector('[data-target="#searchModal"]');t&&t?.click()}})</script><script>window.addEventListener("message",e=>{if(e.data.type==="hsFormCallback"&&e.data.eventName==="onFormReady"){const t=document.querySelector(`form[data-form-id="${e.data.id}"]`);if(t){const e=t.querySelector('[name="last_form_fill_url"]');e&&(e.value=window.location.href);const n=t.querySelector('[name="referrer_url"]');n&&(n.value=document.referrer)}}})</script></html>