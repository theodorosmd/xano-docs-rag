<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><title>Retrieving Privacy-Safe Documents Over A Network — LlamaIndex - Build Knowledge Assistants over your Enterprise Data</title><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#da532c"/><meta name="theme-color" content="#ffffff"/><meta name="title" content="Retrieving Privacy-Safe Documents Over A Network — LlamaIndex - Build Knowledge Assistants over your Enterprise Data"/><meta name="description" content="LlamaIndex is a simple, flexible framework for building knowledge assistants using LLMs connected to your enterprise data."/><meta property="og:title" content="Retrieving Privacy-Safe Documents Over A Network — LlamaIndex - Build Knowledge Assistants over your Enterprise Data"/><meta property="og:description" content="LlamaIndex is a simple, flexible framework for building knowledge assistants using LLMs connected to your enterprise data."/><meta property="og:image" content="https://cdn.sanity.io/images/7m9jw85w/production/5b3a6ecd398b62a55cf79480874b0b2de87e124b-2413x2332.png"/><meta property="twitter:card" content="summary_large_image"/><meta property="twitter:title" content="Retrieving Privacy-Safe Documents Over A Network — LlamaIndex - Build Knowledge Assistants over your Enterprise Data"/><meta property="twitter:description" content="LlamaIndex is a simple, flexible framework for building knowledge assistants using LLMs connected to your enterprise data."/><meta property="twitter:image" content="https://cdn.sanity.io/images/7m9jw85w/production/5b3a6ecd398b62a55cf79480874b0b2de87e124b-2413x2332.png"/><link rel="alternate" type="application/rss+xml" href="https://www.llamaindex.ai/blog/feed"/><meta name="next-head-count" content="20"/><script>
            (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WWRFB36R');
            </script><link rel="preload" href="/_next/static/css/41c9222e47d080c9.css" as="style"/><link rel="stylesheet" href="/_next/static/css/41c9222e47d080c9.css" data-n-g=""/><link rel="preload" href="/_next/static/css/97c33c8d95f1230e.css" as="style"/><link rel="stylesheet" href="/_next/static/css/97c33c8d95f1230e.css" data-n-p=""/><link rel="preload" href="/_next/static/css/e009059e80bf60c5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e009059e80bf60c5.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-1b629d9c8fb16f34.js" defer=""></script><script src="/_next/static/chunks/framework-df1f68dff096b68a.js" defer=""></script><script src="/_next/static/chunks/main-eca7952a704663f8.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c7c49437be49d2ad.js" defer=""></script><script src="/_next/static/chunks/d9067523-4985945b21298365.js" defer=""></script><script src="/_next/static/chunks/41155975-60c12da9ce9fa0b2.js" defer=""></script><script src="/_next/static/chunks/cb355538-cee2ea45674d9de3.js" defer=""></script><script src="/_next/static/chunks/9494-dff62cb53535dd7d.js" defer=""></script><script src="/_next/static/chunks/4063-39a391a51171ff87.js" defer=""></script><script src="/_next/static/chunks/6889-edfa85b69b88a372.js" defer=""></script><script src="/_next/static/chunks/5575-11ee0a29eaffae61.js" defer=""></script><script src="/_next/static/chunks/3444-95c636af25a42734.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bslug%5D-82c8e764e69afd2c.js" defer=""></script><script src="/_next/static/C8J-EMc_4OCN1ch65l4fl/_buildManifest.js" defer=""></script><script src="/_next/static/C8J-EMc_4OCN1ch65l4fl/_ssgManifest.js" defer=""></script></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WWRFB36R" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="__next"><div class="__variable_d65c78 __variable_b1ea77 __variable_eb7534"><a class="Announcement_announcement__2ohK8" href="http://48755185.hs-sites.com/llamaindex-0">Meet LlamaIndex at the Databricks Data + AI Summit!<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M8.293 5.293a1 1 0 0 1 1.414 0l6 6a1 1 0 0 1 0 1.414l-6 6a1 1 0 0 1-1.414-1.414L13.586 12 8.293 6.707a1 1 0 0 1 0-1.414Z" clip-rule="evenodd"></path></svg></a><header class="Header_header__hO3lJ"><button class="Hamburger_hamburger__17auO Header_hamburger__lUulX"><svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3.5 14H24.5" stroke="#212121" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" id="hamburger-stroke-top" class="Hamburger_hamburgerStrokeMiddle__I7VpD"></path><path d="M3.5 7H24.5" stroke="#212121" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="Hamburger_hamburgerStrokeTop__oOhFM"></path><path d="M3.5 21H24.5" stroke="#212121" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="Hamburger_hamburgerStrokeBottom__GIQR2"></path></svg></button><a aria-label="Homepage" href="/"><img alt="LlamaIndex" loading="lazy" width="213" height="42" decoding="async" data-nimg="1" class="Header_logo__e5KhT" style="color:transparent" src="/llamaindex.svg"/></a><nav aria-label="Main" data-orientation="horizontal" dir="ltr" style="--content-position:0px"><div style="position:relative"><ul data-orientation="horizontal" class="Nav_MenuList__PrCDJ" dir="ltr"><li><button id="radix-:R6tm:-trigger-radix-:R5mtm:" data-state="closed" aria-expanded="false" aria-controls="radix-:R6tm:-content-radix-:R5mtm:" class="Nav_Trigger__ws43x" data-radix-collection-item="">Products</button></li><li><button id="radix-:R6tm:-trigger-radix-:R9mtm:" data-state="closed" aria-expanded="false" aria-controls="radix-:R6tm:-content-radix-:R9mtm:" class="Nav_Trigger__ws43x" data-radix-collection-item="">Solutions</button></li><li><a class="Nav_Link__ZrzFc" href="/community" data-radix-collection-item="">Community</a></li><li><a class="Nav_Link__ZrzFc" href="/pricing" data-radix-collection-item="">Pricing</a></li><li><a class="Nav_Link__ZrzFc" href="/blog" data-radix-collection-item="">Blog</a></li><li><a class="Nav_Link__ZrzFc" href="/customers" data-radix-collection-item="">Customer stories</a></li><li><a class="Nav_Link__ZrzFc" href="/careers" data-radix-collection-item="">Careers</a></li></ul></div><div class="Nav_ViewportPosition__jmyHM"></div></nav><div class="Header_secondNav__YJvm8"><nav><a href="/contact" class="Link_link__71cl8 Link_link-variant-tertiary__BYxn_ Header_bookADemo__qCuxV">Book a demo</a></nav><a href="https://cloud.llamaindex.ai/" class="Button_button-variant-default__Oi__n Button_button__aJ0V6 Header_button__1HFhY" data-tracking-variant="default"> <!-- -->Get started</a></div><div class="MobileMenu_mobileMenu__g5Fa6"><nav class="MobileMenu_nav__EmtTw"><ul><li><details class="MobileMenu_ListItem__yMtVi"><summary class="MobileMenu_ListItemHeading___yPC6">Products<!-- --> <span class="MobileMenu_icon__6gmaF"><svg width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 1L5.5 5L1 1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></span></summary><ul class="MobileMenu_List__XjJr0"><li><a class="MobileMenu_ListItemLink__dnvmV" href="/llamaparse"><div class="MobileMenu_ListItemHeading___yPC6"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.6654 1.66675V6.66675H16.6654M8.33203 10.8334L6.66536 12.5001L8.33203 14.1667M11.6654 14.1667L13.332 12.5001L11.6654 10.8334M12.082 1.66675H4.9987C4.55667 1.66675 4.13275 1.84234 3.82019 2.1549C3.50763 2.46746 3.33203 2.89139 3.33203 3.33341V16.6667C3.33203 17.1088 3.50763 17.5327 3.82019 17.8453C4.13275 18.1578 4.55667 18.3334 4.9987 18.3334H14.9987C15.4407 18.3334 15.8646 18.1578 16.1772 17.8453C16.4898 17.5327 16.6654 17.1088 16.6654 16.6667V6.25008L12.082 1.66675Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>Document parsing</div><p class="MobileMenu_ListItemText__n_MHY">The first and leading GenAI-native parser over your most complex data.</p></a></li><li><a class="MobileMenu_ListItemLink__dnvmV" href="/llamaextract"><div class="MobileMenu_ListItemHeading___yPC6"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M11.668 1.66675V5.00008C11.668 5.44211 11.8436 5.86603 12.1561 6.17859C12.4687 6.49115 12.8926 6.66675 13.3346 6.66675H16.668M3.33464 5.83341V3.33341C3.33464 2.89139 3.51023 2.46746 3.82279 2.1549C4.13535 1.84234 4.55927 1.66675 5.0013 1.66675H12.5013L16.668 5.83341V16.6667C16.668 17.1088 16.4924 17.5327 16.1798 17.8453C15.8672 18.1578 15.4433 18.3334 15.0013 18.3334L5.05379 18.3326C4.72458 18.3755 4.39006 18.3191 4.09312 18.1706C3.79618 18.0221 3.55034 17.7884 3.38713 17.4992M4.16797 9.16675L1.66797 11.6667M1.66797 11.6667L4.16797 14.1667M1.66797 11.6667H10.0013" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>Data extraction</div><p class="MobileMenu_ListItemText__n_MHY">Extract structured data from documents using a schema-driven engine.</p></a></li><li><a class="MobileMenu_ListItemLink__dnvmV" href="/enterprise"><div class="MobileMenu_ListItemHeading___yPC6"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9.16667 15.8333C12.8486 15.8333 15.8333 12.8486 15.8333 9.16667C15.8333 5.48477 12.8486 2.5 9.16667 2.5C5.48477 2.5 2.5 5.48477 2.5 9.16667C2.5 12.8486 5.48477 15.8333 9.16667 15.8333Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M17.5 17.5L13.875 13.875" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>Knowledge Management</div><p class="MobileMenu_ListItemText__n_MHY">Connect, transform, and index your enterprise data into an agent-accessible knowledge base</p></a></li><li><a class="MobileMenu_ListItemLink__dnvmV" href="/framework"><div class="MobileMenu_ListItemHeading___yPC6"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.0013 6.66659V3.33325H6.66797M1.66797 11.6666H3.33464M16.668 11.6666H18.3346M12.5013 10.8333V12.4999M7.5013 10.8333V12.4999M5.0013 6.66659H15.0013C15.9218 6.66659 16.668 7.41278 16.668 8.33325V14.9999C16.668 15.9204 15.9218 16.6666 15.0013 16.6666H5.0013C4.08083 16.6666 3.33464 15.9204 3.33464 14.9999V8.33325C3.33464 7.41278 4.08083 6.66659 5.0013 6.66659Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>Agent Framework</div><p class="MobileMenu_ListItemText__n_MHY">Orchestrate and deploy multi-agent applications over your data with the #1 agent framework.</p></a></li></ul></details></li><li><details class="MobileMenu_ListItem__yMtVi"><summary class="MobileMenu_ListItemHeading___yPC6">Solutions<!-- --> <span class="MobileMenu_icon__6gmaF"><svg width="11" height="6" viewBox="0 0 11 6" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10 1L5.5 5L1 1" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg></span></summary><ul class="MobileMenu_List__XjJr0"><li><a class="MobileMenu_ListItemLink__dnvmV" href="/solutions/finance"><div class="MobileMenu_ListItemHeading___yPC6"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13.3307 6.66675H8.33073C7.8887 6.66675 7.46478 6.84234 7.15222 7.1549C6.83966 7.46746 6.66406 7.89139 6.66406 8.33342C6.66406 8.77544 6.83966 9.19937 7.15222 9.51193C7.46478 9.82449 7.8887 10.0001 8.33073 10.0001H11.6641C12.1061 10.0001 12.53 10.1757 12.8426 10.4882C13.1551 10.8008 13.3307 11.2247 13.3307 11.6667C13.3307 12.1088 13.1551 12.5327 12.8426 12.8453C12.53 13.1578 12.1061 13.3334 11.6641 13.3334H6.66406M9.9974 15.0001V5.00008M18.3307 10.0001C18.3307 14.6025 14.5998 18.3334 9.9974 18.3334C5.39502 18.3334 1.66406 14.6025 1.66406 10.0001C1.66406 5.39771 5.39502 1.66675 9.9974 1.66675C14.5998 1.66675 18.3307 5.39771 18.3307 10.0001Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>Financial Analysts</div></a></li><li><a class="MobileMenu_ListItemLink__dnvmV" href="/solutions/administrative-operations"><div class="MobileMenu_ListItemHeading___yPC6"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1.66406 6.66659V15.8333C1.66406 16.2753 1.83966 16.6992 2.15222 17.0118C2.46478 17.3243 2.8887 17.4999 3.33073 17.4999H14.9974M16.6641 14.1666C17.1061 14.1666 17.53 13.991 17.8426 13.6784C18.1551 13.3659 18.3307 12.9419 18.3307 12.4999V7.49992C18.3307 7.05789 18.1551 6.63397 17.8426 6.32141C17.53 6.00885 17.1061 5.83325 16.6641 5.83325H13.4141C13.1353 5.83598 12.8604 5.76876 12.6143 5.63774C12.3683 5.50671 12.159 5.31606 12.0057 5.08325L11.3307 4.08325C11.179 3.85281 10.9724 3.66365 10.7295 3.53275C10.4866 3.40185 10.215 3.3333 9.93906 3.33325H6.66406C6.22204 3.33325 5.79811 3.50885 5.48555 3.82141C5.17299 4.13397 4.9974 4.55789 4.9974 4.99992V12.4999C4.9974 12.9419 5.17299 13.3659 5.48555 13.6784C5.79811 13.991 6.22204 14.1666 6.66406 14.1666H16.6641Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>Administrative Operations</div></a></li><li><a class="MobileMenu_ListItemLink__dnvmV" href="/solutions/engineering"><div class="MobileMenu_ListItemHeading___yPC6"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13.3307 15L18.3307 10L13.3307 5M6.66406 5L1.66406 10L6.66406 15" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>Engineering &amp; R&amp;D</div></a></li><li><a class="MobileMenu_ListItemLink__dnvmV" href="/solutions/customer-support"><div class="MobileMenu_ListItemHeading___yPC6"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M14.9974 7.50008H16.6641C17.1061 7.50008 17.53 7.67568 17.8426 7.98824C18.1551 8.3008 18.3307 8.72472 18.3307 9.16675V18.3334L14.9974 15.0001H9.9974C9.55537 15.0001 9.13145 14.8245 8.81888 14.5119C8.50632 14.1994 8.33073 13.7754 8.33073 13.3334V12.5001M11.6641 7.50008C11.6641 7.94211 11.4885 8.36603 11.1759 8.67859C10.8633 8.99115 10.4394 9.16675 9.9974 9.16675H4.9974L1.66406 12.5001V3.33341C1.66406 2.41675 2.41406 1.66675 3.33073 1.66675H9.9974C10.4394 1.66675 10.8633 1.84234 11.1759 2.1549C11.4885 2.46746 11.6641 2.89139 11.6641 3.33341V7.50008Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>Customer Support</div></a></li><li><a class="MobileMenu_ListItemLink__dnvmV" href="/solutions/healthcare-pharma"><div class="MobileMenu_ListItemHeading___yPC6"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M17.0128 3.81671C16.5948 3.39719 16.098 3.06433 15.551 2.8372C15.004 2.61008 14.4176 2.49316 13.8253 2.49316C13.2331 2.49316 12.6466 2.61008 12.0996 2.8372C11.5527 3.06433 11.0559 3.39719 10.6378 3.81671L9.99617 4.46671L9.3545 3.81671C8.93643 3.39719 8.43967 3.06433 7.89268 2.8372C7.3457 2.61008 6.75926 2.49316 6.167 2.49316C5.57474 2.49316 4.9883 2.61008 4.44132 2.8372C3.89433 3.06433 3.39756 3.39719 2.9795 3.81671C1.21283 5.58338 1.1045 8.56671 3.3295 10.8334L9.99617 17.5L16.6628 10.8334C18.8878 8.56671 18.7795 5.58338 17.0128 3.81671Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path><path d="M2.91406 9.99992H7.91406L8.33073 9.16659L9.9974 12.9166L11.6641 7.08325L12.9141 9.99992H17.0807" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></svg>Healthcare / Pharma</div></a></li></ul></details></li><li><a class="MobileMenu_Link__5frcx" href="/community">Community</a></li><li><a class="MobileMenu_Link__5frcx" href="/pricing">Pricing</a></li><li><a class="MobileMenu_Link__5frcx" href="/blog">Blog</a></li><li><a class="MobileMenu_Link__5frcx" href="/customers">Customer stories</a></li><li><a class="MobileMenu_Link__5frcx" href="/careers">Careers</a></li></ul></nav><a href="/contact" class="Button_button-variant-ghost__o2AbG Button_button__aJ0V6" data-tracking-variant="ghost"> <!-- -->Talk to us</a><ul class="Socials_socials__8Y_s5 Socials_socials-theme-dark__Hq8lc MobileMenu_socials__JykCO"><li><a href="https://github.com/run-llama/llama_index"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></li><li><a href="https://discord.com/invite/eN6D2HQ4aX"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 640 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z"></path></svg></a></li><li><a href="https://twitter.com/llama_index"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"></path></svg></a></li><li><a href="https://www.linkedin.com/company/91154103/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></li><li><a href="https://www.youtube.com/@LlamaIndex"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg></a></li></ul><p class="Text_text__zPO0D Text_text-size-16__PkjFu MobileMenu_copyright__nKVOs">© <!-- -->2025<!-- --> LlamaIndex</p></div></header><main><section class="BlogPost_post__JHNzd"><img alt="" loading="lazy" width="800" height="1166" decoding="async" data-nimg="1" class="BlogPost_featuredImage__KGxwX" style="color:transparent" srcSet="/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F7m9jw85w%2Fproduction%2F5b3a6ecd398b62a55cf79480874b0b2de87e124b-2413x2332.png%3Ffit%3Dmax%26auto%3Dformat&amp;w=828&amp;q=75 1x, /_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F7m9jw85w%2Fproduction%2F5b3a6ecd398b62a55cf79480874b0b2de87e124b-2413x2332.png%3Ffit%3Dmax%26auto%3Dformat&amp;w=1920&amp;q=75 2x" src="/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F7m9jw85w%2Fproduction%2F5b3a6ecd398b62a55cf79480874b0b2de87e124b-2413x2332.png%3Ffit%3Dmax%26auto%3Dformat&amp;w=1920&amp;q=75"/><p class="Text_text__zPO0D Text_text-size-16__PkjFu Text_text-weight-600__fKYth BlogPost_date__6uxQw"><a class="BlogPost_author__mesdl" href="/blog/author/andrei">Andrei</a> <!-- -->•<!-- --> <!-- -->2024-03-20</p><h1 class="Text_text__zPO0D Text_text-size-32__koGps BlogPost_title__b2lqJ">Retrieving Privacy-Safe Documents Over A Network</h1><ul class="BlogPost_tags__13pBH"><li><a class="Badge_badge___1ssn" href="/blog/tag/privacy"><span class="Text_text__zPO0D Text_text-size-16__PkjFu Text_text-weight-500__f2npw">Privacy</span></a></li><li><a class="Badge_badge___1ssn" href="/blog/tag/llama-index-networks"><span class="Text_text__zPO0D Text_text-size-16__PkjFu Text_text-weight-500__f2npw">llama-index-networks</span></a></li></ul><div class="BlogPost_htmlPost__Z5oDL"><p class="Text_text__zPO0D Text_text-size-16__PkjFu">In a <a href="https://www.llamaindex.ai/blog/querying-a-network-of-knowledge-with-llama-index-networks-d784b4c3006f" rel="noreferrer noopener" class="SanityPortableText_link__QA4Ze">recent blog post</a>, we introduced our <code class="SanityPortableText_inlineCode__cI85z">llama-index-networks</code> library extension that makes it possible to build a network of RAG systems, which users can query. The benefits of such a network are clear: connecting to a diverse set of knowledge stores—that one may not otherwise have access to—means more accurate responses to an even wider breadth of queries.</p><p class="Text_text__zPO0D Text_text-size-16__PkjFu">A main caveat to these networks though is that the data being shared across the network ought to be privacy safe. In this blog post, we demonstrate how to turn private, sensitive data into privacy-safe versions that can be subsequently and safely shared across a network. To do so, we’ll be relying on some recent developments in the area of Privacy-Enhancing Techniques.</p><h2 class="Text_text__zPO0D Text_text-size-48__A2f8Q">The story of Alex, Bob and Beth continues</h2><p class="Text_text__zPO0D Text_text-size-16__PkjFu">To illustrate all of this, we will again make use of our three made-up characters Alex, Bob and Beth. As a quick reminder, Alex is a data consumer who wants to access the data sources that Bob and Beth possess and are willing to supply.</p><p class="Text_text__zPO0D Text_text-size-16__PkjFu">We showed then how such data a collaboration could be permitted through <code class="SanityPortableText_inlineCode__cI85z">llama-index-networks</code> by taking the following steps:</p><ol><li class="Text_text__zPO0D Text_text-size-16__PkjFu">Bob and Beth both build their respective QueryEngine’s (RAG in llama-index lingo)</li><li class="Text_text__zPO0D Text_text-size-16__PkjFu">Bob and Beth both expose their QueryEngine behind a ContributorService</li><li class="Text_text__zPO0D Text_text-size-16__PkjFu">Alex builds a NetworkQueryEngine that connects to Bob and Beth’s ContributorService’s</li></ol><p class="Text_text__zPO0D Text_text-size-16__PkjFu">In part two of this story, we add the wrinkle that Bob and Beth possess private, sensitive data that must be carefully protected before to sharing to Alex. Or, put in another way, we need to add a step 0. to the above steps which applies protective measures to the private datasets.</p><p class="Text_text__zPO0D Text_text-size-16__PkjFu">Measures for protecting data (or more specifically the data subjects) depends on the use-case factors such as what the data involves and how its intended to be shared and ultimately processed. De-anonymizing techniques such as wiping PII (i.e., personal identifiable indicators) are often applied. However, in this blog post we highlight another privacy-enhancing technique called Differential Privacy.</p><figure><img alt="" loading="lazy" width="1040" height="644" decoding="async" data-nimg="1" style="color:transparent" srcSet="/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F7m9jw85w%2Fproduction%2F7b370753bd24df5eb5dbec3afe84c20cbf812a96-2080x1288.png%3Ffit%3Dmax%26auto%3Dformat&amp;w=1080&amp;q=75 1x, /_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F7m9jw85w%2Fproduction%2F7b370753bd24df5eb5dbec3afe84c20cbf812a96-2080x1288.png%3Ffit%3Dmax%26auto%3Dformat&amp;w=3840&amp;q=75 2x" src="/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F7m9jw85w%2Fproduction%2F7b370753bd24df5eb5dbec3afe84c20cbf812a96-2080x1288.png%3Ffit%3Dmax%26auto%3Dformat&amp;w=3840&amp;q=75"/><figcaption>Part 2: of Alex, Bob and Beth. This time Bob and Beth have sensitive data that they want to share, but can’t unless protective measures are applied before sharing across the network.</figcaption></figure><p class="Text_text__zPO0D Text_text-size-16__PkjFu">Part 2: of Alex, Bob and Beth. This time Bob and Beth have sensitive data that they want to share, but can’t unless protective measures are applied before sharing across the network.</p><h3 class="Text_text__zPO0D Text_text-size-40__fIyvA">Sidebar: differential privacy primer</h3><p class="Text_text__zPO0D Text_text-size-16__PkjFu">In short, differential privacy is a method that provides mathematical guarantees (up to a certain level of chance) that an adversary would not be able to learn that a specific individual belonged to a private dataset after only seeing the output of running this private dataset through a protected data processing step. In other words, an individual’s inclusion in the private dataset cannot be learned from the output of a differentially-private algorithm.</p><p class="Text_text__zPO0D Text_text-size-16__PkjFu">By protecting against the threat of dataset inclusion, we mitigate the risk that an adversary is able to link the private data with their external sources to learn more about the data subject and potentially cause more privacy harms (such as distortion).</p><figure><img alt="" loading="lazy" width="910" height="603.5" decoding="async" data-nimg="1" style="color:transparent" srcSet="/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F7m9jw85w%2Fproduction%2F111e4398434d411f689dde1143745da4119cb2e5-1820x1207.png%3Ffit%3Dmax%26auto%3Dformat&amp;w=1080&amp;q=75 1x, /_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F7m9jw85w%2Fproduction%2F111e4398434d411f689dde1143745da4119cb2e5-1820x1207.png%3Ffit%3Dmax%26auto%3Dformat&amp;w=1920&amp;q=75 2x" src="/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F7m9jw85w%2Fproduction%2F111e4398434d411f689dde1143745da4119cb2e5-1820x1207.png%3Ffit%3Dmax%26auto%3Dformat&amp;w=1920&amp;q=75"/><figcaption>A light introduction to differential privacy.</figcaption></figure><p class="Text_text__zPO0D Text_text-size-16__PkjFu">A light introduction to differential privacy.</p><p class="Text_text__zPO0D Text_text-size-16__PkjFu">Coming back to the story of Alex, Bob and Beth, in order to protect Bob and Beth’s data, we will make use of an algorithm that uses a pre-trained LLM to create synthetic copies of private data that satisfies the differential private mathematical guarantees. This algorithm was introduced in the paper entitled “Privacy-preserving in-context learning with differentially private few-shot generation” by Xinyu Tang et al., which appeared in ICLR 2024. It is the synthetic copies that we can use to share across the network!</p><p class="Text_text__zPO0D Text_text-size-16__PkjFu">There we have it, the added privacy wrinkle and our differentially privacy approach means that we have to take the following steps to facilitate this data collaboration.</p><ol><li class="Text_text__zPO0D Text_text-size-16__PkjFu">Bob and Beth create privacy-safe synthetic copies of their private datasets</li><li class="Text_text__zPO0D Text_text-size-16__PkjFu">Bob and Beth both build their respective QueryEngine’s over their synthetic datasets</li><li class="Text_text__zPO0D Text_text-size-16__PkjFu">Bob and Beth both expose their QueryEngine behind a ContributorService</li><li class="Text_text__zPO0D Text_text-size-16__PkjFu">Alex builds a NetworkQueryEngine that connects to Bob and Beth’s ContributorService’s</li></ol><h3 class="Text_text__zPO0D Text_text-size-40__fIyvA">Creating differentially private synthetic copies of a private dataset</h3><p class="Text_text__zPO0D Text_text-size-16__PkjFu">Fortunately, for step 0., we can make use of the <code class="SanityPortableText_inlineCode__cI85z">DiffPrivateSimpleDataset</code> pack.</p><pre><code><span class="hljs-keyword">from</span> llama_index.core.llama_datasets.simple <span class="hljs-keyword">import</span> LabelledSimpleDataset
<span class="hljs-keyword">from</span> llama_index.packs.diff_private_simple_dataset.base <span class="hljs-keyword">import</span> PromptBundle
<span class="hljs-keyword">from</span> llama_index.packs.diff_private_simple_dataset <span class="hljs-keyword">import</span> DiffPrivateSimpleDatasetPack
<span class="hljs-keyword">from</span> llama_index.llms.openai <span class="hljs-keyword">import</span> OpenAI
<span class="hljs-keyword">import</span> tiktoken

<span class="hljs-comment"># Beth uses `DiffPrivateSimpleDatasetPack` to generate synthetic copies</span>

llm = OpenAI(
    model=<span class="hljs-string">&quot;gpt-3.5-turbo-instruct&quot;</span>,
    max_tokens=<span class="hljs-number">1</span>,
    logprobs=<span class="hljs-literal">True</span>,
    top_logprobs=<span class="hljs-number">5</span>,  <span class="hljs-comment"># OpenAI only allows for top 5 next token</span>
)                    <span class="hljs-comment"># as opposed to entire vocabulary</span>
tokenizer = tiktoken.encoding_for_model(<span class="hljs-string">&quot;gpt-3.5-turbo-instruct&quot;</span>)

beth_private_dataset: LabelledSimpleDataset = ... <span class="hljs-comment"># a dataset that contains</span>
																									<span class="hljs-comment"># examples with two attributes</span>
																									<span class="hljs-comment"># `text` and `reference_label`</span>

beth_synthetic_generator = DiffPrivateSimpleDatasetPack(
    llm=llm,
    tokenizer=tokenizer,
    prompt_bundle=prompt_bundle,    <span class="hljs-comment"># params for preparing required prompts</span>
    simple_dataset=simple_dataset,  <span class="hljs-comment"># to generate the synthetic examples </span>
)

beth_synthetic_dataset = <span class="hljs-keyword">await</span> beth_synthetic_generator.arun(
		size=<span class="hljs-number">3</span>,  <span class="hljs-comment"># number of synthetic observations to create</span>
		sigma=<span class="hljs-number">0.5</span>  <span class="hljs-comment"># param that determines the level of privacy</span>
)</code></pre><p class="Text_text__zPO0D Text_text-size-16__PkjFu">With the synthetic dataset in hand, Bob and Beth can apply the steps introduced in our previous post to build their privacy-safe QueryEngine. It’s worthwhile to mention here that as mentioned by the authors of the paper, the synthetic copies can be used as many times as one would like in a downstream task and it would incur no additional privacy cost! (This is due to the post-processing property of differential privacy.)</p><h2 class="Text_text__zPO0D Text_text-size-48__A2f8Q">Example: Symptom2Disease</h2><p class="Text_text__zPO0D Text_text-size-16__PkjFu">In this section of the blog post, we go over an actual example application of the privacy-safe networks over the <a href="https://www.kaggle.com/datasets/niyarrbarman/symptom2disease/data" rel="noreferrer noopener" class="SanityPortableText_link__QA4Ze">Symptom2Disease</a> dataset. This dataset consists of 1,200 examples each containing a “symptoms” description as well as the associated “disease” label — the dataset contains observations for 24 distinct disease labels. We split the dataset into two disjoint subsets, one for training and the other for testing. Moreover, we consider this original dataset to be private, requiring protective measures before being shared across a network.</p><h3 class="Text_text__zPO0D Text_text-size-40__fIyvA">Generate privacy-safe synthetic observations of Symptom2Disease</h3><p class="Text_text__zPO0D Text_text-size-16__PkjFu">We use the training subset and apply the <code class="SanityPortableText_inlineCode__cI85z">DiffPrivateSimpleDatasetPack</code> on it in order to generate privacy-safe, synthetic observations. But in order to do so, we first need to turn the raw Symptom2Disease dataset into a <code class="SanityPortableText_inlineCode__cI85z">LabelledSimpleDataset</code> object.</p><pre><code><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd
<span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split
<span class="hljs-keyword">from</span> llama_index.core.llama_dataset.simple <span class="hljs-keyword">import</span> (
    LabelledSimpleDataExample,
    LabelledSimpleDataset,
)
<span class="hljs-keyword">from</span> llama_index.core.llama_dataset.base <span class="hljs-keyword">import</span> CreatedBy, CreatedByType

<span class="hljs-comment"># load the Symptom2Disease.csv file</span>
df = pd.read_csv(<span class="hljs-string">&quot;Symptom2Disease.csv&quot;</span>)
train, test = train_test_split(df, test_size=<span class="hljs-number">0.2</span>)

<span class="hljs-comment"># create a LabelledSimpleDataset (which is what the pack works with)</span>
examples = []
<span class="hljs-keyword">for</span> index, row <span class="hljs-keyword">in</span> df.iterrows():
    example = LabelledSimpleDataExample(
        reference_label=row[<span class="hljs-string">&quot;label&quot;</span>],
        text=row[<span class="hljs-string">&quot;text&quot;</span>],
        text_by=CreatedBy(<span class="hljs-built_in">type</span>=CreatedByType.HUMAN),
    )
    examples.append(example)

simple_dataset = LabelledSimpleDataset(examples=examples)</code></pre><p class="Text_text__zPO0D Text_text-size-16__PkjFu">Now we can use the llama-pack to create our synthetic observations.</p><pre><code><span class="hljs-keyword">import</span> llama_index.core.instrumentation <span class="hljs-keyword">as</span> instrument
<span class="hljs-keyword">from</span> llama_index.core.llama_dataset.simple <span class="hljs-keyword">import</span> LabelledSimpleDataset
<span class="hljs-keyword">from</span> llama_index.packs.diff_private_simple_dataset.base <span class="hljs-keyword">import</span> PromptBundle
<span class="hljs-keyword">from</span> llama_index.packs.diff_private_simple_dataset <span class="hljs-keyword">import</span> DiffPrivateSimpleDatasetPack
<span class="hljs-keyword">from</span> llama_index.llms.openai <span class="hljs-keyword">import</span> OpenAI
<span class="hljs-keyword">import</span> tiktoken
<span class="hljs-keyword">from</span> .event_handler <span class="hljs-keyword">import</span> DiffPrivacyEventHandler
<span class="hljs-keyword">import</span> asyncio
<span class="hljs-keyword">import</span> os

NUM_SPLITS = <span class="hljs-number">3</span>
T_MAX = <span class="hljs-number">150</span>

llm = OpenAI(
    model=<span class="hljs-string">&quot;gpt-3.5-turbo-instruct&quot;</span>,
    max_tokens=<span class="hljs-number">1</span>,
    logprobs=<span class="hljs-literal">True</span>,
    top_logprobs=<span class="hljs-number">5</span>,
)
tokenizer = tiktoken.encoding_for_model(<span class="hljs-string">&quot;gpt-3.5-turbo-instruct&quot;</span>)

prompt_bundle = PromptBundle(
    instruction=(
        <span class="hljs-string">&quot;You are a patient experiencing symptoms of a specific disease. &quot;</span>
        <span class="hljs-string">&quot;Given a label of disease type, generate the chosen type of symptoms accordingly.\n&quot;</span>
        <span class="hljs-string">&quot;Start your answer directly after &#x27;Symptoms: &#x27;. Begin your answer with [RESULT].\n&quot;</span>
    ),
    label_heading=<span class="hljs-string">&quot;Disease&quot;</span>,
    text_heading=<span class="hljs-string">&quot;Symptoms&quot;</span>,
)

dp_simple_dataset_pack = DiffPrivateSimpleDatasetPack(
    llm=llm,
    tokenizer=tokenizer,
    prompt_bundle=prompt_bundle,
    simple_dataset=simple_dataset,
)

synthetic_dataset = <span class="hljs-keyword">await</span> dp_simple_dataset_pack.arun(
    sizes=<span class="hljs-number">3</span>,
    t_max=T_MAX,
    sigma=<span class="hljs-number">1.5</span>,
    num_splits=NUM_SPLITS,
    num_samples_per_split=<span class="hljs-number">8</span>,  <span class="hljs-comment"># number of private observations to create a</span>
)                             <span class="hljs-comment"># synthetic obsevation</span>
synthetic_dataset.save_json(<span class="hljs-string">&quot;synthetic_dataset.json&quot;</span>)</code></pre><h3 class="Text_text__zPO0D Text_text-size-40__fIyvA">Create a network with two contributors</h3><p class="Text_text__zPO0D Text_text-size-16__PkjFu">Next, we imagine that there are two contributors that each have their own set of Symptom2Disease datasets. In particular, we split the 24 categories of diseases into two disjoint sets and consider each Contributor to possess only one of the two sets. Note that we created the synthetic observations on the full training set, though we could have easily done this on the split datasets as well.</p><p class="Text_text__zPO0D Text_text-size-16__PkjFu">Now that we have the synthetic observations, we can follow a slightly modified version of steps 1. through 3. defined in the story of Alex, Bob and Beth. The modification here is that we’re using Retrievers instead of QueryEngine (the choice of Retriever or QueryEngine is completely up to the user).</p><p class="Text_text__zPO0D Text_text-size-16__PkjFu"><strong>Step 1:</strong> Contributor’s build their Retriever over their synthetic datasets.</p><pre><code><span class="hljs-keyword">import</span> os
<span class="hljs-keyword">from</span> llama_index.core <span class="hljs-keyword">import</span> VectorStoreIndex
<span class="hljs-keyword">from</span> llama_index.core.llama_dataset.simple <span class="hljs-keyword">import</span> LabelledSimpleDataset
<span class="hljs-keyword">from</span> llama_index.core.schema <span class="hljs-keyword">import</span> TextNode


<span class="hljs-comment"># load the synthetic dataset</span>
synthetic_dataset = LabelledSimpleDataset.from_json(
    <span class="hljs-string">&quot;./data/contributor1_synthetic_dataset.json&quot;</span>
)


nodes = [
    TextNode(text=el.text, metadata={<span class="hljs-string">&quot;reference_label&quot;</span>: el.reference_label})
    <span class="hljs-keyword">for</span> el <span class="hljs-keyword">in</span> synthetic_dataset[:]
]

index = VectorStoreIndex(nodes=nodes)
similarity_top_k = <span class="hljs-built_in">int</span>(os.environ.get(<span class="hljs-string">&quot;SIMILARITY_TOP_K&quot;</span>))
retriever = index.as_retriever(similarity_top_k=similarity_top_k)</code></pre><p class="Text_text__zPO0D Text_text-size-16__PkjFu"><strong>Step 2:</strong> Contributor’s expose their Retrievers behind a ContributorRetrieverService</p><pre><code><span class="hljs-keyword">from</span> llama_index.networks.contributor.retriever.service <span class="hljs-keyword">import</span> (
    ContributorRetrieverService,
    ContributorRetrieverServiceSettings,
)

settings = ContributorRetrieverServiceSettings() <span class="hljs-comment"># loads from .env file</span>
service = ContributorRetrieverService(config=settings, retriever=retriever)
app = service.app</code></pre><p class="Text_text__zPO0D Text_text-size-16__PkjFu"><strong>Step 3:</strong> Define the NetworkRetriever that connects to the ContributorRetrieverServices</p><pre><code><span class="hljs-keyword">from</span> llama_index.networks.network.retriever <span class="hljs-keyword">import</span> NetworkRetriever
<span class="hljs-keyword">from</span> llama_index.networks.contributor.retriever <span class="hljs-keyword">import</span> ContributorRetrieverClient
<span class="hljs-keyword">from</span> llama_index.postprocessor.cohere_rerank <span class="hljs-keyword">import</span> CohereRerank

<span class="hljs-comment"># ContributorRetrieverClient&#x27;s connect to the ContributorRetrieverService</span>
contributors = [
    ContributorRetrieverClient.from_config_file(
        env_file=<span class="hljs-string">f&quot;./client-env-files/.env.contributor_<span class="hljs-subst">{ix}</span>.client&quot;</span>
    )
    <span class="hljs-keyword">for</span> ix <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>)
]
reranker = CohereRerank(top_n=<span class="hljs-number">5</span>)
network_retriever = NetworkRetriever(
    contributors=contributors, node_postprocessors=[reranker]
)</code></pre><p class="Text_text__zPO0D Text_text-size-16__PkjFu">With the <code class="SanityPortableText_inlineCode__cI85z">NetworkRetriever</code> established, we can retrieve synthetic observations from the two contributors data against a query.</p><pre><code>related_records = network_retriever.aretrieve(<span class="hljs-string">&quot;Vomitting and nausea&quot;</span>)
<span class="hljs-built_in">print</span>(related_records) <span class="hljs-comment"># contain symptoms/disease records that are similar to</span>
											 <span class="hljs-comment"># to the queried symptoms.</span></code></pre><h3 class="Text_text__zPO0D Text_text-size-40__fIyvA">Evaluating the <code class="SanityPortableText_inlineCode__cI85z">NetworkRetriever</code></h3><p class="Text_text__zPO0D Text_text-size-16__PkjFu">To evaluate the efficacy of the <code class="SanityPortableText_inlineCode__cI85z">NetworkRetriever</code> we make use of our test set in order to compute two traditional retrieval metrics, namely: hit rate and mean reciprocal rank.</p><ul><li class="Text_text__zPO0D Text_text-size-16__PkjFu"><strong>hit rate:</strong> a hit occurs if any of the retrieved nodes share the same disease label as the test query (symptoms). The hit rate then is the total number of hits divided by the size of the test set.</li><li class="Text_text__zPO0D Text_text-size-16__PkjFu"><strong>mean reciprocal rank:</strong> similar to hit rate, but now we take into account the position of the first retrieved node that shares the same disease label as the test query. If there is no such retrieved node, then the reciprocal rank of the test is equal to 0. The mean reciprocal rank is then merely the average of all reciprocal ranks across the test set.</li></ul><p class="Text_text__zPO0D Text_text-size-16__PkjFu">In addition to evaluating the <code class="SanityPortableText_inlineCode__cI85z">NetworkRetriever</code> we consider the two baselines that represent Retrieving only over the individual Contributor’s synthetic datasets.</p><figure><img alt="" loading="lazy" width="1106" height="606.5" decoding="async" data-nimg="1" style="color:transparent" srcSet="/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F7m9jw85w%2Fproduction%2F26b87d159b170a7fa1c6fa8727f7c94b83752f0f-2212x1213.png%3Ffit%3Dmax%26auto%3Dformat&amp;w=1200&amp;q=75 1x, /_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F7m9jw85w%2Fproduction%2F26b87d159b170a7fa1c6fa8727f7c94b83752f0f-2212x1213.png%3Ffit%3Dmax%26auto%3Dformat&amp;w=3840&amp;q=75 2x" src="/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F7m9jw85w%2Fproduction%2F26b87d159b170a7fa1c6fa8727f7c94b83752f0f-2212x1213.png%3Ffit%3Dmax%26auto%3Dformat&amp;w=3840&amp;q=75"/><figcaption>Retriever evaluations, with sigma equal to 1.5.</figcaption></figure><p class="Text_text__zPO0D Text_text-size-16__PkjFu">In the image above, we observe that the NetworkRetriever outperforms both the individual contributor Retriever’s in the test set. This shouldn’t be hard to grasp however since the network retriever has access to more data since it has access to both the Contributor’s synthetic observations—this is the point after all of a network!</p><p class="Text_text__zPO0D Text_text-size-16__PkjFu">Another important observation can be made upon inspection of these results. That is, the privacy-safe synthetic observations do indeed do the job of protecting privacy while still maintaining utility in the original dataset. This is often the concern when applying privacy measures such as differential privacy, where noise is incorporated to protect the data. Too much noise will provide high levels of privacy, but at the same time, may render the data useless in downstream tasks. From the table above, we see that at least for this example (though it does corroborate the results of the paper) that the synthetic observations still do match well with the test set, which are indeed real observations (i.e. not synthetically generated).</p><p class="Text_text__zPO0D Text_text-size-16__PkjFu">Finally, this level of privacy can be controlled via the noise parameter <code class="SanityPortableText_inlineCode__cI85z">sigma</code>. In the example above we used a <code class="SanityPortableText_inlineCode__cI85z">sigma</code> of 1.5, which for this dataset amounts to an <code class="SanityPortableText_inlineCode__cI85z">epsilon</code> (i.e., privacy-loss measure) value of 1.3. (Privacy loss levels between 0 and 1 are <a href="https://www.notion.so/Standups-8d1e478a8ce54ffa9788eef1fd416042?pvs=21" rel="noreferrer noopener" class="SanityPortableText_link__QA4Ze">generally considered to be quite private</a>.) Below, we share the evaluations that result from using a <code class="SanityPortableText_inlineCode__cI85z">sigma</code> of 0.5, which amounts to an <code class="SanityPortableText_inlineCode__cI85z">epsilon</code> of 15.9—higher values of <code class="SanityPortableText_inlineCode__cI85z">epsilon</code> or privacy-loss means less privacy.</p><pre><code><span class="hljs-comment"># use the `DiffPrivacySimpleDatasetPack` to get the value of epsilon</span>
epsilon = dp_simple_dataset_pack.sigma_to_eps(
		sigma=<span class="hljs-number">0.5</span>,
		mechanism=<span class="hljs-string">&quot;gaussian&quot;</span>,
		size=<span class="hljs-number">3</span>*<span class="hljs-number">24</span>,
		max_token_cnt=<span class="hljs-number">150</span>  <span class="hljs-comment"># number of max tokens to generate per synthetic example</span>
)</code></pre><figure><img alt="" loading="lazy" width="1106" height="606.5" decoding="async" data-nimg="1" style="color:transparent" srcSet="/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F7m9jw85w%2Fproduction%2Fcbe21dbb066cd560d871145370a30b3f582bfd26-2212x1213.png%3Ffit%3Dmax%26auto%3Dformat&amp;w=1200&amp;q=75 1x, /_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F7m9jw85w%2Fproduction%2Fcbe21dbb066cd560d871145370a30b3f582bfd26-2212x1213.png%3Ffit%3Dmax%26auto%3Dformat&amp;w=3840&amp;q=75 2x" src="/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F7m9jw85w%2Fproduction%2Fcbe21dbb066cd560d871145370a30b3f582bfd26-2212x1213.png%3Ffit%3Dmax%26auto%3Dformat&amp;w=3840&amp;q=75"/><figcaption>Retriever evaluations with less noise and thus less privacy i.e., sigma equal to 0.5.</figcaption></figure><p class="Text_text__zPO0D Text_text-size-16__PkjFu">So we see after comparing the evaluation metrics with different levels of privacy that when we use the synthetic observations that have higher levels of privacy, we take a bit of a hit in the performance as seen in the decrease in both the hit rate and mean reciprocal rank. This indeed is an illustration of the privacy tradeoff. If we take a look at some of the examples from the synthetic datasets, we can perhaps gain insight as to why this may be happening.</p><pre><code><span class="hljs-comment"># synthetic example epsilon = 1.3</span>
{
    <span class="hljs-string">&quot;reference_label&quot;</span>: <span class="hljs-string">&quot;Psoriasis&quot;</span>,
    <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;[RESULTS] red, scalloped patches on skin; itching and burning sensation; thick, pitted nails on fingers and toes; joint discomfort; swollen and stiff joints; cracked and painful skin on palms and feet&quot;</span>,
    <span class="hljs-string">&quot;text_by&quot;</span>: {
        <span class="hljs-string">&quot;model_name&quot;</span>: <span class="hljs-string">&quot;gpt-3.5-turbo-instruct&quot;</span>,
        <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;ai&quot;</span>
    }
},

<span class="hljs-comment"># synthetic example epsilon = 15.9</span>
{
  <span class="hljs-string">&quot;reference_label&quot;</span>: <span class="hljs-string">&quot;Migraine&quot;</span>,
  <span class="hljs-string">&quot;text&quot;</span>: <span class="hljs-string">&quot;Intense headache, sensitivity to light and sound, nausea, vomiting, vision changes, and fatigue.&quot;</span>,
  <span class="hljs-string">&quot;text_by&quot;</span>: {
    <span class="hljs-string">&quot;model_name&quot;</span>: <span class="hljs-string">&quot;gpt-3.5-turbo-instruct&quot;</span>,
    <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;ai&quot;</span>
  }
},</code></pre><p class="Text_text__zPO0D Text_text-size-16__PkjFu">We can see that synthetic datasets with higher level of privacy are not as clean in terms of punctuation symbols in the text when compared to those with lower levels of privacy. This makes sense because the differential privacy algorithm adds noise to the mechanics of next-token generation. Thus, perturbing this process greatly has affect on the instruction-following capabilities of the LLM.</p><h3 class="Text_text__zPO0D Text_text-size-40__fIyvA">In summary</h3><ul><li class="Text_text__zPO0D Text_text-size-16__PkjFu">We used differential privacy to create privacy-safe, synthetic observations in order to permit the data collaboration of private data that may not be otherwise possible.</li><li class="Text_text__zPO0D Text_text-size-16__PkjFu">We demonstrated the benefits of the NetworkRetriever that has access to more data than what the individual Contributor Retriever may have access to.</li><li class="Text_text__zPO0D Text_text-size-16__PkjFu">We demonstrated the affects of varying degrees of privacy on the synthetic observations, and by extension, the NetworkRetriever.</li></ul><h2 class="Text_text__zPO0D Text_text-size-48__A2f8Q">Learn more!</h2><p class="Text_text__zPO0D Text_text-size-16__PkjFu">To delve deeper into the materials of this blog post, we share a few links below:</p><ul><li class="Text_text__zPO0D Text_text-size-16__PkjFu">Source code for the privacy-safe networks retriever demo. With this, you can try the above all out yourself! (<a href="https://github.com/run-llama/llama_index/tree/main/llama-index-networks/examples/privacy_safe_retrieval" rel="noreferrer noopener" class="SanityPortableText_link__QA4Ze">link</a>)</li><li class="Text_text__zPO0D Text_text-size-16__PkjFu">Demo notebooks for the <code class="SanityPortableText_inlineCode__cI85z">DiffPrivateSimpleDataset</code> (<a href="https://github.com/run-llama/llama_index/blob/main/llama-index-packs/llama-index-packs-diff-private-simple-dataset/examples/basic_demo/demo_usage.ipynb" rel="noreferrer noopener" class="SanityPortableText_link__QA4Ze">link</a>)</li><li class="Text_text__zPO0D Text_text-size-16__PkjFu">The source code for creating the synthetic Symptom2Disease observations using the <code class="SanityPortableText_inlineCode__cI85z">DiffPrivateSimpleDataset</code> (<a href="https://github.com/run-llama/llama_index/tree/main/llama-index-packs/llama-index-packs-diff-private-simple-dataset/examples/symptom_2_disease" rel="noreferrer noopener" class="SanityPortableText_link__QA4Ze">link</a>)</li></ul></div><div class="BlogPost_relatedPosts__0z6SN"><h2 class="Text_text__zPO0D Text_text-align-center__HhKqo Text_text-size-16__PkjFu Text_text-weight-400__5ENkK Text_text-family-spaceGrotesk__E4zcE BlogPost_relatedPostsTitle___JIrW">Related articles</h2><ul class="BlogPost_relatedPostsList__uOKzB"><li><div class="CardBlog_card__mm0Zw"><div class="CardBlog_thumbnail__XCu_R"><img alt="" loading="lazy" width="400" height="280" decoding="async" data-nimg="1" class="CardBlog_image__I2Asd" style="color:transparent" srcSet="/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F7m9jw85w%2Fproduction%2F5bc6cf963ce3063dd46b07381c6c5e0c59383a62-1600x933.png%3Ffit%3Dmax%26auto%3Dformat&amp;w=640&amp;q=75 1x, /_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F7m9jw85w%2Fproduction%2F5bc6cf963ce3063dd46b07381c6c5e0c59383a62-1600x933.png%3Ffit%3Dmax%26auto%3Dformat&amp;w=828&amp;q=75 2x" src="/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F7m9jw85w%2Fproduction%2F5bc6cf963ce3063dd46b07381c6c5e0c59383a62-1600x933.png%3Ffit%3Dmax%26auto%3Dformat&amp;w=828&amp;q=75"/></div><p class="Text_text__zPO0D Text_text-size-20__LNa6Q Text_text-weight-600__fKYth CardBlog_title__qC51U"><a href="/blog/secure-rag-with-llamaindex-and-llm-guard-by-protect-ai">Secure RAG with LlamaIndex and LLM Guard by Protect AI</a></p><p class="Text_text__zPO0D Text_text-size-16__PkjFu">2024-03-20</p></div></li><li><div class="CardBlog_card__mm0Zw"><div class="CardBlog_thumbnail__XCu_R"><img alt="" loading="lazy" width="400" height="280" decoding="async" data-nimg="1" class="CardBlog_image__I2Asd" style="color:transparent" srcSet="/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F7m9jw85w%2Fproduction%2F4419e1afaa5eab8c15eb7b3ba750166298158a67-853x480.gif%3Ffit%3Dmax%26auto%3Dformat&amp;w=640&amp;q=75 1x, /_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F7m9jw85w%2Fproduction%2F4419e1afaa5eab8c15eb7b3ba750166298158a67-853x480.gif%3Ffit%3Dmax%26auto%3Dformat&amp;w=828&amp;q=75 2x" src="/_next/image?url=https%3A%2F%2Fcdn.sanity.io%2Fimages%2F7m9jw85w%2Fproduction%2F4419e1afaa5eab8c15eb7b3ba750166298158a67-853x480.gif%3Ffit%3Dmax%26auto%3Dformat&amp;w=828&amp;q=75"/></div><p class="Text_text__zPO0D Text_text-size-20__LNa6Q Text_text-weight-600__fKYth CardBlog_title__qC51U"><a href="/blog/pii-detector-hacking-privacy-in-rag">PII Detector: hacking privacy in RAG</a></p><p class="Text_text__zPO0D Text_text-size-16__PkjFu">2024-03-13</p></div></li></ul></div></section></main><footer class="Footer_footer__eNA9m"><div class="Footer_navContainer__7bvx4"><div class="Footer_logoContainer__3EpzI"><img alt="LlamaIndex" loading="lazy" width="213" height="42" decoding="async" data-nimg="1" style="color:transparent" src="/llamaindex.svg"/><div class="Footer_socialContainer__GdOgk"><ul class="Socials_socials__8Y_s5"><li><a href="https://github.com/run-llama/llama_index"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 496 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg></a></li><li><a href="https://discord.com/invite/eN6D2HQ4aX"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 640 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z"></path></svg></a></li><li><a href="https://twitter.com/llama_index"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8L200.7 275.5 26.8 48H172.4L272.9 180.9 389.2 48zM364.4 421.8h39.1L151.1 88h-42L364.4 421.8z"></path></svg></a></li><li><a href="https://www.linkedin.com/company/91154103/"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg></a></li><li><a href="https://www.youtube.com/@LlamaIndex"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"></path></svg></a></li></ul></div></div><div class="Footer_nav__BLEuE"><div><h3 class="Text_text__zPO0D Text_text-size-20__LNa6Q Text_text-weight-600__fKYth Footer_navHeader__9o83e"><a href="/">LlamaIndex</a></h3><ul><li><a href="/blog"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">Blog</span></a></li><li><a href="/partners"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">Partners</span></a></li><li><a href="/careers"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">Careers</span></a></li><li><a href="/contact"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">Contact</span></a></li><li><a href="/brand"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">Brand</span></a></li><li><a href="https://llamaindex.statuspage.io" target="_blank"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">Status</span></a></li><li><a href="https://app.vanta.com/runllama.ai/trust/pkcgbjf8b3ihxjpqdx17nu" target="_blank"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">Trust Center</span></a></li></ul></div><div><h3 class="Text_text__zPO0D Text_text-size-20__LNa6Q Text_text-weight-600__fKYth Footer_navHeader__9o83e"><a href="/enterprise">Enterprise</a></h3><ul><li><a href="https://cloud.llamaindex.ai" data-tracking-variant="link" data-tracking-section="footer"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">LlamaCloud</span></a></li><li><a href="https://cloud.llamaindex.ai/parse" data-tracking-variant="link" data-tracking-section="footer"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">LlamaParse</span></a></li><li><a href="/customers"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">Customers</span></a></li><li><a href="/llamacloud-sharepoint-data-loading-for-generative-ai" data-tracking-variant="link" data-tracking-section="footer"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">SharePoint</span></a></li><li><a href="/llamacloud-aws-s3-data-loading-for-generative-ai" data-tracking-variant="link" data-tracking-section="footer"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">AWS S3</span></a></li><li><a href="/llamacloud-azure-blob-storage-data-loading-for-generative-ai" data-tracking-variant="link" data-tracking-section="footer"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">Azure Blob Storage</span></a></li><li><a href="/llamacloud-google-drive-data-loading-for-generative-ai" data-tracking-variant="link" data-tracking-section="footer"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">Google Drive</span></a></li> </ul></div><div><h3 class="Text_text__zPO0D Text_text-size-20__LNa6Q Text_text-weight-600__fKYth Footer_navHeader__9o83e"><a href="/framework">Framework</a></h3><ul><li><a href="https://pypi.org/project/llama-index/"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">Python package</span></a></li><li><a href="https://docs.llamaindex.ai"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">Python docs</span></a></li><li><a href="https://www.npmjs.com/package/llamaindex"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">TypeScript package</span></a></li><li><a href="https://ts.llamaindex.ai"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">TypeScript docs</span></a></li><li><a href="https://llamahub.ai"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">LlamaHub</span></a></li><li><a href="https://github.com/run-llama"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">GitHub</span></a></li></ul></div><div><h3 class="Text_text__zPO0D Text_text-size-20__LNa6Q Text_text-weight-600__fKYth Footer_navHeader__9o83e"><a href="/community">Community</a></h3><ul><li><a href="/community#newsletter"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">Newsletter</span></a></li><li><a href="https://discord.com/invite/eN6D2HQ4aX"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">Discord</span></a></li><li><a href="https://www.linkedin.com/company/91154103/"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">LinkedIn</span></a></li><li><a href="https://twitter.com/llama_index"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">Twitter/X</span></a></li><li><a href="https://www.youtube.com/@LlamaIndex"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">YouTube</span></a></li><li><a href="https://bsky.app/profile/llamaindex.bsky.social"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">BlueSky</span></a></li></ul></div><div><h3 class="Text_text__zPO0D Text_text-size-20__LNa6Q Text_text-weight-600__fKYth Footer_navHeader__9o83e">Starter projects</h3><ul><li><a href="https://www.npmjs.com/package/create-llama"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">create-llama</span></a></li><li><a href="https://secinsights.ai"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">SEC Insights</span></a></li><li><a href="https://github.com/run-llama/llamabot"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">LlamaBot</span></a></li><li><a href="https://docs.llamaindex.ai/en/stable/use_cases/q_and_a/rag_cli.html"><span class="Text_text__zPO0D Text_text-size-16__PkjFu">RAG CLI</span></a></li></ul></div></div></div><div class="Footer_copyrightContainer__mBKsT"><p class="Text_text__zPO0D Text_text-size-14__6Qc26 Footer_copyright__vFlrA">© <!-- -->2025<!-- --> LlamaIndex</p><div class="Footer_legalNav__O1yJA"><p class="Text_text__zPO0D Text_text-size-14__6Qc26 Footer_copyright__vFlrA"><a href="/files/privacy-notice.pdf">Privacy Notice</a></p><p class="Text_text__zPO0D Text_text-size-14__6Qc26 Footer_copyright__vFlrA"><a href="/files/terms-of-service.pdf">Terms of Service</a></p><p class="Text_text__zPO0D Text_text-size-14__6Qc26 Footer_copyright__vFlrA"><a href="https://bit.ly/llamaindexdpa">Data Processing Addendum</a></p></div></div></footer></div><svg xmlns="http://www.w3.org/2000/svg" class="flt_svg" style="display:none"><defs><filter id="flt_tag"><feGaussianBlur in="SourceGraphic" result="blur" stdDeviation="2"></feGaussianBlur><feColorMatrix in="blur" result="flt_tag" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 19 -9"></feColorMatrix><feComposite in="SourceGraphic" in2="flt_tag" operator="atop"></feComposite></filter><filter id="svg_blur_large"><feGaussianBlur in="SourceGraphic" result="blur" stdDeviation="8"></feGaussianBlur><feColorMatrix in="blur" result="svg_blur_large" values="1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 19 -9"></feColorMatrix><feComposite in="SourceGraphic" in2="svg_blur_large" operator="atop"></feComposite></filter></defs></svg></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"page":{"announcement":{"_createdAt":"2024-12-15T02:26:13Z","_id":"announcement","_rev":"bDjEm7gsnDBrRrmjaaG2yK","_type":"announcement","_updatedAt":"2025-05-19T19:20:19Z","title":"Meet LlamaIndex at the Databricks Data + AI Summit!","url":"http://48755185.hs-sites.com/llamaindex-0"},"post":{"_createdAt":"2024-03-20T18:44:20Z","_id":"7918d19a-0e58-4e37-a8e1-136a7e0a5aaa","_rev":"05dtDS0H5iRVsxYMarZF0j","_type":"blogPost","_updatedAt":"2025-05-21T20:38:13Z","announcement":[{"_createdAt":"2024-12-15T02:26:13Z","_id":"announcement","_rev":"bDjEm7gsnDBrRrmjaaG2yK","_type":"announcement","_updatedAt":"2025-05-19T19:20:19Z","title":"Meet LlamaIndex at the Databricks Data + AI Summit!","url":"http://48755185.hs-sites.com/llamaindex-0"}],"authors":[{"_createdAt":"2024-02-22T19:51:07Z","_id":"f54ae817-ba72-4506-a87d-cfa5d7f24d7f","_rev":"9mLWnJtMvL1OgKPLcXbz07","_type":"people","_updatedAt":"2024-02-24T20:08:05Z","name":"Andrei","slug":{"_type":"slug","current":"andrei"}}],"featured":false,"image":{"_type":"image","asset":{"_ref":"image-5b3a6ecd398b62a55cf79480874b0b2de87e124b-2413x2332-png","_type":"reference"}},"mainImage":"https://cdn.sanity.io/images/7m9jw85w/production/5b3a6ecd398b62a55cf79480874b0b2de87e124b-2413x2332.png","publishedDate":"2024-03-20","relatedPosts":[{"featured":false,"image":{"_type":"image","asset":{"_ref":"image-5bc6cf963ce3063dd46b07381c6c5e0c59383a62-1600x933-png","_type":"reference"}},"publishedDate":"2024-03-20","slug":"secure-rag-with-llamaindex-and-llm-guard-by-protect-ai","title":"Secure RAG with LlamaIndex and LLM Guard by Protect AI"},{"featured":false,"image":{"_type":"image","asset":{"_ref":"image-4419e1afaa5eab8c15eb7b3ba750166298158a67-853x480-gif","_type":"reference"}},"publishedDate":"2024-03-13","slug":"pii-detector-hacking-privacy-in-rag","title":"PII Detector: hacking privacy in RAG"}],"slug":{"_type":"slug","current":"retrieving-privacy-safe-documents-over-a-network"},"tags":[{"_createdAt":"2024-03-13T22:41:52Z","_id":"7b9d8fc5-3d12-44a3-901a-c6c9f2080c88","_rev":"jbUo4a8sS9GhVRG46nzKhD","_type":"blogTag","_updatedAt":"2024-03-13T22:41:52Z","slug":{"_type":"slug","current":"privacy"},"title":"Privacy"},{"_createdAt":"2024-03-20T18:34:07Z","_id":"b1eaff61-56a0-403b-accf-90ca3b02d106","_rev":"eVvFdyqjsRJTP2Pq1nc52v","_type":"blogTag","_updatedAt":"2024-03-20T18:34:07Z","slug":{"_type":"slug","current":"llama-index-networks"},"title":"llama-index-networks"}],"text":[{"_key":"34576ecfe887","_type":"block","children":[{"_key":"e9d4565078390","_type":"span","marks":[],"text":"In a "},{"_key":"e9d4565078391","_type":"span","marks":["5bd0bf5fc121"],"text":"recent blog post"},{"_key":"e9d4565078392","_type":"span","marks":[],"text":", we introduced our "},{"_key":"e9d4565078393","_type":"span","marks":["code"],"text":"llama-index-networks"},{"_key":"e9d4565078394","_type":"span","marks":[],"text":" library extension that makes it possible to build a network of RAG systems, which users can query. The benefits of such a network are clear: connecting to a diverse set of knowledge stores—that one may not otherwise have access to—means more accurate responses to an even wider breadth of queries."}],"markDefs":[{"_key":"5bd0bf5fc121","_type":"link","href":"https://www.llamaindex.ai/blog/querying-a-network-of-knowledge-with-llama-index-networks-d784b4c3006f"}],"style":"normal"},{"_key":"2475786fcf5f","_type":"block","children":[{"_key":"5f4b21f2be0f0","_type":"span","marks":[],"text":"A main caveat to these networks though is that the data being shared across the network ought to be privacy safe. In this blog post, we demonstrate how to turn private, sensitive data into privacy-safe versions that can be subsequently and safely shared across a network. To do so, we’ll be relying on some recent developments in the area of Privacy-Enhancing Techniques."}],"markDefs":[],"style":"normal"},{"_key":"07c71df945b8","_type":"block","children":[{"_key":"e70bd47989450","_type":"span","marks":[],"text":"The story of Alex, Bob and Beth continues"}],"markDefs":[],"style":"h2"},{"_key":"172338418131","_type":"block","children":[{"_key":"eb4f76ace1a00","_type":"span","marks":[],"text":"To illustrate all of this, we will again make use of our three made-up characters Alex, Bob and Beth. As a quick reminder, Alex is a data consumer who wants to access the data sources that Bob and Beth possess and are willing to supply."}],"markDefs":[],"style":"normal"},{"_key":"269e862d75a7","_type":"block","children":[{"_key":"3605d0f711750","_type":"span","marks":[],"text":"We showed then how such data a collaboration could be permitted through "},{"_key":"3605d0f711751","_type":"span","marks":["code"],"text":"llama-index-networks"},{"_key":"3605d0f711752","_type":"span","marks":[],"text":" by taking the following steps:"}],"markDefs":[],"style":"normal"},{"_key":"ba7569c9542d","_type":"block","children":[{"_key":"7a461d098db80","_type":"span","marks":[],"text":"Bob and Beth both build their respective QueryEngine’s (RAG in llama-index lingo)"}],"level":1,"listItem":"number","markDefs":[],"style":"normal"},{"_key":"1dd8d2523202","_type":"block","children":[{"_key":"ced95865924c0","_type":"span","marks":[],"text":"Bob and Beth both expose their QueryEngine behind a ContributorService"}],"level":1,"listItem":"number","markDefs":[],"style":"normal"},{"_key":"e15dc9e9a3de","_type":"block","children":[{"_key":"f682e132f6e30","_type":"span","marks":[],"text":"Alex builds a NetworkQueryEngine that connects to Bob and Beth’s ContributorService’s"}],"level":1,"listItem":"number","markDefs":[],"style":"normal"},{"_key":"9fb02e9e389b","_type":"block","children":[{"_key":"10bbb8ba0baf0","_type":"span","marks":[],"text":"In part two of this story, we add the wrinkle that Bob and Beth possess private, sensitive data that must be carefully protected before to sharing to Alex. Or, put in another way, we need to add a step 0. to the above steps which applies protective measures to the private datasets."}],"markDefs":[],"style":"normal"},{"_key":"f6961be6384e","_type":"block","children":[{"_key":"12a66c6f8f0c0","_type":"span","marks":[],"text":"Measures for protecting data (or more specifically the data subjects) depends on the use-case factors such as what the data involves and how its intended to be shared and ultimately processed. De-anonymizing techniques such as wiping PII (i.e., personal identifiable indicators) are often applied. However, in this blog post we highlight another privacy-enhancing technique called Differential Privacy."}],"markDefs":[],"style":"normal"},{"_key":"38e4508aba00","_type":"image","asset":{"_ref":"image-7b370753bd24df5eb5dbec3afe84c20cbf812a96-2080x1288-png","_type":"reference"},"caption":"Part 2: of Alex, Bob and Beth. This time Bob and Beth have sensitive data that they want to share, but can’t unless protective measures are applied before sharing across the network."},{"_key":"52a46b9a7cba","_type":"block","children":[{"_key":"03893b628b2b0","_type":"span","marks":[],"text":"Part 2: of Alex, Bob and Beth. This time Bob and Beth have sensitive data that they want to share, but can’t unless protective measures are applied before sharing across the network."}],"markDefs":[],"style":"normal"},{"_key":"454b7e858b61","_type":"block","children":[{"_key":"28de001208830","_type":"span","marks":[],"text":"Sidebar: differential privacy primer"}],"markDefs":[],"style":"h3"},{"_key":"ede308f1652f","_type":"block","children":[{"_key":"ce122875415b0","_type":"span","marks":[],"text":"In short, differential privacy is a method that provides mathematical guarantees (up to a certain level of chance) that an adversary would not be able to learn that a specific individual belonged to a private dataset after only seeing the output of running this private dataset through a protected data processing step. In other words, an individual’s inclusion in the private dataset cannot be learned from the output of a differentially-private algorithm."}],"markDefs":[],"style":"normal"},{"_key":"5c4ac15bcb09","_type":"block","children":[{"_key":"43c16d55b0420","_type":"span","marks":[],"text":"By protecting against the threat of dataset inclusion, we mitigate the risk that an adversary is able to link the private data with their external sources to learn more about the data subject and potentially cause more privacy harms (such as distortion)."}],"markDefs":[],"style":"normal"},{"_key":"484fda7a78c4","_type":"image","asset":{"_ref":"image-111e4398434d411f689dde1143745da4119cb2e5-1820x1207-png","_type":"reference"},"caption":"A light introduction to differential privacy."},{"_key":"84d2506164e1","_type":"block","children":[{"_key":"1e0e014d94a60","_type":"span","marks":[],"text":"A light introduction to differential privacy."}],"markDefs":[],"style":"normal"},{"_key":"f90f4e907ae1","_type":"block","children":[{"_key":"3343c3deb7340","_type":"span","marks":[],"text":"Coming back to the story of Alex, Bob and Beth, in order to protect Bob and Beth’s data, we will make use of an algorithm that uses a pre-trained LLM to create synthetic copies of private data that satisfies the differential private mathematical guarantees. This algorithm was introduced in the paper entitled “Privacy-preserving in-context learning with differentially private few-shot generation” by Xinyu Tang et al., which appeared in ICLR 2024. It is the synthetic copies that we can use to share across the network!"}],"markDefs":[],"style":"normal"},{"_key":"8a8a470b4332","_type":"block","children":[{"_key":"cb800bafb3650","_type":"span","marks":[],"text":"There we have it, the added privacy wrinkle and our differentially privacy approach means that we have to take the following steps to facilitate this data collaboration."}],"markDefs":[],"style":"normal"},{"_key":"ed2865b4bf07","_type":"block","children":[{"_key":"bf65700e566a0","_type":"span","marks":[],"text":"Bob and Beth create privacy-safe synthetic copies of their private datasets"}],"level":1,"listItem":"number","markDefs":[],"style":"normal"},{"_key":"571a861fbc13","_type":"block","children":[{"_key":"dbd0ffb5547d0","_type":"span","marks":[],"text":"Bob and Beth both build their respective QueryEngine’s over their synthetic datasets"}],"level":1,"listItem":"number","markDefs":[],"style":"normal"},{"_key":"ccdc56633c8a","_type":"block","children":[{"_key":"1b7ff25796fb0","_type":"span","marks":[],"text":"Bob and Beth both expose their QueryEngine behind a ContributorService"}],"level":1,"listItem":"number","markDefs":[],"style":"normal"},{"_key":"e8528ac941aa","_type":"block","children":[{"_key":"7353606538f50","_type":"span","marks":[],"text":"Alex builds a NetworkQueryEngine that connects to Bob and Beth’s ContributorService’s"}],"level":1,"listItem":"number","markDefs":[],"style":"normal"},{"_key":"23412300e448","_type":"block","children":[{"_key":"20c2bf41c68f0","_type":"span","marks":[],"text":"Creating differentially private synthetic copies of a private dataset"}],"markDefs":[],"style":"h3"},{"_key":"2e72046648ff","_type":"block","children":[{"_key":"ad00237ee8cf0","_type":"span","marks":[],"text":"Fortunately, for step 0., we can make use of the "},{"_key":"ad00237ee8cf1","_type":"span","marks":["code"],"text":"DiffPrivateSimpleDataset"},{"_key":"ad00237ee8cf2","_type":"span","marks":[],"text":" pack."}],"markDefs":[],"style":"normal"},{"_key":"fbfbdcf6cdba","_type":"codeBlock","code":"from llama_index.core.llama_datasets.simple import LabelledSimpleDataset\nfrom llama_index.packs.diff_private_simple_dataset.base import PromptBundle\nfrom llama_index.packs.diff_private_simple_dataset import DiffPrivateSimpleDatasetPack\nfrom llama_index.llms.openai import OpenAI\nimport tiktoken\n\n# Beth uses `DiffPrivateSimpleDatasetPack` to generate synthetic copies\n\nllm = OpenAI(\n    model=\"gpt-3.5-turbo-instruct\",\n    max_tokens=1,\n    logprobs=True,\n    top_logprobs=5,  # OpenAI only allows for top 5 next token\n)                    # as opposed to entire vocabulary\ntokenizer = tiktoken.encoding_for_model(\"gpt-3.5-turbo-instruct\")\n\nbeth_private_dataset: LabelledSimpleDataset = ... # a dataset that contains\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t# examples with two attributes\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t# `text` and `reference_label`\n\nbeth_synthetic_generator = DiffPrivateSimpleDatasetPack(\n    llm=llm,\n    tokenizer=tokenizer,\n    prompt_bundle=prompt_bundle,    # params for preparing required prompts\n    simple_dataset=simple_dataset,  # to generate the synthetic examples \n)\n\nbeth_synthetic_dataset = await beth_synthetic_generator.arun(\n\t\tsize=3,  # number of synthetic observations to create\n\t\tsigma=0.5  # param that determines the level of privacy\n)","language":"python"},{"_key":"ed24692d888d","_type":"block","children":[{"_key":"567e12a5a9e30","_type":"span","marks":[],"text":"With the synthetic dataset in hand, Bob and Beth can apply the steps introduced in our previous post to build their privacy-safe QueryEngine. It’s worthwhile to mention here that as mentioned by the authors of the paper, the synthetic copies can be used as many times as one would like in a downstream task and it would incur no additional privacy cost! (This is due to the post-processing property of differential privacy.)"}],"markDefs":[],"style":"normal"},{"_key":"809cc6d9cd5d","_type":"block","children":[{"_key":"45d5397904f60","_type":"span","marks":[],"text":"Example: Symptom2Disease"}],"markDefs":[],"style":"h2"},{"_key":"6fe535d156d7","_type":"block","children":[{"_key":"f6d8773466830","_type":"span","marks":[],"text":"In this section of the blog post, we go over an actual example application of the privacy-safe networks over the "},{"_key":"f6d8773466831","_type":"span","marks":["8de552b32b32"],"text":"Symptom2Disease"},{"_key":"f6d8773466832","_type":"span","marks":[],"text":" dataset. This dataset consists of 1,200 examples each containing a “symptoms” description as well as the associated “disease” label — the dataset contains observations for 24 distinct disease labels. We split the dataset into two disjoint subsets, one for training and the other for testing. Moreover, we consider this original dataset to be private, requiring protective measures before being shared across a network."}],"markDefs":[{"_key":"8de552b32b32","_type":"link","href":"https://www.kaggle.com/datasets/niyarrbarman/symptom2disease/data"}],"style":"normal"},{"_key":"b8d812518fc2","_type":"block","children":[{"_key":"38d695e8f6dc0","_type":"span","marks":[],"text":"Generate privacy-safe synthetic observations of Symptom2Disease"}],"markDefs":[],"style":"h3"},{"_key":"2e836d551d93","_type":"block","children":[{"_key":"53aa59d47e2d0","_type":"span","marks":[],"text":"We use the training subset and apply the "},{"_key":"53aa59d47e2d1","_type":"span","marks":["code"],"text":"DiffPrivateSimpleDatasetPack"},{"_key":"53aa59d47e2d2","_type":"span","marks":[],"text":" on it in order to generate privacy-safe, synthetic observations. But in order to do so, we first need to turn the raw Symptom2Disease dataset into a "},{"_key":"53aa59d47e2d3","_type":"span","marks":["code"],"text":"LabelledSimpleDataset"},{"_key":"53aa59d47e2d4","_type":"span","marks":[],"text":" object."}],"markDefs":[],"style":"normal"},{"_key":"981366b97fe9","_type":"codeBlock","code":"import pandas as pd\nfrom sklearn.model_selection import train_test_split\nfrom llama_index.core.llama_dataset.simple import (\n    LabelledSimpleDataExample,\n    LabelledSimpleDataset,\n)\nfrom llama_index.core.llama_dataset.base import CreatedBy, CreatedByType\n\n# load the Symptom2Disease.csv file\ndf = pd.read_csv(\"Symptom2Disease.csv\")\ntrain, test = train_test_split(df, test_size=0.2)\n\n# create a LabelledSimpleDataset (which is what the pack works with)\nexamples = []\nfor index, row in df.iterrows():\n    example = LabelledSimpleDataExample(\n        reference_label=row[\"label\"],\n        text=row[\"text\"],\n        text_by=CreatedBy(type=CreatedByType.HUMAN),\n    )\n    examples.append(example)\n\nsimple_dataset = LabelledSimpleDataset(examples=examples)","language":"python"},{"_key":"552638466aa7","_type":"block","children":[{"_key":"57b57f2988130","_type":"span","marks":[],"text":"Now we can use the llama-pack to create our synthetic observations."}],"markDefs":[],"style":"normal"},{"_key":"d7c5e5a89b3d","_type":"codeBlock","code":"import llama_index.core.instrumentation as instrument\nfrom llama_index.core.llama_dataset.simple import LabelledSimpleDataset\nfrom llama_index.packs.diff_private_simple_dataset.base import PromptBundle\nfrom llama_index.packs.diff_private_simple_dataset import DiffPrivateSimpleDatasetPack\nfrom llama_index.llms.openai import OpenAI\nimport tiktoken\nfrom .event_handler import DiffPrivacyEventHandler\nimport asyncio\nimport os\n\nNUM_SPLITS = 3\nT_MAX = 150\n\nllm = OpenAI(\n    model=\"gpt-3.5-turbo-instruct\",\n    max_tokens=1,\n    logprobs=True,\n    top_logprobs=5,\n)\ntokenizer = tiktoken.encoding_for_model(\"gpt-3.5-turbo-instruct\")\n\nprompt_bundle = PromptBundle(\n    instruction=(\n        \"You are a patient experiencing symptoms of a specific disease. \"\n        \"Given a label of disease type, generate the chosen type of symptoms accordingly.\\n\"\n        \"Start your answer directly after 'Symptoms: '. Begin your answer with [RESULT].\\n\"\n    ),\n    label_heading=\"Disease\",\n    text_heading=\"Symptoms\",\n)\n\ndp_simple_dataset_pack = DiffPrivateSimpleDatasetPack(\n    llm=llm,\n    tokenizer=tokenizer,\n    prompt_bundle=prompt_bundle,\n    simple_dataset=simple_dataset,\n)\n\nsynthetic_dataset = await dp_simple_dataset_pack.arun(\n    sizes=3,\n    t_max=T_MAX,\n    sigma=1.5,\n    num_splits=NUM_SPLITS,\n    num_samples_per_split=8,  # number of private observations to create a\n)                             # synthetic obsevation\nsynthetic_dataset.save_json(\"synthetic_dataset.json\")","language":"python"},{"_key":"1b723fe72454","_type":"block","children":[{"_key":"05373a94e7a40","_type":"span","marks":[],"text":"Create a network with two contributors"}],"markDefs":[],"style":"h3"},{"_key":"e2645e7ff5d6","_type":"block","children":[{"_key":"16d779a2dae20","_type":"span","marks":[],"text":"Next, we imagine that there are two contributors that each have their own set of Symptom2Disease datasets. In particular, we split the 24 categories of diseases into two disjoint sets and consider each Contributor to possess only one of the two sets. Note that we created the synthetic observations on the full training set, though we could have easily done this on the split datasets as well."}],"markDefs":[],"style":"normal"},{"_key":"6b6a4da363b2","_type":"block","children":[{"_key":"aa1574d6bcd70","_type":"span","marks":[],"text":"Now that we have the synthetic observations, we can follow a slightly modified version of steps 1. through 3. defined in the story of Alex, Bob and Beth. The modification here is that we’re using Retrievers instead of QueryEngine (the choice of Retriever or QueryEngine is completely up to the user)."}],"markDefs":[],"style":"normal"},{"_key":"0b127fd8361b","_type":"block","children":[{"_key":"aa33e14082ce0","_type":"span","marks":["strong"],"text":"Step 1:"},{"_key":"aa33e14082ce1","_type":"span","marks":[],"text":" Contributor’s build their Retriever over their synthetic datasets."}],"markDefs":[],"style":"normal"},{"_key":"aa427f4d8331","_type":"codeBlock","code":"import os\nfrom llama_index.core import VectorStoreIndex\nfrom llama_index.core.llama_dataset.simple import LabelledSimpleDataset\nfrom llama_index.core.schema import TextNode\n\n\n# load the synthetic dataset\nsynthetic_dataset = LabelledSimpleDataset.from_json(\n    \"./data/contributor1_synthetic_dataset.json\"\n)\n\n\nnodes = [\n    TextNode(text=el.text, metadata={\"reference_label\": el.reference_label})\n    for el in synthetic_dataset[:]\n]\n\nindex = VectorStoreIndex(nodes=nodes)\nsimilarity_top_k = int(os.environ.get(\"SIMILARITY_TOP_K\"))\nretriever = index.as_retriever(similarity_top_k=similarity_top_k)","language":"python"},{"_key":"92cb4b6a2d7e","_type":"block","children":[{"_key":"1342cef7e4690","_type":"span","marks":["strong"],"text":"Step 2:"},{"_key":"1342cef7e4691","_type":"span","marks":[],"text":" Contributor’s expose their Retrievers behind a ContributorRetrieverService"}],"markDefs":[],"style":"normal"},{"_key":"574fcdca6732","_type":"codeBlock","code":"from llama_index.networks.contributor.retriever.service import (\n    ContributorRetrieverService,\n    ContributorRetrieverServiceSettings,\n)\n\nsettings = ContributorRetrieverServiceSettings() # loads from .env file\nservice = ContributorRetrieverService(config=settings, retriever=retriever)\napp = service.app","language":"python"},{"_key":"9fcaeaca6ca5","_type":"block","children":[{"_key":"e86bf8f553a70","_type":"span","marks":["strong"],"text":"Step 3:"},{"_key":"e86bf8f553a71","_type":"span","marks":[],"text":" Define the NetworkRetriever that connects to the ContributorRetrieverServices"}],"markDefs":[],"style":"normal"},{"_key":"0e5279ea1918","_type":"codeBlock","code":"from llama_index.networks.network.retriever import NetworkRetriever\nfrom llama_index.networks.contributor.retriever import ContributorRetrieverClient\nfrom llama_index.postprocessor.cohere_rerank import CohereRerank\n\n# ContributorRetrieverClient's connect to the ContributorRetrieverService\ncontributors = [\n    ContributorRetrieverClient.from_config_file(\n        env_file=f\"./client-env-files/.env.contributor_{ix}.client\"\n    )\n    for ix in range(1, 3)\n]\nreranker = CohereRerank(top_n=5)\nnetwork_retriever = NetworkRetriever(\n    contributors=contributors, node_postprocessors=[reranker]\n)","language":"python"},{"_key":"fa811dec2aeb","_type":"block","children":[{"_key":"deef7aa47a5b0","_type":"span","marks":[],"text":"With the "},{"_key":"deef7aa47a5b1","_type":"span","marks":["code"],"text":"NetworkRetriever"},{"_key":"deef7aa47a5b2","_type":"span","marks":[],"text":" established, we can retrieve synthetic observations from the two contributors data against a query."}],"markDefs":[],"style":"normal"},{"_key":"7f273a0a54b1","_type":"codeBlock","code":"related_records = network_retriever.aretrieve(\"Vomitting and nausea\")\nprint(related_records) # contain symptoms/disease records that are similar to\n\t\t\t\t\t\t\t\t\t\t\t # to the queried symptoms.","language":"python"},{"_key":"92ca0c6b85d7","_type":"block","children":[{"_key":"eaba4c24c47e0","_type":"span","marks":[],"text":"Evaluating the "},{"_key":"eaba4c24c47e1","_type":"span","marks":["code"],"text":"NetworkRetriever"}],"markDefs":[],"style":"h3"},{"_key":"563829ebee44","_type":"block","children":[{"_key":"b23f89cf6b5d0","_type":"span","marks":[],"text":"To evaluate the efficacy of the "},{"_key":"b23f89cf6b5d1","_type":"span","marks":["code"],"text":"NetworkRetriever"},{"_key":"b23f89cf6b5d2","_type":"span","marks":[],"text":" we make use of our test set in order to compute two traditional retrieval metrics, namely: hit rate and mean reciprocal rank."}],"markDefs":[],"style":"normal"},{"_key":"fa1c4f4c9be3","_type":"block","children":[{"_key":"6af7a8da6c3e0","_type":"span","marks":["strong"],"text":"hit rate:"},{"_key":"6af7a8da6c3e1","_type":"span","marks":[],"text":" a hit occurs if any of the retrieved nodes share the same disease label as the test query (symptoms). The hit rate then is the total number of hits divided by the size of the test set."}],"level":1,"listItem":"bullet","markDefs":[],"style":"normal"},{"_key":"ae16e39df4a8","_type":"block","children":[{"_key":"847e882835400","_type":"span","marks":["strong"],"text":"mean reciprocal rank:"},{"_key":"847e882835401","_type":"span","marks":[],"text":" similar to hit rate, but now we take into account the position of the first retrieved node that shares the same disease label as the test query. If there is no such retrieved node, then the reciprocal rank of the test is equal to 0. The mean reciprocal rank is then merely the average of all reciprocal ranks across the test set."}],"level":1,"listItem":"bullet","markDefs":[],"style":"normal"},{"_key":"5b06e30e79dd","_type":"block","children":[{"_key":"d8cf4032cbc90","_type":"span","marks":[],"text":"In addition to evaluating the "},{"_key":"d8cf4032cbc91","_type":"span","marks":["code"],"text":"NetworkRetriever"},{"_key":"d8cf4032cbc92","_type":"span","marks":[],"text":" we consider the two baselines that represent Retrieving only over the individual Contributor’s synthetic datasets."}],"markDefs":[],"style":"normal"},{"_key":"03b55cc2e843","_type":"image","asset":{"_ref":"image-26b87d159b170a7fa1c6fa8727f7c94b83752f0f-2212x1213-png","_type":"reference"},"caption":"Retriever evaluations, with sigma equal to 1.5."},{"_key":"f56c95e4f016","_type":"block","children":[{"_key":"a453966ce8ee0","_type":"span","marks":[],"text":"In the image above, we observe that the NetworkRetriever outperforms both the individual contributor Retriever’s in the test set. This shouldn’t be hard to grasp however since the network retriever has access to more data since it has access to both the Contributor’s synthetic observations—this is the point after all of a network!"}],"markDefs":[],"style":"normal"},{"_key":"0ba220756cb6","_type":"block","children":[{"_key":"02301a0ae55f0","_type":"span","marks":[],"text":"Another important observation can be made upon inspection of these results. That is, the privacy-safe synthetic observations do indeed do the job of protecting privacy while still maintaining utility in the original dataset. This is often the concern when applying privacy measures such as differential privacy, where noise is incorporated to protect the data. Too much noise will provide high levels of privacy, but at the same time, may render the data useless in downstream tasks. From the table above, we see that at least for this example (though it does corroborate the results of the paper) that the synthetic observations still do match well with the test set, which are indeed real observations (i.e. not synthetically generated)."}],"markDefs":[],"style":"normal"},{"_key":"5d616739aeb2","_type":"block","children":[{"_key":"c2c43850f6e00","_type":"span","marks":[],"text":"Finally, this level of privacy can be controlled via the noise parameter "},{"_key":"c2c43850f6e01","_type":"span","marks":["code"],"text":"sigma"},{"_key":"c2c43850f6e02","_type":"span","marks":[],"text":". In the example above we used a "},{"_key":"c2c43850f6e03","_type":"span","marks":["code"],"text":"sigma"},{"_key":"c2c43850f6e04","_type":"span","marks":[],"text":" of 1.5, which for this dataset amounts to an "},{"_key":"c2c43850f6e05","_type":"span","marks":["code"],"text":"epsilon"},{"_key":"c2c43850f6e06","_type":"span","marks":[],"text":" (i.e., privacy-loss measure) value of 1.3. (Privacy loss levels between 0 and 1 are "},{"_key":"c2c43850f6e07","_type":"span","marks":["5e5bce69d7cc"],"text":"generally considered to be quite private"},{"_key":"c2c43850f6e08","_type":"span","marks":[],"text":".) Below, we share the evaluations that result from using a "},{"_key":"c2c43850f6e09","_type":"span","marks":["code"],"text":"sigma"},{"_key":"c2c43850f6e010","_type":"span","marks":[],"text":" of 0.5, which amounts to an "},{"_key":"c2c43850f6e011","_type":"span","marks":["code"],"text":"epsilon"},{"_key":"c2c43850f6e012","_type":"span","marks":[],"text":" of 15.9—higher values of "},{"_key":"c2c43850f6e013","_type":"span","marks":["code"],"text":"epsilon"},{"_key":"c2c43850f6e014","_type":"span","marks":[],"text":" or privacy-loss means less privacy."}],"markDefs":[{"_key":"5e5bce69d7cc","_type":"link","href":"https://www.notion.so/Standups-8d1e478a8ce54ffa9788eef1fd416042?pvs=21"}],"style":"normal"},{"_key":"20705428ac76","_type":"codeBlock","code":"# use the `DiffPrivacySimpleDatasetPack` to get the value of epsilon\nepsilon = dp_simple_dataset_pack.sigma_to_eps(\n\t\tsigma=0.5,\n\t\tmechanism=\"gaussian\",\n\t\tsize=3*24,\n\t\tmax_token_cnt=150  # number of max tokens to generate per synthetic example\n)","language":"python"},{"_key":"4eee6681f411","_type":"image","asset":{"_ref":"image-cbe21dbb066cd560d871145370a30b3f582bfd26-2212x1213-png","_type":"reference"},"caption":"Retriever evaluations with less noise and thus less privacy i.e., sigma equal to 0.5."},{"_key":"df7fbd0ad095","_type":"block","children":[{"_key":"d9ac229bd0900","_type":"span","marks":[],"text":"So we see after comparing the evaluation metrics with different levels of privacy that when we use the synthetic observations that have higher levels of privacy, we take a bit of a hit in the performance as seen in the decrease in both the hit rate and mean reciprocal rank. This indeed is an illustration of the privacy tradeoff. If we take a look at some of the examples from the synthetic datasets, we can perhaps gain insight as to why this may be happening."}],"markDefs":[],"style":"normal"},{"_key":"b51b7da59892","_type":"codeBlock","code":"# synthetic example epsilon = 1.3\n{\n    \"reference_label\": \"Psoriasis\",\n    \"text\": \"[RESULTS] red, scalloped patches on skin; itching and burning sensation; thick, pitted nails on fingers and toes; joint discomfort; swollen and stiff joints; cracked and painful skin on palms and feet\",\n    \"text_by\": {\n        \"model_name\": \"gpt-3.5-turbo-instruct\",\n        \"type\": \"ai\"\n    }\n},\n\n# synthetic example epsilon = 15.9\n{\n  \"reference_label\": \"Migraine\",\n  \"text\": \"Intense headache, sensitivity to light and sound, nausea, vomiting, vision changes, and fatigue.\",\n  \"text_by\": {\n    \"model_name\": \"gpt-3.5-turbo-instruct\",\n    \"type\": \"ai\"\n  }\n},","language":"python"},{"_key":"3fec838f848d","_type":"block","children":[{"_key":"93e7f2fcb49d0","_type":"span","marks":[],"text":"We can see that synthetic datasets with higher level of privacy are not as clean in terms of punctuation symbols in the text when compared to those with lower levels of privacy. This makes sense because the differential privacy algorithm adds noise to the mechanics of next-token generation. Thus, perturbing this process greatly has affect on the instruction-following capabilities of the LLM."}],"markDefs":[],"style":"normal"},{"_key":"baa61b192db3","_type":"block","children":[{"_key":"f305b4df657e0","_type":"span","marks":[],"text":"In summary"}],"markDefs":[],"style":"h3"},{"_key":"c3cbc62fc54c","_type":"block","children":[{"_key":"076755727a830","_type":"span","marks":[],"text":"We used differential privacy to create privacy-safe, synthetic observations in order to permit the data collaboration of private data that may not be otherwise possible."}],"level":1,"listItem":"bullet","markDefs":[],"style":"normal"},{"_key":"a1b9f28e1495","_type":"block","children":[{"_key":"aef4bc2f12120","_type":"span","marks":[],"text":"We demonstrated the benefits of the NetworkRetriever that has access to more data than what the individual Contributor Retriever may have access to."}],"level":1,"listItem":"bullet","markDefs":[],"style":"normal"},{"_key":"3fcbb62ca572","_type":"block","children":[{"_key":"d743ccf183b20","_type":"span","marks":[],"text":"We demonstrated the affects of varying degrees of privacy on the synthetic observations, and by extension, the NetworkRetriever."}],"level":1,"listItem":"bullet","markDefs":[],"style":"normal"},{"_key":"8ed8cf635c4d","_type":"block","children":[{"_key":"feacc30210560","_type":"span","marks":[],"text":"Learn more!"}],"markDefs":[],"style":"h2"},{"_key":"acac32f4a1e1","_type":"block","children":[{"_key":"c040c94691520","_type":"span","marks":[],"text":"To delve deeper into the materials of this blog post, we share a few links below:"}],"markDefs":[],"style":"normal"},{"_key":"7f801cc0058a","_type":"block","children":[{"_key":"93c60614d4880","_type":"span","marks":[],"text":"Source code for the privacy-safe networks retriever demo. With this, you can try the above all out yourself! ("},{"_key":"93c60614d4881","_type":"span","marks":["db1f440760f4"],"text":"link"},{"_key":"93c60614d4882","_type":"span","marks":[],"text":")"}],"level":1,"listItem":"bullet","markDefs":[{"_key":"db1f440760f4","_type":"link","href":"https://github.com/run-llama/llama_index/tree/main/llama-index-networks/examples/privacy_safe_retrieval"}],"style":"normal"},{"_key":"73a658b15132","_type":"block","children":[{"_key":"c032a730931c0","_type":"span","marks":[],"text":"Demo notebooks for the "},{"_key":"c032a730931c1","_type":"span","marks":["code"],"text":"DiffPrivateSimpleDataset"},{"_key":"c032a730931c2","_type":"span","marks":[],"text":" ("},{"_key":"c032a730931c3","_type":"span","marks":["42fde70c8309"],"text":"link"},{"_key":"c032a730931c4","_type":"span","marks":[],"text":")"}],"level":1,"listItem":"bullet","markDefs":[{"_key":"42fde70c8309","_type":"link","href":"https://github.com/run-llama/llama_index/blob/main/llama-index-packs/llama-index-packs-diff-private-simple-dataset/examples/basic_demo/demo_usage.ipynb"}],"style":"normal"},{"_key":"6c90bd963019","_type":"block","children":[{"_key":"56cad7f1e6ea0","_type":"span","marks":[],"text":"The source code for creating the synthetic Symptom2Disease observations using the "},{"_key":"56cad7f1e6ea1","_type":"span","marks":["code"],"text":"DiffPrivateSimpleDataset"},{"_key":"56cad7f1e6ea2","_type":"span","marks":[],"text":" ("},{"_key":"56cad7f1e6ea3","_type":"span","marks":["04aa57bffdbe"],"text":"link"},{"_key":"56cad7f1e6ea4","_type":"span","marks":[],"text":")"}],"level":1,"listItem":"bullet","markDefs":[{"_key":"04aa57bffdbe","_type":"link","href":"https://github.com/run-llama/llama_index/tree/main/llama-index-packs/llama-index-packs-diff-private-simple-dataset/examples/symptom_2_disease"}],"style":"normal"}],"title":"Retrieving Privacy-Safe Documents Over A Network"},"publishedDate":"Invalid Date"},"params":{"slug":"retrieving-privacy-safe-documents-over-a-network"},"draftMode":false,"token":""},"__N_SSG":true},"page":"/blog/[slug]","query":{"slug":"retrieving-privacy-safe-documents-over-a-network"},"buildId":"C8J-EMc_4OCN1ch65l4fl","isFallback":false,"isExperimentalCompile":false,"gsp":true,"scriptLoader":[]}</script></body></html>