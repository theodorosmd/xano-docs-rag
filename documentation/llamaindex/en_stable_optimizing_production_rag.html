
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://docs.llamaindex.ai/en/stable/optimizing/production_rag/">
      
      
        <link rel="prev" href="../../module_guides/llama_deploy/">
      
      
        <link rel="next" href="../basic_strategies/basic_strategies/">
      
      
      <link rel="icon" href="../../_static/assets/LlamaLogoBrowserTab.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Building Performant RAG Applications for Production - LlamaIndex</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../css/style.css">
    
      <link rel="stylesheet" href="../../css/algolia.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-BYVB1ZVE6J"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-BYVB1ZVE6J",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-BYVB1ZVE6J",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  <script async type="text/javascript" src="/_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="llamaindex-llamaindex" /><meta name="readthedocs-version-slug" content="stable" /><meta name="readthedocs-resolver-filename" content="/optimizing/production_rag/" /><meta name="readthedocs-http-status" content="200" /></head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#building-performant-rag-applications-for-production" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="LlamaIndex" class="md-header__button md-logo" aria-label="LlamaIndex" data-md-component="logo">
      
  <img src="../../_static/assets/LlamaSquareBlack.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            LlamaIndex
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Building Performant RAG Applications for Production
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="purple"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        

<!-- Search interface -->
<div id="docsearch"></div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  
    
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../understanding/" class="md-tabs__link">
          
  
  
    
  
  Learn

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../use_cases/" class="md-tabs__link">
          
  
  
    
  
  Use Cases

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../examples/" class="md-tabs__link">
          
  
  
    
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../module_guides/" class="md-tabs__link">
          
  
  
    
  
  Component Guides

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
    
  
  Advanced Topics

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../api_reference/" class="md-tabs__link">
          
  
  
    
  
  API Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../community/integrations/" class="md-tabs__link">
          
  
  
    
  
  Open-Source Community

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../llama_cloud/" class="md-tabs__link">
          
  
  
    
  
  LlamaCloud

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="LlamaIndex" class="md-nav__button md-logo" aria-label="LlamaIndex" data-md-component="logo">
      
  <img src="../../_static/assets/LlamaSquareBlack.svg" alt="logo">

    </a>
    LlamaIndex
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../.." class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../understanding/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Learn
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../use_cases/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Use Cases
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../examples/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../module_guides/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Component Guides
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" checked>
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Advanced Topics
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Advanced Topics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Building Performant RAG Applications for Production
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Building Performant RAG Applications for Production
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#general-techniques-for-building-production-grade-rag" class="md-nav__link">
    <span class="md-ellipsis">
      General Techniques for Building Production-Grade RAG
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#decoupling-chunks-used-for-retrieval-vs-chunks-used-for-synthesis" class="md-nav__link">
    <span class="md-ellipsis">
      Decoupling Chunks Used for Retrieval vs. Chunks Used for Synthesis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Decoupling Chunks Used for Retrieval vs. Chunks Used for Synthesis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#motivation" class="md-nav__link">
    <span class="md-ellipsis">
      Motivation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      Key Techniques
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structured-retrieval-for-larger-document-sets" class="md-nav__link">
    <span class="md-ellipsis">
      Structured Retrieval for Larger Document Sets
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Structured Retrieval for Larger Document Sets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#motivation_1" class="md-nav__link">
    <span class="md-ellipsis">
      Motivation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-techniques_1" class="md-nav__link">
    <span class="md-ellipsis">
      Key Techniques
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamically-retrieve-chunks-depending-on-your-task" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamically Retrieve Chunks Depending on your Task
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dynamically Retrieve Chunks Depending on your Task">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#motivation_2" class="md-nav__link">
    <span class="md-ellipsis">
      Motivation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-techniques_2" class="md-nav__link">
    <span class="md-ellipsis">
      Key Techniques
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimize-context-embeddings" class="md-nav__link">
    <span class="md-ellipsis">
      Optimize Context Embeddings
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Optimize Context Embeddings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#motivation_3" class="md-nav__link">
    <span class="md-ellipsis">
      Motivation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-techniques_3" class="md-nav__link">
    <span class="md-ellipsis">
      Key Techniques
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../basic_strategies/basic_strategies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic Strategies
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agentic_strategies/agentic_strategies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agentic strategies
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../advanced_retrieval/advanced_retrieval/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Retrieval
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../evaluation/component_wise_evaluation/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Evaluation
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fine-tuning/fine-tuning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fine-Tuning
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../custom_modules/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Writing Custom Modules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../building_rag_from_scratch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Building RAG from Scratch (Lower-Level)
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../api_reference/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../community/integrations/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Open-Source Community
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../llama_cloud/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    LlamaCloud
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#general-techniques-for-building-production-grade-rag" class="md-nav__link">
    <span class="md-ellipsis">
      General Techniques for Building Production-Grade RAG
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#decoupling-chunks-used-for-retrieval-vs-chunks-used-for-synthesis" class="md-nav__link">
    <span class="md-ellipsis">
      Decoupling Chunks Used for Retrieval vs. Chunks Used for Synthesis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Decoupling Chunks Used for Retrieval vs. Chunks Used for Synthesis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#motivation" class="md-nav__link">
    <span class="md-ellipsis">
      Motivation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-techniques" class="md-nav__link">
    <span class="md-ellipsis">
      Key Techniques
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#structured-retrieval-for-larger-document-sets" class="md-nav__link">
    <span class="md-ellipsis">
      Structured Retrieval for Larger Document Sets
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Structured Retrieval for Larger Document Sets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#motivation_1" class="md-nav__link">
    <span class="md-ellipsis">
      Motivation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-techniques_1" class="md-nav__link">
    <span class="md-ellipsis">
      Key Techniques
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dynamically-retrieve-chunks-depending-on-your-task" class="md-nav__link">
    <span class="md-ellipsis">
      Dynamically Retrieve Chunks Depending on your Task
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Dynamically Retrieve Chunks Depending on your Task">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#motivation_2" class="md-nav__link">
    <span class="md-ellipsis">
      Motivation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-techniques_2" class="md-nav__link">
    <span class="md-ellipsis">
      Key Techniques
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#optimize-context-embeddings" class="md-nav__link">
    <span class="md-ellipsis">
      Optimize Context Embeddings
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Optimize Context Embeddings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#motivation_3" class="md-nav__link">
    <span class="md-ellipsis">
      Motivation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#key-techniques_3" class="md-nav__link">
    <span class="md-ellipsis">
      Key Techniques
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="building-performant-rag-applications-for-production">Building Performant RAG Applications for Production<a class="headerlink" href="#building-performant-rag-applications-for-production" title="Permanent link">#</a></h1>
<p>Prototyping a RAG application is easy, but making it performant, robust, and scalable to a large knowledge corpus is hard.</p>
<p>This guide contains a variety of tips and tricks to improve the performance of your RAG workflow. We first outline
some general techniques - they are loosely ordered in terms of most straightforward to most challenging.
We then dive a bit more deeply into each technique, the use cases that it solves,
and how to implement it with LlamaIndex!</p>
<p>The end goal is to optimize your retrieval and generation performance to answer more
queries over more complex datasets accurately and without hallucinations.</p>
<h2 id="general-techniques-for-building-production-grade-rag">General Techniques for Building Production-Grade RAG<a class="headerlink" href="#general-techniques-for-building-production-grade-rag" title="Permanent link">#</a></h2>
<p>Here are some top Considerations for Building Production-Grade RAG</p>
<ul>
<li>Decoupling chunks used for retrieval vs. chunks used for synthesis</li>
<li>Structured Retrieval for Larger Document Sets</li>
<li>Dynamically Retrieve Chunks Depending on your Task</li>
<li>Optimize context embeddings</li>
</ul>
<p>We discussed this and more during our <a href="https://www.youtube.com/watch?v=Zj5RCweUHIk">Production RAG Webinar</a>.
Check out <a href="https://twitter.com/jerryjliu0/status/1692931028963221929?s=20">this Tweet thread</a> for more synthesized details.</p>
<h2 id="decoupling-chunks-used-for-retrieval-vs-chunks-used-for-synthesis">Decoupling Chunks Used for Retrieval vs. Chunks Used for Synthesis<a class="headerlink" href="#decoupling-chunks-used-for-retrieval-vs-chunks-used-for-synthesis" title="Permanent link">#</a></h2>
<p>A key technique for better retrieval is to decouple chunks used for retrieval with those that are used for synthesis.</p>
<p><img alt="" src="../../_static/production_rag/decouple_chunks.png" /></p>
<h4 id="motivation">Motivation<a class="headerlink" href="#motivation" title="Permanent link">#</a></h4>
<p>The optimal chunk representation for retrieval might be different than the optimal consideration used for synthesis.
For instance, a raw text chunk may contain needed details for the LLM to synthesize a more detailed answer given a query. However, it
may contain filler words/info that may bias the embedding representation, or it may lack global context and not be retrieved at all
when a relevant query comes in.</p>
<h4 id="key-techniques">Key Techniques<a class="headerlink" href="#key-techniques" title="Permanent link">#</a></h4>
<p>There‚Äôs two main ways to take advantage of this idea:</p>
<p><strong>1. Embed a document summary, which links to chunks associated with the document.</strong></p>
<p>This can help retrieve relevant documents at a high-level before retrieving chunks vs. retrieving chunks directly (that might be in irrelevant documents).</p>
<p>Resources:</p>
<ul>
<li><a href="../../examples/query_engine/pdf_tables/recursive_retriever/">Table Recursive Retrieval</a></li>
<li><a href="../../examples/index_structs/doc_summary/DocSummary/">Document Summary Index</a></li>
</ul>
<p><strong>2. Embed a sentence, which then links to a window around the sentence.</strong></p>
<p>This allows for finer-grained retrieval of relevant context (embedding giant chunks leads to ‚Äúlost in the middle‚Äù problems), but also ensures enough context for LLM synthesis.</p>
<p>Resources:</p>
<ul>
<li><a href="../../examples/node_postprocessor/MetadataReplacementDemo/">Metadata Replacement Postprocessor</a></li>
</ul>
<h2 id="structured-retrieval-for-larger-document-sets">Structured Retrieval for Larger Document Sets<a class="headerlink" href="#structured-retrieval-for-larger-document-sets" title="Permanent link">#</a></h2>
<p><img alt="" src="../../_static/production_rag/structured_retrieval.png" /></p>
<h4 id="motivation_1">Motivation<a class="headerlink" href="#motivation_1" title="Permanent link">#</a></h4>
<p>A big issue with the standard RAG stack (top-k retrieval + basic text splitting) is that it doesn‚Äôt do well as the number of documents scales up - e.g. if you have 100 different PDFs.
In this setting, given a query you may want to use structured information to help with more precise retrieval; for instance, if you ask a question that's only relevant to two PDFs,
using structured information to ensure those two PDFs get returned beyond raw embedding similarity with chunks.</p>
<h4 id="key-techniques_1">Key Techniques<a class="headerlink" href="#key-techniques_1" title="Permanent link">#</a></h4>
<p>There‚Äôs a few ways of performing more structured tagging/retrieval for production-quality RAG systems, each with their own pros/cons.</p>
<p><strong>1. Metadata Filters + Auto Retrieval</strong>
Tag each document with metadata and then store in a vector database. During inference time, use the LLM to infer the right metadata filters to query the vector db in addition to the semantic query string.</p>
<ul>
<li>Pros ‚úÖ: Supported in major vector dbs. Can filter document via multiple dimensions.</li>
<li>Cons üö´: Can be hard to define the right tags. Tags may not contain enough relevant information for more precise retrieval. Also tags represent keyword search at the document-level, doesn‚Äôt allow for semantic lookups.</li>
</ul>
<p>Resources:
<strong>2. Store Document Hierarchies (summaries -&gt; raw chunks) + Recursive Retrieval</strong>
Embed document summaries and map to chunks per document. Fetch at the document-level first before chunk level.</p>
<ul>
<li>Pros ‚úÖ: Allows for semantic lookups at the document level.</li>
<li>Cons üö´: Doesn‚Äôt allow for keyword lookups by structured tags (can be more precise than semantic search). Also autogenerating summaries can be expensive.</li>
</ul>
<p><strong>Resources</strong></p>
<ul>
<li><a href="../../examples/vector_stores/chroma_auto_retriever/">Chroma Auto-Retrieval</a></li>
<li><a href="../../examples/index_structs/doc_summary/DocSummary/">Document Summary Index</a></li>
<li><a href="../../examples/query_engine/recursive_retriever_agents/">Recursive Retriever</a></li>
<li><a href="../../examples/retrievers/auto_vs_recursive_retriever/">Auto-Retriever vs. Recursive Retriever</a></li>
</ul>
<h2 id="dynamically-retrieve-chunks-depending-on-your-task">Dynamically Retrieve Chunks Depending on your Task<a class="headerlink" href="#dynamically-retrieve-chunks-depending-on-your-task" title="Permanent link">#</a></h2>
<p><img alt="" src="../../_static/production_rag/joint_qa_summary.png" /></p>
<h4 id="motivation_2">Motivation<a class="headerlink" href="#motivation_2" title="Permanent link">#</a></h4>
<p>RAG isn't just about question-answering about specific facts, which top-k similarity is optimized for. There can be a broad range of queries that a user might ask. Queries that are handled by naive RAG stacks include ones that ask about specific facts e.g. "Tell me about the D&amp;I initiatives for this company in 2023" or "What did the narrator do during his time at Google". But queries can also include summarization e.g. "Can you give me a high-level overview of this document", or comparisons "Can you compare/contrast X and Y". All of these use cases may require different retrieval techniques.</p>
<h4 id="key-techniques_2">Key Techniques<a class="headerlink" href="#key-techniques_2" title="Permanent link">#</a></h4>
<p>LlamaIndex provides some core abstractions to help you do task-specific retrieval. This includes our <a href="../../module_guides/querying/router/">router</a> module as well as our <a href="../../module_guides/deploying/agents/">data agent</a> module.
This also includes some advanced query engine modules.
This also include other modules that join structured and unstructured data.</p>
<p>You can use these modules to do joint question-answering and summarization, or even combine structured queries with unstructured queries.</p>
<p><strong>Core Module Resources</strong></p>
<ul>
<li><a href="../../module_guides/deploying/query_engine/">Query engine</a></li>
<li><a href="../../module_guides/deploying/agents/">Agents</a></li>
<li><a href="../../module_guides/querying/router/">Router</a></li>
</ul>
<p><strong>Detailed Guide Resources</strong></p>
<ul>
<li><a href="../../examples/query_engine/sub_question_query_engine/">Sub-Question Query Engine</a></li>
<li><a href="../../examples/query_engine/JointQASummary/">Joint QA-Summary</a></li>
<li><a href="../../examples/query_engine/recursive_retriever_agents/">Recursive Retriever Agents</a></li>
<li><a href="../../examples/query_engine/RouterQueryEngine/">Router Query Engine</a></li>
<li><a href="../../examples/agent/openai_agent_query_cookbook/">OpenAI Agent Cookbook</a></li>
</ul>
<h2 id="optimize-context-embeddings">Optimize Context Embeddings<a class="headerlink" href="#optimize-context-embeddings" title="Permanent link">#</a></h2>
<h4 id="motivation_3">Motivation<a class="headerlink" href="#motivation_3" title="Permanent link">#</a></h4>
<p>This is related to the motivation described above in "decoupling chunks used for retrieval vs. synthesis".
We want to make sure that the embeddings are optimized for better retrieval over your specific data corpus.
Pre-trained models may not capture the salient properties of the data relevant to your use case.</p>
<h3 id="key-techniques_3">Key Techniques<a class="headerlink" href="#key-techniques_3" title="Permanent link">#</a></h3>
<p>Beyond some of the techniques listed above, we can also try finetuning the embedding model.
We can actually do this over an unstructured text corpus, in a label-free way.</p>
<p>Check out our guides here:</p>
<ul>
<li><a href="../../examples/finetuning/embeddings/finetune_embedding/">Embedding Fine-tuning Guide</a></li>
</ul>









  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
       
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../../module_guides/llama_deploy/" class="md-footer__link md-footer__link--prev" aria-label="Previous: ü¶ô LlamaDeploy ü§ñ">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                ü¶ô LlamaDeploy ü§ñ
              </div>
            </div>
          </a>
        
        
          
          <a href="../basic_strategies/basic_strategies/" class="md-footer__link md-footer__link--next" aria-label="Next: Basic Strategies">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Basic Strategies
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <readthedocs-flyout position="bottom-left"></readthedocs-flyout>
      
    </div>
  </div>
</footer>
      
<!-- Google Tag Manager -->
<script>
  (function (w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
    var f = d.getElementsByTagName(s)[0],
      j = d.createElement(s),
      dl = l != "dataLayer" ? "&l=" + l : "";
    j.async = true;
    j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
    f.parentNode.insertBefore(j, f);
  })(window, document, "script", "dataLayer", "GTM-WWRFB36R");
</script>
<!-- End Google Tag Manager -->

    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "navigation.prune", "navigation.tabs", "navigation.indexes", "navigation.top", "navigation.footer", "toc.follow", "content.code.copy", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../../javascript/runllm.js"></script>
      
        <script src="../../javascript/algolia.js"></script>
      
    
  </body>
</html>